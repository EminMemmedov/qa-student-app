# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∑–∞—â–∏—Ç–µ –æ—Ç –Ω–∞–∫—Ä—É—Ç–∫–∏ XP (Anti-Cheat) üõ°Ô∏è

–ß—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥–ª–∏ –Ω–∞–∫—Ä—É—á–∏–≤–∞—Ç—å —Å–µ–±–µ XP —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞, –≤–∞–º –Ω—É–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å **–ü—Ä–∞–≤–∏–ª–∞ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (Security Rules)** –≤ Firebase Console.

## –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ Firebase Console
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Firebase Console](https://console.firebase.google.com/).
2. –í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç `qa-student-app`.
3. –í –º–µ–Ω—é —Å–ª–µ–≤–∞ –≤—ã–±–µ—Ä–∏—Ç–µ **Firestore Database**.
4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫—É **Rules** (–ü—Ä–∞–≤–∏–ª–∞).

## –®–∞–≥ 2: –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª–∞
–£–¥–∞–ª–∏—Ç–µ –≤—Å–µ, —á—Ç–æ —Ç–∞–º –µ—Å—Ç—å —Å–µ–π—á–∞—Å, –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥:

```groovy
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // –§—É–Ω–∫—Ü–∏—è: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (—Ö–æ—Ç—è —É –Ω–∞—Å –Ω–µ—Ç Auth, –º—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ ID)
    // –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ (–±–µ–∑ Firebase Auth) –º—ã –¥–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –≤ —Å–≤–æ–π –¥–æ–∫—É–º–µ–Ω—Ç.
    // –ù–æ —á—Ç–æ–±—ã –∑–∞—â–∏—Ç–∏—Ç—å—Å—è –æ—Ç –Ω–∞–∫—Ä—É—Ç–∫–∏, –º—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º –î–ê–ù–ù–´–ï.

    match /users/{userId} {
      allow read: if true; // –ß–∏—Ç–∞—Ç—å –º–æ–≥—É—Ç –≤—Å–µ (–¥–ª—è –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞)
      
      // –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è (–Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
      allow create: if true; 

      // –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
      allow update: if 
        // 1. XP –Ω–µ –º–æ–∂–µ—Ç —É–º–µ–Ω—å—à–∞—Ç—å—Å—è (–∑–∞—â–∏—Ç–∞ –æ—Ç —Å–±—Ä–æ—Å–∞, –µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ —ç—Ç–æ –Ω–µ –∞–¥–º–∏–Ω)
        request.resource.data.xp >= resource.data.xp &&
        
        // 2. –ó–ê–©–ò–¢–ê –û–¢ –ù–ê–ö–†–£–¢–ö–ò: 
        // –ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ 500 XP –∑–∞ –æ–¥–∏–Ω —Ä–∞–∑ (–æ–¥–∏–Ω sync).
        // –≠—Ç–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç —Ç–µ—Ö, –∫—Ç–æ –ø–∏—à–µ—Ç xp: 999999.
        (request.resource.data.xp - resource.data.xp) <= 500;
    }

    // –î–ª—è —Ç–µ—Å—Ç–æ–≤–æ–π –±–∞–∑—ã (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
    match /users_test/{userId} {
      allow read, write: if true;
    }
  }
}
```

## –®–∞–≥ 3: –ù–∞–∂–º–∏—Ç–µ "Publish"
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ –≤—Å—Ç—É–ø—è—Ç –≤ —Å–∏–ª—É –º–≥–Ω–æ–≤–µ–Ω–Ω–æ.

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?
–ï—Å–ª–∏ —Ö–∏—Ç—Ä—ã–π —Å—Ç—É–¥–µ–Ω—Ç –æ—Ç–∫—Ä–æ–µ—Ç –∫–æ–Ω—Å–æ–ª—å –∏ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–¥:
`updateDoc(..., { xp: 1000000 })`

Firebase —É–≤–∏–¥–∏—Ç, —á—Ç–æ —Ä–∞–∑–Ω–∏—Ü–∞ `1000000 - —Ç–µ–∫—É—â–µ–µ_xp` –±–æ–ª—å—à–µ 500, –∏ **–æ—Ç–∫–ª–æ–Ω–∏—Ç –∑–∞–ø—Ä–æ—Å**.
–í –∫–æ–Ω—Å–æ–ª–∏ —É —Å—Ç—É–¥–µ–Ω—Ç–∞ –ø–æ—è–≤–∏—Ç—Å—è –æ—à–∏–±–∫–∞: `Simulated write denied` –∏–ª–∏ `Permission denied`.

## –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –∑–∞—â–∏—Ç–∞ (Level 2)
–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä (Cloud Functions), –≤–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ç–∞—Ä–∏—Ñ **Blaze** (Pay as you go). –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –≤–æ–æ–±—â–µ –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –∑–∞–ø–∏—Å—å XP —Å –∫–ª–∏–µ–Ω—Ç–∞ –∏ –¥–µ–ª–∞—Ç—å —ç—Ç–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∑–∞—â–∏—â–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–æ–¥.

