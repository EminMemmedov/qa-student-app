import{t as e}from"./useTranslation-HwJg4ql5.js";import{t}from"./arrow-right--noGg0Pl.js";import{n,t as r}from"./lock-open-D8L6s8Lf.js";import{t as i}from"./circle-alert-BqeA137O.js";import{t as a}from"./circle-check-big-ZpW1P5p_.js";import{t as o}from"./database-Ri_UaILl.js";import{t as s}from"./lock-hYQ74OPk.js";import{a as c,b as l,g as u,h as d,n as f,o as p,u as m}from"./index-BeZEgM9f.js";import{t as h}from"./useGameProgress-h_HpgAh9.js";import{t as g}from"./confetti.module-DdO-Js2X.js";import{t as _}from"./PageTransition-CiJSWDBw.js";var v=l(),y=d();function b(){let{t:l}=e(),{addXP:d,xp:b}=h(),{checkAchievements:x}=f(),[S,C]=(0,v.useState)(1),[w,T]=(0,v.useState)(()=>{let e=localStorage.getItem(`qa_database_answers`);return e?JSON.parse(e):{}}),[E,D]=(0,v.useState)(null),[O,k]=(0,v.useState)(()=>{let e=localStorage.getItem(`qa_database_completed`);return e?JSON.parse(e):[]});(0,v.useEffect)(()=>{localStorage.setItem(`qa_database_answers`,JSON.stringify(w))},[w]),(0,v.useEffect)(()=>{localStorage.setItem(`qa_database_completed`,JSON.stringify(O))},[O]);let A={1:{title:l(`database.levels.level1`),description:l(`database.levels.level1_desc`),buggyCode:`// Get user orders
const userId = req.body.userId;

// Bug: SQL Injection & SELECT *
const query = "SELECT * FROM Users, Orders WHERE Users.id = " + userId;

db.execute(query);`,hint:`Use parameterized queries (?) and specify columns instead of *.`,validate:e=>{let t=e.includes(`?`)||e.includes(`$1`),n=e.includes(`SELECT *`),r=e.includes(`+ userId`)||e.includes("${userId}");return t&&!n&&!r}},2:{title:l(`database.levels.level2`),description:l(`database.levels.level2_desc`),buggyCode:`// Get active orders
// Bug: Missing JOIN condition & Index
const query = \`
    SELECT u.name, o.amount 
    FROM Users u, Orders o 
    WHERE o.status = 'active'
\`;`,hint:`Use INNER JOIN ... ON ... to avoid Cartesian Product.`,validate:e=>{let t=e.toLowerCase();return t.includes(`join`)&&t.includes(`on`)}},3:{title:l(`database.levels.level3`),description:l(`database.levels.level3_desc`),buggyCode:`// Transfer money
const transfer = async (fromId, toId, amount) => {
    // Bug: No Transaction & N+1 Problem
    await db.query('UPDATE Accounts SET balance = balance - ? WHERE id = ?', [amount, fromId]);
    
    const history = await db.query('SELECT * FROM History');
    for(let h of history) {
        await db.query('SELECT * FROM Meta WHERE h_id = ?', [h.id]);
    }

    await db.query('UPDATE Accounts SET balance = balance + ? WHERE id = ?', [amount, toId]);
};`,hint:`Wrap updates in BEGIN/COMMIT transaction.`,validate:e=>{let t=e.toLowerCase();return(t.includes(`begin`)||t.includes(`start transaction`))&&t.includes(`commit`)}},4:{title:l(`database.levels.level4`),description:l(`database.levels.level4_desc`),buggyCode:`// Get users with more than 5 orders
// Bug: Filtering aggregate in WHERE
const query = \`
    SELECT user_id, COUNT(*) as order_count
    FROM Orders
    WHERE COUNT(*) > 5
    GROUP BY user_id
\`;`,hint:`Use HAVING for filtering aggregate functions (COUNT, SUM).`,validate:e=>{let t=e.toLowerCase(),n=t.includes(`having count`),r=t.includes(`where count`);return n&&!r}},5:{title:l(`database.levels.level5`),description:l(`database.levels.level5_desc`),buggyCode:`// Register User
const register = async (username, password) => {
    // Bug: Storing password in plain text
    await db.query('INSERT INTO Users (username, password) VALUES (?, ?)', [username, password]);
};`,hint:`Hash the password before storing (e.g., bcrypt.hash).`,validate:e=>{let t=e.toLowerCase();return t.includes(`hash`)||t.includes(`bcrypt`)||t.includes(`md5`)||t.includes(`sha`)}}}[S];return(0,v.useEffect)(()=>{D(null)},[S]),(0,y.jsx)(_,{className:`min-h-screen bg-slate-900 text-slate-300 p-6 pt-20 pb-24`,children:(0,y.jsxs)(`div`,{className:`max-w-7xl mx-auto`,children:[(0,y.jsxs)(`div`,{className:`flex items-center gap-4 mb-8`,children:[(0,y.jsx)(u,{to:`/practice`,className:`p-2 bg-slate-800 rounded-xl hover:bg-slate-700 transition-colors`,children:(0,y.jsx)(n,{className:`text-white`})}),(0,y.jsxs)(`div`,{children:[(0,y.jsxs)(`h1`,{className:`text-3xl font-bold text-white flex items-center gap-3`,children:[(0,y.jsx)(o,{size:32,className:`text-indigo-500`}),l(`database.title`)]}),(0,y.jsx)(`p`,{className:`text-slate-400`,children:l(`database.description`)})]})]}),(0,y.jsx)(`div`,{className:`flex gap-4 mb-8 overflow-x-auto pb-2`,children:[1,2,3,4,5].map(e=>{let t=e>1&&!O.includes(e-1),n=O.includes(e);return(0,y.jsx)(`button`,{onClick:()=>!t&&C(e),disabled:t,className:`flex-1 min-w-[150px] p-4 rounded-xl border-2 transition-all flex flex-col items-center gap-2 ${S===e?`border-indigo-500 bg-indigo-500/10 text-white`:t?`border-slate-800 bg-slate-800/50 text-slate-600 cursor-not-allowed`:`border-slate-700 bg-slate-800 text-slate-400 hover:border-slate-600`}`,children:(0,y.jsxs)(`div`,{className:`flex items-center gap-2`,children:[t?(0,y.jsx)(s,{size:16}):n?(0,y.jsx)(a,{size:16,className:`text-green-500`}):(0,y.jsx)(r,{size:16}),(0,y.jsx)(`span`,{className:`font-bold`,children:l(`database.levels.level${e}`)})]})},e)})}),(0,y.jsxs)(`div`,{className:`grid grid-cols-1 lg:grid-cols-2 gap-6`,children:[(0,y.jsxs)(`div`,{className:`bg-slate-800 rounded-2xl overflow-hidden shadow-xl border border-slate-700 flex flex-col min-h-[300px] lg:h-[600px]`,children:[(0,y.jsxs)(`div`,{className:`px-4 py-3 bg-slate-950 border-b border-slate-700 flex items-center justify-between`,children:[(0,y.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,y.jsx)(m,{size:18,className:`text-red-400`}),(0,y.jsx)(`span`,{className:`font-mono text-sm font-bold text-slate-200`,children:`Buggy Code`})]}),(0,y.jsx)(`span`,{className:`text-xs text-slate-400 italic ml-4 text-right hidden sm:block`,children:A.description})]}),(0,y.jsx)(`div`,{className:`p-4 font-mono text-sm overflow-auto flex-1 bg-slate-900/50`,children:(0,y.jsx)(`pre`,{className:`text-red-300/80`,children:A.buggyCode})})]}),(0,y.jsxs)(`div`,{className:`bg-slate-800 rounded-2xl overflow-hidden shadow-xl border border-slate-700 flex flex-col min-h-[300px] lg:h-[600px]`,children:[(0,y.jsxs)(`div`,{className:`px-4 py-3 bg-slate-950 border-b border-slate-700 flex items-center justify-between`,children:[(0,y.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,y.jsx)(a,{size:18,className:`text-green-400`}),(0,y.jsx)(`span`,{className:`font-mono text-sm font-bold text-slate-200`,children:l(`database.fix_instruction`)})]}),(0,y.jsxs)(`button`,{onClick:()=>{let e=w[S]||``;if(A.validate(e)){if(D({type:`success`,message:l(`database.correct`)}),g({particleCount:100,spread:70,origin:{y:.6}}),!O.includes(S)){let e=[...O,S];k(e),d(200);let t=JSON.parse(localStorage.getItem(`qa_automation_completed`)||`[]`);x({xp:b+200,completedLevels:{database:e,automation:t},addXP:d,foundBugs:[],moduleBugs:{},getBugDifficulty:()=>`easy`})}}else D({type:`error`,message:l(`database.incorrect`)})},className:`flex items-center gap-2 px-4 py-1.5 rounded-lg text-sm font-bold bg-indigo-600 hover:bg-indigo-700 text-white transition-all shadow-lg shadow-indigo-500/20`,children:[l(`database.check`),(0,y.jsx)(t,{size:14})]})]}),(0,y.jsx)(`textarea`,{value:w[S]||``,onChange:e=>{let t=e.target.value;T(e=>({...e,[S]:t}))},placeholder:l(`database.placeholder`),className:`flex-1 w-full bg-slate-900 p-4 font-mono text-sm text-green-300 focus:outline-none resize-none`,spellCheck:`false`}),(0,y.jsx)(p,{children:E&&(0,y.jsxs)(c.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},className:`p-4 border-t ${E.type===`success`?`bg-green-500/10 border-green-500/20 text-green-400`:`bg-red-500/10 border-red-500/20 text-red-400`}`,children:[(0,y.jsxs)(`div`,{className:`flex items-center gap-2 font-bold`,children:[E.type===`success`?(0,y.jsx)(a,{size:18}):(0,y.jsx)(i,{size:18}),E.message]}),E.type===`error`&&(0,y.jsxs)(`div`,{className:`mt-1 text-xs opacity-70 ml-6`,children:[l(`database.hint`),`: `,A.hint]})]})})]})]})]})})}export{b as default};