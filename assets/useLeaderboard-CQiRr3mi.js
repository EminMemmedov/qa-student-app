import{C as e,T as t,j as n,n as r}from"./index-L6i9Tykn.js";import{t as i}from"./useGameProgress-DJOXUuUo.js";import{t as a}from"./logger-z-UmzD0Z.js";var o=()=>void 0,s=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=i&63|128):(i&64512)==55296&&r+1<e.length&&(e.charCodeAt(r+1)&64512)==56320?(i=65536+((i&1023)<<10)+(e.charCodeAt(++r)&1023),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=i&63|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=i&63|128)}return t},c=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let a=e[n++];t[r++]=String.fromCharCode((i&31)<<6|a&63)}else if(i>239&&i<365){let a=e[n++],o=e[n++],s=e[n++],c=((i&7)<<18|(a&63)<<12|(o&63)<<6|s&63)-65536;t[r++]=String.fromCharCode(55296+(c>>10)),t[r++]=String.fromCharCode(56320+(c&1023))}else{let a=e[n++],o=e[n++];t[r++]=String.fromCharCode((i&15)<<12|(a&63)<<6|o&63)}}return t.join(``)},l={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789`,get ENCODED_VALS(){return this.ENCODED_VALS_BASE+`+/=`},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+`-_.`},HAS_NATIVE_SUPPORT:typeof atob==`function`,encodeByteArray(e,t){if(!Array.isArray(e))throw Error(`encodeByteArray takes an array as a parameter`);this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],a=t+1<e.length,o=a?e[t+1]:0,s=t+2<e.length,c=s?e[t+2]:0,l=i>>2,u=(i&3)<<4|o>>4,d=(o&15)<<2|c>>6,f=c&63;s||(f=64,a||(d=64)),r.push(n[l],n[u],n[d],n[f])}return r.join(``)},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(s(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):c(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],a=t<e.length?n[e.charAt(t)]:0;++t;let o=t<e.length?n[e.charAt(t)]:64;++t;let s=t<e.length?n[e.charAt(t)]:64;if(++t,i==null||a==null||o==null||s==null)throw new u;let c=i<<2|a>>4;if(r.push(c),o!==64){let e=a<<4&240|o>>2;if(r.push(e),s!==64){let e=o<<6&192|s;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},u=class extends Error{constructor(){super(...arguments),this.name=`DecodeBase64StringError`}},d=function(e){let t=s(e);return l.encodeByteArray(t,!0)},f=function(e){return d(e).replace(/\./g,``)},p=function(e){try{return l.decodeString(e,!0)}catch(e){console.error(`base64Decode failed: `,e)}return null};function m(){if(typeof self<`u`)return self;if(typeof window<`u`)return window;if(typeof global<`u`)return global;throw Error(`Unable to locate global object.`)}var h=()=>m().__FIREBASE_DEFAULTS__,g=()=>{if(typeof process>`u`)return;let e={}.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},ee=()=>{if(typeof document>`u`)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let t=e&&p(e[1]);return t&&JSON.parse(t)},te=()=>{try{return o()||h()||g()||ee()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},ne=e=>te()?.emulatorHosts?.[e],re=e=>{let t=ne(e);if(!t)return;let n=t.lastIndexOf(`:`);if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(n+1),10);return t[0]===`[`?[t.substring(1,n-1),r]:[t.substring(0,n),r]},ie=()=>te()?.config,ae=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e==`function`&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}};function oe(e){try{return(e.startsWith(`http://`)||e.startsWith(`https://`)?new URL(e).hostname:e).endsWith(`.cloudworkstations.dev`)}catch{return!1}}async function se(e){return(await fetch(e,{credentials:`include`})).ok}function ce(e,t){if(e.uid)throw Error(`The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.`);let n={alg:`none`,type:`JWT`},r=t||`demo-project`,i=e.iat||0,a=e.sub||e.user_id;if(!a)throw Error(`mockUserToken must contain 'sub' or 'user_id' field!`);let o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:a,user_id:a,firebase:{sign_in_provider:`custom`,identities:{}},...e};return[f(JSON.stringify(n)),f(JSON.stringify(o)),``].join(`.`)}var _={};function v(){let e={prod:[],emulator:[]};for(let t of Object.keys(_))_[t]?e.emulator.push(t):e.prod.push(t);return e}function le(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement(`div`),t.setAttribute(`id`,e),n=!0),{created:n,element:t}}var ue=!1;function de(e,t){if(typeof window>`u`||typeof document>`u`||!oe(window.location.host)||_[e]===t||_[e]||ue)return;_[e]=t;function n(e){return`__firebase__banner__${e}`}let r=`__firebase__banner`,i=v().prod.length>0;function a(){let e=document.getElementById(r);e&&e.remove()}function o(e){e.style.display=`flex`,e.style.background=`#7faaf0`,e.style.position=`fixed`,e.style.bottom=`5px`,e.style.left=`5px`,e.style.padding=`.5em`,e.style.borderRadius=`5px`,e.style.alignItems=`center`}function s(e,t){e.setAttribute(`width`,`24`),e.setAttribute(`id`,t),e.setAttribute(`height`,`24`),e.setAttribute(`viewBox`,`0 0 24 24`),e.setAttribute(`fill`,`none`),e.style.marginLeft=`-6px`}function c(){let e=document.createElement(`span`);return e.style.cursor=`pointer`,e.style.marginLeft=`16px`,e.style.fontSize=`24px`,e.innerHTML=` &times;`,e.onclick=()=>{ue=!0,a()},e}function l(e,t){e.setAttribute(`id`,t),e.innerText=`Learn more`,e.href=`https://firebase.google.com/docs/studio/preview-apps#preview-backend`,e.setAttribute(`target`,`__blank`),e.style.paddingLeft=`5px`,e.style.textDecoration=`underline`}function u(){let e=le(r),t=n(`text`),a=document.getElementById(t)||document.createElement(`span`),u=n(`learnmore`),d=document.getElementById(u)||document.createElement(`a`),f=n(`preprendIcon`),p=document.getElementById(f)||document.createElementNS(`http://www.w3.org/2000/svg`,`svg`);if(e.created){let t=e.element;o(t),l(d,u);let n=c();s(p,f),t.append(p,a,d,n),document.body.appendChild(t)}i?(a.innerText=`Preview backend disconnected.`,p.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(p.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,a.innerText=`Preview backend running in this workspace.`),a.setAttribute(`id`,t)}document.readyState===`loading`?window.addEventListener(`DOMContentLoaded`,u):u()}function fe(){return typeof navigator<`u`&&typeof navigator.userAgent==`string`?navigator.userAgent:``}function pe(){let e=te()?.forceEnvironment;if(e===`node`)return!0;if(e===`browser`)return!1;try{return Object.prototype.toString.call(global.process)===`[object process]`}catch{return!1}}function me(){return!pe()&&!!navigator.userAgent&&navigator.userAgent.includes(`Safari`)&&!navigator.userAgent.includes(`Chrome`)}function he(){try{return typeof indexedDB==`object`}catch{return!1}}function ge(){return new Promise((e,t)=>{try{let n=!0,r=`validate-browser-context-for-indexeddb-analytics-module`,i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{t(i.error?.message||``)}}catch(e){t(e)}})}var _e=`FirebaseError`,ve=class e extends Error{constructor(t,n,r){super(n),this.code=t,this.customData=r,this.name=_e,Object.setPrototypeOf(this,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ye.prototype.create)}},ye=class{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){let n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],a=i?be(i,n):`Error`;return new ve(r,`${this.serviceName}: ${a} (${r}).`,n)}};function be(e,t){return e.replace(xe,(e,n)=>{let r=t[n];return r==null?`<${n}?>`:String(r)})}var xe=/\{\$([^}]+)}/g;function Se(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let n=e[i],a=t[i];if(Ce(n)&&Ce(a)){if(!Se(n,a))return!1}else if(n!==a)return!1}for(let e of r)if(!n.includes(e))return!1;return!0}function Ce(e){return typeof e==`object`&&!!e}function we(e){return e&&e._delegate?e._delegate:e}var Te=class{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode=`LAZY`,this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}},Ee=`[DEFAULT]`,De=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new ae;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}else if(n)return null;else throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(ke(e))try{this.getOrInitializeService({instanceIdentifier:Ee})}catch{}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch{}}}}clearInstance(e=Ee){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>`INTERNAL`in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>`_delete`in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ee){return this.instances.has(e)}getOptions(e=Ee){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){let n=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(n)??new Set;r.add(e),this.onInitCallbacks.set(n,r);let i=this.instances.get(n);return i&&e(i,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:Oe(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=Ee){return this.component?this.component.multipleInstances?e:Ee:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!==`EXPLICIT`}};function Oe(e){return e===Ee?void 0:e}function ke(e){return e.instantiationMode===`EAGER`}var Ae=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new De(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}},je=[],y;(function(e){e[e.DEBUG=0]=`DEBUG`,e[e.VERBOSE=1]=`VERBOSE`,e[e.INFO=2]=`INFO`,e[e.WARN=3]=`WARN`,e[e.ERROR=4]=`ERROR`,e[e.SILENT=5]=`SILENT`})(y||={});var Me={debug:y.DEBUG,verbose:y.VERBOSE,info:y.INFO,warn:y.WARN,error:y.ERROR,silent:y.SILENT},Ne=y.INFO,Pe={[y.DEBUG]:`log`,[y.VERBOSE]:`log`,[y.INFO]:`info`,[y.WARN]:`warn`,[y.ERROR]:`error`},Fe=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=Pe[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)},b=class{constructor(e){this.name=e,this._logLevel=Ne,this._logHandler=Fe,this._userLogHandler=null,je.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in y))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e==`string`?Me[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!=`function`)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,y.DEBUG,...e),this._logHandler(this,y.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,y.VERBOSE,...e),this._logHandler(this,y.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,y.INFO,...e),this._logHandler(this,y.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,y.WARN,...e),this._logHandler(this,y.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,y.ERROR,...e),this._logHandler(this,y.ERROR,...e)}},x=(e,t)=>t.some(t=>e instanceof t),Ie,Le;function Re(){return Ie||=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]}function ze(){return Le||=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey]}var Be=new WeakMap,Ve=new WeakMap,He=new WeakMap,Ue=new WeakMap,We=new WeakMap;function Ge(e){let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener(`success`,i),e.removeEventListener(`error`,a)},i=()=>{t(S(e.result)),r()},a=()=>{n(e.error),r()};e.addEventListener(`success`,i),e.addEventListener(`error`,a)});return t.then(t=>{t instanceof IDBCursor&&Be.set(t,e)}).catch(()=>{}),We.set(t,e),t}function Ke(e){if(Ve.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener(`complete`,i),e.removeEventListener(`error`,a),e.removeEventListener(`abort`,a)},i=()=>{t(),r()},a=()=>{n(e.error||new DOMException(`AbortError`,`AbortError`)),r()};e.addEventListener(`complete`,i),e.addEventListener(`error`,a),e.addEventListener(`abort`,a)});Ve.set(e,t)}var qe={get(e,t,n){if(e instanceof IDBTransaction){if(t===`done`)return Ve.get(e);if(t===`objectStoreNames`)return e.objectStoreNames||He.get(e);if(t===`store`)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return S(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t===`done`||t===`store`)?!0:t in e}};function Je(e){qe=e(qe)}function Ye(e){return e===IDBDatabase.prototype.transaction&&!(`objectStoreNames`in IDBTransaction.prototype)?function(t,...n){let r=e.call(Ze(this),t,...n);return He.set(r,t.sort?t.sort():[t]),S(r)}:ze().includes(e)?function(...t){return e.apply(Ze(this),t),S(Be.get(this))}:function(...t){return S(e.apply(Ze(this),t))}}function Xe(e){return typeof e==`function`?Ye(e):(e instanceof IDBTransaction&&Ke(e),x(e,Re())?new Proxy(e,qe):e)}function S(e){if(e instanceof IDBRequest)return Ge(e);if(Ue.has(e))return Ue.get(e);let t=Xe(e);return t!==e&&(Ue.set(e,t),We.set(t,e)),t}var Ze=e=>We.get(e);function Qe(e,t,{blocked:n,upgrade:r,blocking:i,terminated:a}={}){let o=indexedDB.open(e,t),s=S(o);return r&&o.addEventListener(`upgradeneeded`,e=>{r(S(o.result),e.oldVersion,e.newVersion,S(o.transaction),e)}),n&&o.addEventListener(`blocked`,e=>n(e.oldVersion,e.newVersion,e)),s.then(e=>{a&&e.addEventListener(`close`,()=>a()),i&&e.addEventListener(`versionchange`,e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s}var $e=[`get`,`getKey`,`getAll`,`getAllKeys`,`count`],et=[`put`,`add`,`delete`,`clear`],tt=new Map;function C(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t==`string`))return;if(tt.get(t))return tt.get(t);let n=t.replace(/FromIndex$/,``),r=t!==n,i=et.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||$e.includes(n)))return;let a=async function(e,...t){let a=this.transaction(e,i?`readwrite`:`readonly`),o=a.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&a.done]))[0]};return tt.set(t,a),a}Je(e=>({...e,get:(t,n,r)=>C(t,n)||e.get(t,n,r),has:(t,n)=>!!C(t,n)||e.has(t,n)}));var nt=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(rt(e)){let t=e.getImmediate();return`${t.library}/${t.version}`}else return null}).filter(e=>e).join(` `)}};function rt(e){return e.getComponent()?.type===`VERSION`}var it=`@firebase/app`,at=`0.14.6`,ot=new b(`@firebase/app`),st=`@firebase/app-compat`,ct=`@firebase/analytics-compat`,lt=`@firebase/analytics`,ut=`@firebase/app-check-compat`,dt=`@firebase/app-check`,ft=`@firebase/auth`,pt=`@firebase/auth-compat`,mt=`@firebase/database`,ht=`@firebase/data-connect`,gt=`@firebase/database-compat`,_t=`@firebase/functions`,vt=`@firebase/functions-compat`,yt=`@firebase/installations`,bt=`@firebase/installations-compat`,xt=`@firebase/messaging`,St=`@firebase/messaging-compat`,Ct=`@firebase/performance`,wt=`@firebase/performance-compat`,Tt=`@firebase/remote-config`,Et=`@firebase/remote-config-compat`,Dt=`@firebase/storage`,Ot=`@firebase/storage-compat`,kt=`@firebase/firestore`,At=`@firebase/ai`,jt=`@firebase/firestore-compat`,Mt=`firebase`,Nt=`12.6.0`,Pt=`[DEFAULT]`,Ft={[it]:`fire-core`,[st]:`fire-core-compat`,[lt]:`fire-analytics`,[ct]:`fire-analytics-compat`,[dt]:`fire-app-check`,[ut]:`fire-app-check-compat`,[ft]:`fire-auth`,[pt]:`fire-auth-compat`,[mt]:`fire-rtdb`,[ht]:`fire-data-connect`,[gt]:`fire-rtdb-compat`,[_t]:`fire-fn`,[vt]:`fire-fn-compat`,[yt]:`fire-iid`,[bt]:`fire-iid-compat`,[xt]:`fire-fcm`,[St]:`fire-fcm-compat`,[Ct]:`fire-perf`,[wt]:`fire-perf-compat`,[Tt]:`fire-rc`,[Et]:`fire-rc-compat`,[Dt]:`fire-gcs`,[Ot]:`fire-gcs-compat`,[kt]:`fire-fst`,[jt]:`fire-fst-compat`,[At]:`fire-vertex`,"fire-js":`fire-js`,[Mt]:`fire-js-all`},It=new Map,Lt=new Map,Rt=new Map;function zt(e,t){try{e.container.addComponent(t)}catch(n){ot.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function Bt(e){let t=e.name;if(Rt.has(t))return ot.debug(`There were multiple attempts to register component ${t}.`),!1;Rt.set(t,e);for(let t of It.values())zt(t,e);for(let t of Lt.values())zt(t,e);return!0}function Vt(e,t){let n=e.container.getProvider(`heartbeat`).getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function Ht(e){return e==null?!1:e.settings!==void 0}var w=new ye(`app`,`Firebase`,{"no-app":`No Firebase App '{$appName}' has been created - call initializeApp() first`,"bad-app-name":`Illegal App name: '{$appName}'`,"duplicate-app":`Firebase App named '{$appName}' already exists with different options or config`,"app-deleted":`Firebase App named '{$appName}' already deleted`,"server-app-deleted":`Firebase Server App has been deleted`,"no-options":`Need to provide options, when not being deployed to hosting via source.`,"invalid-app-argument":`firebase.{$appName}() takes either no argument or a Firebase App instance.`,"invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":`Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.`,"idb-get":`Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.`,"idb-set":`Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.`,"idb-delete":`Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.`,"finalization-registry-not-supported":`FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.`,"invalid-server-app-environment":`FirebaseServerApp is not for use in browser environments.`}),Ut=class{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Te(`app`,()=>this,`PUBLIC`))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw w.create(`app-deleted`,{appName:this._name})}},Wt=Nt;function T(e,t={}){let n=e;typeof t!=`object`&&(t={name:t});let r={name:Pt,automaticDataCollectionEnabled:!0,...t},i=r.name;if(typeof i!=`string`||!i)throw w.create(`bad-app-name`,{appName:String(i)});if(n||=ie(),!n)throw w.create(`no-options`);let a=It.get(i);if(a){if(Se(n,a.options)&&Se(r,a.config))return a;throw w.create(`duplicate-app`,{appName:i})}let o=new Ae(i);for(let e of Rt.values())o.addComponent(e);let s=new Ut(n,r,o);return It.set(i,s),s}function Gt(e=Pt){let t=It.get(e);if(!t&&e===`[DEFAULT]`&&ie())return T();if(!t)throw w.create(`no-app`,{appName:e});return t}function Kt(e,t,n){let r=Ft[e]??e;n&&(r+=`-${n}`);let i=r.match(/\s|\//),a=t.match(/\s|\//);if(i||a){let e=[`Unable to register library "${r}" with version "${t}":`];i&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&a&&e.push(`and`),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),ot.warn(e.join(` `));return}Bt(new Te(`${r}-version`,()=>({library:r,version:t}),`VERSION`))}var qt=`firebase-heartbeat-database`,Jt=1,Yt=`firebase-heartbeat-store`,Xt=null;function Zt(){return Xt||=Qe(qt,Jt,{upgrade:(e,t)=>{switch(t){case 0:try{e.createObjectStore(Yt)}catch(e){console.warn(e)}}}}).catch(e=>{throw w.create(`idb-open`,{originalErrorMessage:e.message})}),Xt}async function Qt(e){try{let t=(await Zt()).transaction(Yt),n=await t.objectStore(Yt).get(en(e));return await t.done,n}catch(e){if(e instanceof ve)ot.warn(e.message);else{let t=w.create(`idb-get`,{originalErrorMessage:e?.message});ot.warn(t.message)}}}async function $t(e,t){try{let n=(await Zt()).transaction(Yt,`readwrite`);await n.objectStore(Yt).put(t,en(e)),await n.done}catch(e){if(e instanceof ve)ot.warn(e.message);else{let t=w.create(`idb-set`,{originalErrorMessage:e?.message});ot.warn(t.message)}}}function en(e){return`${e.name}!${e.options.appId}`}var tn=1024,nn=30,rn=class{constructor(e){this.container=e,this._heartbeatsCache=null,this._storage=new sn(this.container.getProvider(`app`).getImmediate()),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider(`platform-logger`).getImmediate().getPlatformInfoString(),t=an();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>nn){let e=ln(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){ot.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return``;let e=an(),{heartbeatsToSend:t,unsentEntries:n}=on(this._heartbeatsCache.heartbeats),r=f(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return ot.warn(e),``}}};function an(){return new Date().toISOString().substring(0,10)}function on(e,t=tn){let n=[],r=e.slice();for(let i of e){let e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),cn(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),cn(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}var sn=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return he()?ge().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){let e=await Qt(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return $t(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return $t(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}else return}};function cn(e){return f(JSON.stringify({version:2,heartbeats:e})).length}function ln(e){if(e.length===0)return-1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}function un(e){Bt(new Te(`platform-logger`,e=>new nt(e),`PRIVATE`)),Bt(new Te(`heartbeat`,e=>new rn(e),`PRIVATE`)),Kt(it,at,e),Kt(it,at,`esm2020`),Kt(`fire-js`,``)}un(``),Kt(`firebase`,`12.6.0`,`app`);var dn=typeof globalThis<`u`?globalThis:typeof window<`u`?window:typeof global<`u`?global:typeof self<`u`?self:{},fn={},pn,mn;(function(){var e;function t(e,t){function n(){}n.prototype=t.prototype,e.F=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.D=function(e,n,r){for(var i=Array(arguments.length-2),a=2;a<arguments.length;a++)i[a-2]=arguments[a];return t.prototype[n].apply(e,i)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(e,t,n){n||=0;let r=Array(16);if(typeof t==`string`)for(var i=0;i<16;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;i<16;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];let a=e.g[3],o;o=t+(a^n&(i^a))+r[0]+3614090360&4294967295,t=n+(o<<7&4294967295|o>>>25),o=a+(i^t&(n^i))+r[1]+3905402710&4294967295,a=t+(o<<12&4294967295|o>>>20),o=i+(n^a&(t^n))+r[2]+606105819&4294967295,i=a+(o<<17&4294967295|o>>>15),o=n+(t^i&(a^t))+r[3]+3250441966&4294967295,n=i+(o<<22&4294967295|o>>>10),o=t+(a^n&(i^a))+r[4]+4118548399&4294967295,t=n+(o<<7&4294967295|o>>>25),o=a+(i^t&(n^i))+r[5]+1200080426&4294967295,a=t+(o<<12&4294967295|o>>>20),o=i+(n^a&(t^n))+r[6]+2821735955&4294967295,i=a+(o<<17&4294967295|o>>>15),o=n+(t^i&(a^t))+r[7]+4249261313&4294967295,n=i+(o<<22&4294967295|o>>>10),o=t+(a^n&(i^a))+r[8]+1770035416&4294967295,t=n+(o<<7&4294967295|o>>>25),o=a+(i^t&(n^i))+r[9]+2336552879&4294967295,a=t+(o<<12&4294967295|o>>>20),o=i+(n^a&(t^n))+r[10]+4294925233&4294967295,i=a+(o<<17&4294967295|o>>>15),o=n+(t^i&(a^t))+r[11]+2304563134&4294967295,n=i+(o<<22&4294967295|o>>>10),o=t+(a^n&(i^a))+r[12]+1804603682&4294967295,t=n+(o<<7&4294967295|o>>>25),o=a+(i^t&(n^i))+r[13]+4254626195&4294967295,a=t+(o<<12&4294967295|o>>>20),o=i+(n^a&(t^n))+r[14]+2792965006&4294967295,i=a+(o<<17&4294967295|o>>>15),o=n+(t^i&(a^t))+r[15]+1236535329&4294967295,n=i+(o<<22&4294967295|o>>>10),o=t+(i^a&(n^i))+r[1]+4129170786&4294967295,t=n+(o<<5&4294967295|o>>>27),o=a+(n^i&(t^n))+r[6]+3225465664&4294967295,a=t+(o<<9&4294967295|o>>>23),o=i+(t^n&(a^t))+r[11]+643717713&4294967295,i=a+(o<<14&4294967295|o>>>18),o=n+(a^t&(i^a))+r[0]+3921069994&4294967295,n=i+(o<<20&4294967295|o>>>12),o=t+(i^a&(n^i))+r[5]+3593408605&4294967295,t=n+(o<<5&4294967295|o>>>27),o=a+(n^i&(t^n))+r[10]+38016083&4294967295,a=t+(o<<9&4294967295|o>>>23),o=i+(t^n&(a^t))+r[15]+3634488961&4294967295,i=a+(o<<14&4294967295|o>>>18),o=n+(a^t&(i^a))+r[4]+3889429448&4294967295,n=i+(o<<20&4294967295|o>>>12),o=t+(i^a&(n^i))+r[9]+568446438&4294967295,t=n+(o<<5&4294967295|o>>>27),o=a+(n^i&(t^n))+r[14]+3275163606&4294967295,a=t+(o<<9&4294967295|o>>>23),o=i+(t^n&(a^t))+r[3]+4107603335&4294967295,i=a+(o<<14&4294967295|o>>>18),o=n+(a^t&(i^a))+r[8]+1163531501&4294967295,n=i+(o<<20&4294967295|o>>>12),o=t+(i^a&(n^i))+r[13]+2850285829&4294967295,t=n+(o<<5&4294967295|o>>>27),o=a+(n^i&(t^n))+r[2]+4243563512&4294967295,a=t+(o<<9&4294967295|o>>>23),o=i+(t^n&(a^t))+r[7]+1735328473&4294967295,i=a+(o<<14&4294967295|o>>>18),o=n+(a^t&(i^a))+r[12]+2368359562&4294967295,n=i+(o<<20&4294967295|o>>>12),o=t+(n^i^a)+r[5]+4294588738&4294967295,t=n+(o<<4&4294967295|o>>>28),o=a+(t^n^i)+r[8]+2272392833&4294967295,a=t+(o<<11&4294967295|o>>>21),o=i+(a^t^n)+r[11]+1839030562&4294967295,i=a+(o<<16&4294967295|o>>>16),o=n+(i^a^t)+r[14]+4259657740&4294967295,n=i+(o<<23&4294967295|o>>>9),o=t+(n^i^a)+r[1]+2763975236&4294967295,t=n+(o<<4&4294967295|o>>>28),o=a+(t^n^i)+r[4]+1272893353&4294967295,a=t+(o<<11&4294967295|o>>>21),o=i+(a^t^n)+r[7]+4139469664&4294967295,i=a+(o<<16&4294967295|o>>>16),o=n+(i^a^t)+r[10]+3200236656&4294967295,n=i+(o<<23&4294967295|o>>>9),o=t+(n^i^a)+r[13]+681279174&4294967295,t=n+(o<<4&4294967295|o>>>28),o=a+(t^n^i)+r[0]+3936430074&4294967295,a=t+(o<<11&4294967295|o>>>21),o=i+(a^t^n)+r[3]+3572445317&4294967295,i=a+(o<<16&4294967295|o>>>16),o=n+(i^a^t)+r[6]+76029189&4294967295,n=i+(o<<23&4294967295|o>>>9),o=t+(n^i^a)+r[9]+3654602809&4294967295,t=n+(o<<4&4294967295|o>>>28),o=a+(t^n^i)+r[12]+3873151461&4294967295,a=t+(o<<11&4294967295|o>>>21),o=i+(a^t^n)+r[15]+530742520&4294967295,i=a+(o<<16&4294967295|o>>>16),o=n+(i^a^t)+r[2]+3299628645&4294967295,n=i+(o<<23&4294967295|o>>>9),o=t+(i^(n|~a))+r[0]+4096336452&4294967295,t=n+(o<<6&4294967295|o>>>26),o=a+(n^(t|~i))+r[7]+1126891415&4294967295,a=t+(o<<10&4294967295|o>>>22),o=i+(t^(a|~n))+r[14]+2878612391&4294967295,i=a+(o<<15&4294967295|o>>>17),o=n+(a^(i|~t))+r[5]+4237533241&4294967295,n=i+(o<<21&4294967295|o>>>11),o=t+(i^(n|~a))+r[12]+1700485571&4294967295,t=n+(o<<6&4294967295|o>>>26),o=a+(n^(t|~i))+r[3]+2399980690&4294967295,a=t+(o<<10&4294967295|o>>>22),o=i+(t^(a|~n))+r[10]+4293915773&4294967295,i=a+(o<<15&4294967295|o>>>17),o=n+(a^(i|~t))+r[1]+2240044497&4294967295,n=i+(o<<21&4294967295|o>>>11),o=t+(i^(n|~a))+r[8]+1873313359&4294967295,t=n+(o<<6&4294967295|o>>>26),o=a+(n^(t|~i))+r[15]+4264355552&4294967295,a=t+(o<<10&4294967295|o>>>22),o=i+(t^(a|~n))+r[6]+2734768916&4294967295,i=a+(o<<15&4294967295|o>>>17),o=n+(a^(i|~t))+r[13]+1309151649&4294967295,n=i+(o<<21&4294967295|o>>>11),o=t+(i^(n|~a))+r[4]+4149444226&4294967295,t=n+(o<<6&4294967295|o>>>26),o=a+(n^(t|~i))+r[11]+3174756917&4294967295,a=t+(o<<10&4294967295|o>>>22),o=i+(t^(a|~n))+r[2]+718787259&4294967295,i=a+(o<<15&4294967295|o>>>17),o=n+(a^(i|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+a&4294967295}r.prototype.v=function(e,t){t===void 0&&(t=e.length);let n=t-this.blockSize,r=this.C,a=this.h,o=0;for(;o<t;){if(a==0)for(;o<=n;)i(this,e,o),o+=this.blockSize;if(typeof e==`string`){for(;o<t;)if(r[a++]=e.charCodeAt(o++),a==this.blockSize){i(this,r),a=0;break}}else for(;o<t;)if(r[a++]=e[o++],a==this.blockSize){i(this,r),a=0;break}}this.h=a,this.o+=t},r.prototype.A=function(){var e=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=this.o*8;for(var n=e.length-8;n<e.length;++n)e[n]=t&255,t/=256;for(this.v(e),e=Array(16),t=0,n=0;n<4;++n)for(let r=0;r<32;r+=8)e[t++]=this.g[n]>>>r&255;return e};function a(e,t){var n=s;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}function o(e,t){this.h=t;let n=[],r=!0;for(let i=e.length-1;i>=0;i--){let a=e[i]|0;r&&a==t||(n[i]=a,r=!1)}this.g=n}var s={};function c(e){return-128<=e&&e<128?a(e,function(e){return new o([e|0],e<0?-1:0)}):new o([e|0],e<0?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return d;if(e<0)return g(l(-e));let t=[],n=1;for(let r=0;e>=n;r++)t[r]=e/n|0,n*=4294967296;return new o(t,0)}function u(e,t){if(e.length==0)throw Error(`number format error: empty string`);if(t||=10,t<2||36<t)throw Error(`radix out of range: `+t);if(e.charAt(0)==`-`)return g(u(e.substring(1),t));if(e.indexOf(`-`)>=0)throw Error(`number format error: interior "-" character`);let n=l(t**8),r=d;for(let a=0;a<e.length;a+=8){var i=Math.min(8,e.length-a);let o=parseInt(e.substring(a,a+i),t);i<8?(i=l(t**+i),r=r.j(i).add(l(o))):(r=r.j(n),r=r.add(l(o)))}return r}var d=c(0),f=c(1),p=c(16777216);e=o.prototype,e.m=function(){if(h(this))return-g(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){let r=this.i(n);e+=(r>=0?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if(e||=10,e<2||36<e)throw Error(`radix out of range: `+e);if(m(this))return`0`;if(h(this))return`-`+g(this).toString(e);let t=l(e**6);var n=this;let r=``;for(;;){let i=re(n,t).g;n=ee(n,i.j(t));let a=((n.g.length>0?n.g[0]:n.h)>>>0).toString(e);if(n=i,m(n))return a+r;for(;a.length<6;)a=`0`+a;r=a+r}},e.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h};function m(e){if(e.h!=0)return!1;for(let t=0;t<e.g.length;t++)if(e.g[t]!=0)return!1;return!0}function h(e){return e.h==-1}e.l=function(e){return e=ee(this,e),h(e)?-1:m(e)?0:1};function g(e){let t=e.g.length,n=[];for(let r=0;r<t;r++)n[r]=~e.g[r];return new o(n,~e.h).add(f)}e.abs=function(){return h(this)?g(this):this},e.add=function(e){let t=Math.max(this.g.length,e.g.length),n=[],r=0;for(let i=0;i<=t;i++){let t=r+(this.i(i)&65535)+(e.i(i)&65535),a=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=a>>>16,t&=65535,a&=65535,n[i]=a<<16|t}return new o(n,n[n.length-1]&-2147483648?-1:0)};function ee(e,t){return e.add(g(t))}e.j=function(e){if(m(this)||m(e))return d;if(h(this))return h(e)?g(this).j(g(e)):g(g(this).j(e));if(h(e))return g(this.j(g(e)));if(this.l(p)<0&&e.l(p)<0)return l(this.m()*e.m());let t=this.g.length+e.g.length,n=[];for(var r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(let t=0;t<e.g.length;t++){let i=this.i(r)>>>16,a=this.i(r)&65535,o=e.i(t)>>>16,s=e.i(t)&65535;n[2*r+2*t]+=a*s,te(n,2*r+2*t),n[2*r+2*t+1]+=i*s,te(n,2*r+2*t+1),n[2*r+2*t+1]+=a*o,te(n,2*r+2*t+1),n[2*r+2*t+2]+=i*o,te(n,2*r+2*t+2)}for(e=0;e<t;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;e<2*t;e++)n[e]=0;return new o(n,0)};function te(e,t){for(;(e[t]&65535)!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function ne(e,t){this.g=e,this.h=t}function re(e,t){if(m(t))throw Error(`division by zero`);if(m(e))return new ne(d,d);if(h(e))return t=re(g(e),t),new ne(g(t.g),g(t.h));if(h(t))return t=re(e,g(t)),new ne(g(t.g),t.h);if(e.g.length>30){if(h(e)||h(t))throw Error(`slowDivide_ only works with positive integers.`);for(var n=f,r=t;r.l(e)<=0;)n=ie(n),r=ie(r);var i=ae(n,1),a=ae(r,1);for(r=ae(r,2),n=ae(n,2);!m(r);){var o=a.add(r);o.l(e)<=0&&(i=i.add(n),a=o),r=ae(r,1),n=ae(n,1)}return t=ee(e,i.j(t)),new ne(i,t)}for(i=d;e.l(t)>=0;){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=Math.ceil(Math.log(n)/Math.LN2),r=r<=48?1:2**(r-48),a=l(n),o=a.j(t);h(o)||o.l(e)>0;)n-=r,a=l(n),o=a.j(t);m(a)&&(a=f),i=i.add(a),e=ee(e,o)}return new ne(i,e)}e.B=function(e){return re(this,e).h},e.and=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new o(n,this.h&e.h)},e.or=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new o(n,this.h|e.h)},e.xor=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new o(n,this.h^e.h)};function ie(e){let t=e.g.length+1,n=[];for(let r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new o(n,e.h)}function ae(e,t){let n=t>>5;t%=32;let r=e.g.length-n,i=[];for(let a=0;a<r;a++)i[a]=t>0?e.i(a+n)>>>t|e.i(a+n+1)<<32-t:e.i(a+n);return new o(i,e.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,mn=fn.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=l,o.fromString=u,pn=fn.Integer=o}).apply(dn===void 0?typeof self<`u`?self:typeof window<`u`?window:{}:dn);var hn=typeof globalThis<`u`?globalThis:typeof window<`u`?window:typeof global<`u`?global:typeof self<`u`?self:{},gn={},_n,vn,yn,bn,xn,Sn,Cn,wn;(function(){var e,t=Object.defineProperty;function n(e){e=[typeof globalThis==`object`&&globalThis,e,typeof window==`object`&&window,typeof self==`object`&&self,typeof hn==`object`&&hn];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error(`Cannot find global object`)}var r=n(this);function i(e,n){if(n)a:{var i=r;e=e.split(`.`);for(var a=0;a<e.length-1;a++){var o=e[a];if(!(o in i))break a;i=i[o]}e=e[e.length-1],a=i[e],n=n(a),n!=a&&n!=null&&t(i,e,{configurable:!0,writable:!0,value:n})}}i(`Symbol.dispose`,function(e){return e||Symbol(`Symbol.dispose`)}),i(`Array.prototype.values`,function(e){return e||function(){return this[Symbol.iterator]()}}),i(`Object.entries`,function(e){return e||function(e){var t=[],n;for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push([n,e[n]]);return t}});var a=a||{},o=this||self;function s(e){var t=typeof e;return t==`object`&&e!=null||t==`function`}function c(e,t,n){return e.call.apply(e.bind,arguments)}function l(e,t,n){return l=c,l.apply(null,arguments)}function u(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function d(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,r){for(var i=Array(arguments.length-2),a=2;a<arguments.length;a++)i[a-2]=arguments[a];return t.prototype[n].apply(e,i)}}var f=typeof AsyncContext<`u`&&typeof AsyncContext.Snapshot==`function`?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function p(e){let t=e.length;if(t>0){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function m(e,t){for(let t=1;t<arguments.length;t++){let r=arguments[t];var n=typeof r;if(n=n==`object`?r?Array.isArray(r)?`array`:n:`null`:n,n==`array`||n==`object`&&typeof r.length==`number`){n=e.length||0;let t=r.length||0;e.length=n+t;for(let i=0;i<t;i++)e[n+i]=r[i]}else e.push(r)}}class h{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function g(e){o.setTimeout(()=>{throw e},0)}function ee(){var e=oe;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}class te{constructor(){this.h=this.g=null}add(e,t){let n=ne.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}}var ne=new h(()=>new re,e=>e.reset());class re{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let ie,ae=!1,oe=new te,se=()=>{let e=Promise.resolve(void 0);ie=()=>{e.then(ce)}};function ce(){for(var e;e=ee();){try{e.h.call(e.g)}catch(e){g(e)}var t=ne;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}ae=!1}function _(){this.u=this.u,this.C=this.C}_.prototype.u=!1,_.prototype.dispose=function(){this.u||(this.u=!0,this.N())},_.prototype[Symbol.dispose]=function(){this.dispose()},_.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function v(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}v.prototype.h=function(){this.defaultPrevented=!0};var le=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},`passive`,{get:function(){e=!0}});try{let e=()=>{};o.addEventListener(`test`,e,t),o.removeEventListener(`test`,e,t)}catch{}return e}();function ue(e){return/^[\s\xa0]*$/.test(e)}function de(e,t){v.call(this,e?e.type:``),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key=``,this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType=``,this.i=null,e&&this.init(e,t)}d(de,v),de.prototype.init=function(e,t){let n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget,t||(n==`mouseover`?t=e.fromElement:n==`mouseout`&&(t=e.toElement)),this.relatedTarget=t,r?(this.clientX=r.clientX===void 0?r.pageX:r.clientX,this.clientY=r.clientY===void 0?r.pageY:r.clientY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=e.clientX===void 0?e.pageX:e.clientX,this.clientY=e.clientY===void 0?e.pageY:e.clientY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||``,this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&de.Z.h.call(this)},de.prototype.h=function(){de.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var fe=`closure_listenable_`+(Math.random()*1e6|0),pe=0;function me(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++pe,this.da=this.fa=!1}function he(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function ge(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function _e(e,t){for(let n in e)t.call(void 0,e[n],n,e)}function ve(e){let t={};for(let n in e)t[n]=e[n];return t}let ye=`constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf`.split(` `);function be(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<ye.length;t++)n=ye[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function xe(e){this.src=e,this.g={},this.h=0}xe.prototype.add=function(e,t,n,r,i){let a=e.toString();e=this.g[a],e||(e=this.g[a]=[],this.h++);let o=Ce(e,t,r,i);return o>-1?(t=e[o],n||(t.fa=!1)):(t=new me(t,this.src,a,!!r,i),t.fa=n,e.push(t)),t};function Se(e,t){let n=t.type;if(n in e.g){var r=e.g[n],i=Array.prototype.indexOf.call(r,t,void 0),a;(a=i>=0)&&Array.prototype.splice.call(r,i,1),a&&(he(t),e.g[n].length==0&&(delete e.g[n],e.h--))}}function Ce(e,t,n,r){for(let i=0;i<e.length;++i){let a=e[i];if(!a.da&&a.listener==t&&a.capture==!!n&&a.ha==r)return i}return-1}var we=`closure_lm_`+(Math.random()*1e6|0),Te={};function Ee(e,t,n,r,i){if(r&&r.once)return ke(e,t,n,r,i);if(Array.isArray(t)){for(let a=0;a<t.length;a++)Ee(e,t[a],n,r,i);return null}return n=Fe(n),e&&e[fe]?e.J(t,n,s(r)?!!r.capture:!!r,i):De(e,t,n,!1,r,i)}function De(e,t,n,r,i,a){if(!t)throw Error(`Invalid event type`);let o=s(i)?!!i.capture:!!i,c=Ne(e);if(c||(e[we]=c=new xe(e)),n=c.add(t,n,r,o,a),n.proxy)return n;if(r=Oe(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)le||(i=o),i===void 0&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(y(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error(`addEventListener and attachEvent are unavailable.`);return n}function Oe(){function e(n){return t.call(e.src,e.listener,n)}let t=Me;return e}function ke(e,t,n,r,i){if(Array.isArray(t)){for(let a=0;a<t.length;a++)ke(e,t[a],n,r,i);return null}return n=Fe(n),e&&e[fe]?e.K(t,n,s(r)?!!r.capture:!!r,i):De(e,t,n,!0,r,i)}function Ae(e,t,n,r,i){if(Array.isArray(t))for(var a=0;a<t.length;a++)Ae(e,t[a],n,r,i);else r=s(r)?!!r.capture:!!r,n=Fe(n),e&&e[fe]?(e=e.i,a=String(t).toString(),a in e.g&&(t=e.g[a],n=Ce(t,n,r,i),n>-1&&(he(t[n]),Array.prototype.splice.call(t,n,1),t.length==0&&(delete e.g[a],e.h--)))):(e&&=Ne(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Ce(t,n,r,i)),(n=e>-1?t[e]:null)&&je(n))}function je(e){if(typeof e!=`number`&&e&&!e.da){var t=e.src;if(t&&t[fe])Se(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(y(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Ne(t))?(Se(n,e),n.h==0&&(n.src=null,t[we]=null)):he(e)}}}function y(e){return e in Te?Te[e]:Te[e]=`on`+e}function Me(e,t){if(e.da)e=!0;else{t=new de(t,this);let n=e.listener,r=e.ha||e.src;e.fa&&je(e),e=n.call(r,t)}return e}function Ne(e){return e=e[we],e instanceof xe?e:null}var Pe=`__closure_events_fn_`+(Math.random()*1e9>>>0);function Fe(e){return typeof e==`function`?e:(e[Pe]||(e[Pe]=function(t){return e.handleEvent(t)}),e[Pe])}function b(){_.call(this),this.i=new xe(this),this.M=this,this.G=null}d(b,_),b.prototype[fe]=!0,b.prototype.removeEventListener=function(e,t,n,r){Ae(this,e,t,n,r)};function x(e,t){var n,r=e.G;if(r)for(n=[];r;r=r.G)n.push(r);if(e=e.M,r=t.type||t,typeof t==`string`)t=new v(t,e);else if(t instanceof v)t.target=t.target||e;else{var i=t;t=new v(r,e),be(t,i)}i=!0;let a,o;if(n)for(o=n.length-1;o>=0;o--)a=t.g=n[o],i=Ie(a,r,!0,t)&&i;if(a=t.g=e,i=Ie(a,r,!0,t)&&i,i=Ie(a,r,!1,t)&&i,n)for(o=0;o<n.length;o++)a=t.g=n[o],i=Ie(a,r,!1,t)&&i}b.prototype.N=function(){if(b.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let n=e.g[t];for(let e=0;e<n.length;e++)he(n[e]);delete e.g[t],e.h--}}this.G=null},b.prototype.J=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},b.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};function Ie(e,t,n,r){if(t=e.i.g[String(t)],!t)return!0;t=t.concat();let i=!0;for(let a=0;a<t.length;++a){let o=t[a];if(o&&!o.da&&o.capture==n){let t=o.listener,n=o.ha||o.src;o.fa&&Se(e.i,o),i=t.call(n,r)!==!1&&i}}return i&&!r.defaultPrevented}function Le(e,t){if(typeof e!=`function`)if(e&&typeof e.handleEvent==`function`)e=l(e.handleEvent,e);else throw Error(`Invalid listener argument`);return Number(t)>2147483647?-1:o.setTimeout(e,t||0)}function Re(e){e.g=Le(()=>{e.g=null,e.i&&(e.i=!1,Re(e))},e.l);let t=e.h;e.h=null,e.m.apply(null,t)}class ze extends _{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:Re(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Be(e){_.call(this),this.h=e,this.g={}}d(Be,_);var Ve=[];function He(e){ge(e.g,function(e,t){this.g.hasOwnProperty(t)&&je(e)},e),e.g={}}Be.prototype.N=function(){Be.Z.N.call(this),He(this)},Be.prototype.handleEvent=function(){throw Error(`EventHandler.handleEvent not implemented`)};var Ue=o.JSON.stringify,We=o.JSON.parse,Ge=class{stringify(e){return o.JSON.stringify(e,void 0)}parse(e){return o.JSON.parse(e,void 0)}};function Ke(){}function qe(){}var Je={OPEN:`a`,hb:`b`,ERROR:`c`,tb:`d`};function Ye(){v.call(this,`d`)}d(Ye,v);function Xe(){v.call(this,`c`)}d(Xe,v);var S={},Ze=null;function Qe(){return Ze||=new b}S.Ia=`serverreachability`;function $e(e){v.call(this,S.Ia,e)}d($e,v);function et(e){let t=Qe();x(t,new $e(t))}S.STAT_EVENT=`statevent`;function tt(e,t){v.call(this,S.STAT_EVENT,e),this.stat=t}d(tt,v);function C(e){let t=Qe();x(t,new tt(t,e))}S.Ja=`timingevent`;function nt(e,t){v.call(this,S.Ja,e),this.size=t}d(nt,v);function rt(e,t){if(typeof e!=`function`)throw Error(`Fn must not be null and must be a function`);return o.setTimeout(function(){e()},t)}function it(){this.g=!0}it.prototype.ua=function(){this.g=!1};function at(e,t,n,r,i,a){e.info(function(){if(e.g)if(a){var o=``,s=a.split(`&`);for(let e=0;e<s.length;e++){var c=s[e].split(`=`);if(c.length>1){let e=c[0];c=c[1];let t=e.split(`_`);o=t.length>=2&&t[1]==`type`?o+(e+`=`+c+`&`):o+(e+`=redacted&`)}}}else o=null;else o=a;return`XMLHTTP REQ (`+r+`) [attempt `+i+`]: `+t+`
`+n+`
`+o})}function ot(e,t,n,r,i,a,o){e.info(function(){return`XMLHTTP RESP (`+r+`) [ attempt `+i+`]: `+t+`
`+n+`
`+a+` `+o})}function st(e,t,n,r){e.info(function(){return`XMLHTTP TEXT (`+t+`): `+lt(e,n)+(r?` `+r:``)})}function ct(e,t){e.info(function(){return`TIMEOUT: `+t})}it.prototype.info=function(){};function lt(e,t){if(!e.g)return t;if(!t)return null;try{let a=JSON.parse(t);if(a){for(e=0;e<a.length;e++)if(Array.isArray(a[e])){var n=a[e];if(!(n.length<2)){var r=n[1];if(Array.isArray(r)&&!(r.length<1)){var i=r[0];if(i!=`noop`&&i!=`stop`&&i!=`close`)for(let e=1;e<r.length;e++)r[e]=``}}}}return Ue(a)}catch{return t}}var ut={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},dt={ib:`complete`,Fb:`success`,ERROR:`error`,Ga:`abort`,xb:`ready`,yb:`readystatechange`,TIMEOUT:`timeout`,sb:`incrementaldata`,wb:`progress`,lb:`downloadprogress`,Nb:`uploadprogress`},ft;function pt(){}d(pt,Ke),pt.prototype.g=function(){return new XMLHttpRequest},ft=new pt;function mt(e){return encodeURIComponent(String(e))}function ht(e){var t=1;e=e.split(`:`);let n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(`:`)),n}function gt(e,t,n,r){this.j=e,this.i=t,this.l=n,this.S=r||1,this.V=new Be(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new _t}function _t(){this.i=null,this.g=``,this.h=!1}var vt={},yt={};function bt(e,t,n){e.M=1,e.A=Gt(Ht(t)),e.u=n,e.R=!0,xt(e,null)}function xt(e,t){e.F=Date.now(),Tt(e),e.B=Ht(e.A);var n=e.B,r=e.S;Array.isArray(r)||(r=[String(r)]),on(n.i,`t`,r),e.C=0,n=e.j.L,e.h=new _t,e.g=Zn(e.j,n?t:null,!e.u),e.P>0&&(e.O=new ze(l(e.Y,e,e.g),e.P)),t=e.V,n=e.g,r=e.ba;var i=`readystatechange`;Array.isArray(i)||(i&&(Ve[0]=i.toString()),i=Ve);for(let e=0;e<i.length;e++){let a=Ee(n,i[e],r||t.handleEvent,!1,t.h||t);if(!a)break;t.g[a.key]=a}t=e.J?ve(e.J):{},e.u?(e.v||=`POST`,t[`Content-Type`]=`application/x-www-form-urlencoded`,e.g.ea(e.B,e.v,e.u,t)):(e.v=`GET`,e.g.ea(e.B,e.v,null,t)),et(),at(e.i,e.v,e.B,e.l,e.S,e.u)}gt.prototype.ba=function(e){e=e.target;let t=this.O;t&&A(e)==3?t.j():this.Y(e)},gt.prototype.Y=function(e){try{if(e==this.g)a:{let s=A(this.g),c=this.g.ya(),l=this.g.ca();if(!(s<3)&&(s!=3||this.g&&(this.h.h||this.g.la()||j(this.g)))){this.K||s!=4||c==7||et(c==8||l<=0?3:2),Dt(this);var t=this.g.ca();this.X=t;var n=St(this);if(this.o=t==200,ot(this.i,this.v,this.B,this.l,this.S,s,t),this.o){if(this.U&&!this.L){b:{if(this.g){var r,i=this.g;if((r=i.g?i.g.getResponseHeader(`X-HTTP-Initial-Response`):null)&&!ue(r)){var a=r;break b}}a=null}if(e=a)st(this.i,this.l,e,`Initial handshake response via X-HTTP-Initial-Response`),this.L=!0,At(this,e);else{this.o=!1,this.m=3,C(12),kt(this),Ot(this);break a}}if(this.R){e=!0;let t;for(;!this.K&&this.C<n.length;)if(t=wt(this,n),t==yt){s==4&&(this.m=4,C(14),e=!1),st(this.i,this.l,null,`[Incomplete Response]`);break}else if(t==vt){this.m=4,C(15),st(this.i,this.l,n,`[Invalid Chunk]`),e=!1;break}else st(this.i,this.l,t,null),At(this,t);if(Ct(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),s!=4||n.length!=0||this.h.h||(this.m=1,C(16),e=!1),this.o=this.o&&e,!e)st(this.i,this.l,n,`[Invalid Chunked Response]`),kt(this),Ot(this);else if(n.length>0&&!this.W){this.W=!0;var o=this.j;o.g==this&&o.aa&&!o.P&&(o.j.info(`Great, no buffering proxy detected. Bytes received: `+n.length),Wn(o),o.P=!0,C(11))}}else st(this.i,this.l,n,null),At(this,n);s==4&&kt(this),this.o&&!this.K&&(s==4?qn(this.j,this):(this.o=!1,Tt(this)))}else M(this.g),t==400&&n.indexOf(`Unknown SID`)>0?(this.m=3,C(12)):(this.m=0,C(13)),kt(this),Ot(this)}}}catch{}};function St(e){if(!Ct(e))return e.g.la();let t=j(e.g);if(t===``)return``;let n=``,r=t.length,i=A(e.g)==4;if(!e.h.i){if(typeof TextDecoder>`u`)return kt(e),Ot(e),``;e.h.i=new o.TextDecoder}for(let a=0;a<r;a++)e.h.h=!0,n+=e.h.i.decode(t[a],{stream:!(i&&a==r-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}function Ct(e){return e.g?e.v==`GET`&&e.M!=2&&e.j.Aa:!1}function wt(e,t){var n=e.C,r=t.indexOf(`
`,n);return r==-1?yt:(n=Number(t.substring(n,r)),isNaN(n)?vt:(r+=1,r+n>t.length?yt:(t=t.slice(r,r+n),e.C=r+n,t)))}gt.prototype.cancel=function(){this.K=!0,kt(this)};function Tt(e){e.T=Date.now()+e.H,Et(e,e.H)}function Et(e,t){if(e.D!=null)throw Error(`WatchDog timer not null`);e.D=rt(l(e.aa,e),t)}function Dt(e){e.D&&=(o.clearTimeout(e.D),null)}gt.prototype.aa=function(){this.D=null;let e=Date.now();e-this.T>=0?(ct(this.i,this.B),this.M!=2&&(et(),C(17)),kt(this),this.m=2,Ot(this)):Et(this,this.T-e)};function Ot(e){e.j.I==0||e.K||qn(e.j,e)}function kt(e){Dt(e);var t=e.O;t&&typeof t.dispose==`function`&&t.dispose(),e.O=null,He(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function At(e,t){try{var n=e.j;if(n.I!=0&&(n.g==e||Ft(n.h,e))){if(!e.L&&Ft(n.h,e)&&n.I==3){try{var r=n.Ba.g.parse(t)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){a:if(!n.v){if(n.g)if(n.g.F+3e3<e.F)Kn(n),In(n);else break a;P(n),C(18)}}else n.xa=i[1],0<n.xa-n.K&&i[2]<37500&&n.F&&n.A==0&&!n.C&&(n.C=rt(l(n.Va,n),6e3));Pt(n.h)<=1&&n.ta&&(n.ta=void 0)}else Yn(n,11)}else if((e.L||n.g==e)&&Kn(n),!ue(t))for(i=n.Ba.g.parse(t),t=0;t<i.length;t++){let l=i[t],u=l[0];if(!(u<=n.K))if(n.K=u,l=l[1],n.I==2)if(l[0]==`c`){n.M=l[1],n.ba=l[2];let t=l[3];t!=null&&(n.ka=t,n.j.info(`VER=`+n.ka));let i=l[4];i!=null&&(n.za=i,n.j.info(`SVER=`+n.za));let u=l[5];u!=null&&typeof u==`number`&&u>0&&(r=1.5*u,n.O=r,n.j.info(`backChannelRequestTimeoutMs_=`+r)),r=n;let d=e.g;if(d){let e=d.g?d.g.getResponseHeader(`X-Client-Wire-Protocol`):null;if(e){var a=r.h;a.g||e.indexOf(`spdy`)==-1&&e.indexOf(`quic`)==-1&&e.indexOf(`h2`)==-1||(a.j=a.l,a.g=new Set,a.h&&=(It(a,a.h),null))}if(r.G){let e=d.g?d.g.getResponseHeader(`X-HTTP-Session-Id`):null;e&&(r.wa=e,T(r.J,r.G,e))}}n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info(`Handshake RTT: `+n.T+`ms`)),r=n;var o=e;if(r.na=F(r,r.L?r.ba:null,r.W),o.L){Lt(r.h,o);var s=o,c=r.O;c&&(s.H=c),s.D&&(Dt(s),Tt(s)),r.g=o}else Un(r);n.i.length>0&&Rn(n)}else l[0]!=`stop`&&l[0]!=`close`||Yn(n,7);else n.I==3&&(l[0]==`stop`||l[0]==`close`?l[0]==`stop`?Yn(n,7):Fn(n):l[0]!=`noop`&&n.l&&n.l.qa(l),n.A=0)}}et(4)}catch{}}var jt=class{constructor(e,t){this.g=e,this.map=t}};function Mt(e){this.l=e||10,o.PerformanceNavigationTiming?(e=o.performance.getEntriesByType(`navigation`),e=e.length>0&&(e[0].nextHopProtocol==`hq`||e[0].nextHopProtocol==`h2`)):e=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Nt(e){return e.h?!0:e.g?e.g.size>=e.j:!1}function Pt(e){return e.h?1:e.g?e.g.size:0}function Ft(e,t){return e.h?e.h==t:e.g?e.g.has(t):!1}function It(e,t){e.g?e.g.add(t):e.h=t}function Lt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}Mt.prototype.cancel=function(){if(this.i=Rt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let e of this.g.values())e.cancel();this.g.clear()}};function Rt(e){if(e.h!=null)return e.i.concat(e.h.G);if(e.g!=null&&e.g.size!==0){let t=e.i;for(let n of e.g.values())t=t.concat(n.G);return t}return p(e.i)}var zt=RegExp(`^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$`);function Bt(e,t){if(e){e=e.split(`&`);for(let n=0;n<e.length;n++){let r=e[n].indexOf(`=`),i,a=null;r>=0?(i=e[n].substring(0,r),a=e[n].substring(r+1)):i=e[n],t(i,a?decodeURIComponent(a.replace(/\+/g,` `)):``)}}}function Vt(e){this.g=this.o=this.j=``,this.u=null,this.m=this.h=``,this.l=!1;let t;e instanceof Vt?(this.l=e.l,w(this,e.j),this.o=e.o,this.g=e.g,Ut(this,e.u),this.h=e.h,Wt(this,sn(e.i)),this.m=e.m):e&&(t=String(e).match(zt))?(this.l=!1,w(this,t[1]||``,!0),this.o=Kt(t[2]||``),this.g=Kt(t[3]||``,!0),Ut(this,t[4]),this.h=Kt(t[5]||``,!0),Wt(this,t[6]||``,!0),this.m=Kt(t[7]||``)):(this.l=!1,this.i=new en(null,this.l))}Vt.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(qt(t,Yt,!0),`:`);var n=this.g;return(n||t==`file`)&&(e.push(`//`),(t=this.o)&&e.push(qt(t,Yt,!0),`@`),e.push(mt(n).replace(/%25([0-9a-fA-F]{2})/g,`%$1`)),n=this.u,n!=null&&e.push(`:`,String(n))),(n=this.h)&&(this.g&&n.charAt(0)!=`/`&&e.push(`/`),e.push(qt(n,n.charAt(0)==`/`?Zt:Xt,!0))),(n=this.i.toString())&&e.push(`?`,n),(n=this.m)&&e.push(`#`,qt(n,$t)),e.join(``)},Vt.prototype.resolve=function(e){let t=Ht(this),n=!!e.j;n?w(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=e.u!=null;var r=e.h;if(n)Ut(t,e.u);else if(n=!!e.h){if(r.charAt(0)!=`/`)if(this.g&&!this.h)r=`/`+r;else{var i=t.h.lastIndexOf(`/`);i!=-1&&(r=t.h.slice(0,i+1)+r)}if(i=r,i==`..`||i==`.`)r=``;else if(i.indexOf(`./`)!=-1||i.indexOf(`/.`)!=-1){r=i.lastIndexOf(`/`,0)==0,i=i.split(`/`);let e=[];for(let t=0;t<i.length;){let n=i[t++];n==`.`?r&&t==i.length&&e.push(``):n==`..`?((e.length>1||e.length==1&&e[0]!=``)&&e.pop(),r&&t==i.length&&e.push(``)):(e.push(n),r=!0)}r=e.join(`/`)}else r=i}return n?t.h=r:n=e.i.toString()!==``,n?Wt(t,sn(e.i)):n=!!e.m,n&&(t.m=e.m),t};function Ht(e){return new Vt(e)}function w(e,t,n){e.j=n?Kt(t,!0):t,e.j&&=e.j.replace(/:$/,``)}function Ut(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error(`Bad port number `+t);e.u=t}else e.u=null}function Wt(e,t,n){t instanceof en?(e.i=t,ln(e.i,e.l)):(n||(t=qt(t,Qt)),e.i=new en(t,e.l))}function T(e,t,n){e.i.set(t,n)}function Gt(e){return T(e,`zx`,Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),e}function Kt(e,t){return e?t?decodeURI(e.replace(/%25/g,`%2525`)):decodeURIComponent(e):``}function qt(e,t,n){return typeof e==`string`?(e=encodeURI(e).replace(t,Jt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,`%$1`)),e):null}function Jt(e){return e=e.charCodeAt(0),`%`+(e>>4&15).toString(16)+(e&15).toString(16)}var Yt=/[#\/\?@]/g,Xt=/[#\?:]/g,Zt=/[#\?]/g,Qt=/[#\?@]/g,$t=/#/g;function en(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function tn(e){e.g||(e.g=new Map,e.h=0,e.i&&Bt(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g,` `)),n)}))}e=en.prototype,e.add=function(e,t){tn(this),this.i=null,e=cn(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this};function nn(e,t){tn(e),t=cn(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function rn(e,t){return tn(e),t=cn(e,t),e.g.has(t)}e.forEach=function(e,t){tn(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)};function an(e,t){tn(e);let n=[];if(typeof t==`string`)rn(e,t)&&(n=n.concat(e.g.get(cn(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}e.set=function(e,t){return tn(this),this.i=null,e=cn(this,e),rn(this,e)&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e?(e=an(this,e),e.length>0?String(e[0]):t):t};function on(e,t,n){nn(e,t),n.length>0&&(e.i=null,e.g.set(cn(e,t),p(n)),e.h+=n.length)}e.toString=function(){if(this.i)return this.i;if(!this.g)return``;let e=[],t=Array.from(this.g.keys());for(let r=0;r<t.length;r++){var n=t[r];let i=mt(n);n=an(this,n);for(let t=0;t<n.length;t++){let r=i;n[t]!==``&&(r+=`=`+mt(n[t])),e.push(r)}}return this.i=e.join(`&`)};function sn(e){let t=new en;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function cn(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function ln(e,t){t&&!e.j&&(tn(e),e.i=null,e.g.forEach(function(e,t){let n=t.toLowerCase();t!=n&&(nn(this,t),on(this,n,e))},e)),e.j=t}function un(e,t){let n=new it;if(o.Image){let r=new Image;r.onload=u(fn,n,`TestLoadImage: loaded`,!0,t,r),r.onerror=u(fn,n,`TestLoadImage: error`,!1,t,r),r.onabort=u(fn,n,`TestLoadImage: abort`,!1,t,r),r.ontimeout=u(fn,n,`TestLoadImage: timeout`,!1,t,r),o.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}function dn(e,t){let n=new it,r=new AbortController,i=setTimeout(()=>{r.abort(),fn(n,`TestPingServer: timeout`,!1,t)},1e4);fetch(e,{signal:r.signal}).then(e=>{clearTimeout(i),e.ok?fn(n,`TestPingServer: ok`,!0,t):fn(n,`TestPingServer: server error`,!1,t)}).catch(()=>{clearTimeout(i),fn(n,`TestPingServer: error`,!1,t)})}function fn(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch{}}function pn(){this.g=new Ge}function mn(e){this.i=e.Sb||null,this.h=e.ab||!1}d(mn,Ke),mn.prototype.g=function(){return new Tn(this.i,this.h)};function Tn(e,t){b.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText=``,this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F=`GET`,this.D=``,this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}d(Tn,b),e=Tn.prototype,e.open=function(e,t){if(this.readyState!=0)throw this.abort(),Error(`Error reopening a connection`);this.F=e,this.D=t,this.readyState=1,Dn(this)},e.send=function(e){if(this.readyState!=1)throw this.abort(),Error(`need to call open() first. `);if(this.v.signal.aborted)throw this.abort(),Error(`Request was aborted.`);this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||o).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText=``,this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel(`Request was aborted.`).catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,E(this)),this.readyState=0},e.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Dn(this)),this.g&&(this.readyState=3,Dn(this),this.g)))if(this.responseType===`arraybuffer`)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(o.ReadableStream!==void 0&&`body`in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error(`responseType must be empty for "streamBinaryChunks" mode responses.`);this.response=[]}else this.response=this.responseText=``,this.B=new TextDecoder;En(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))};function En(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}e.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array;(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?E(this):Dn(this),this.readyState==3&&En(this)}},e.Oa=function(e){this.g&&(this.response=this.responseText=e,E(this))},e.Na=function(e){this.g&&(this.response=e,E(this))},e.ga=function(){this.g&&E(this)};function E(e){e.readyState=4,e.l=null,e.j=null,e.B=null,Dn(e)}e.setRequestHeader=function(e,t){this.A.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||``},e.getAllResponseHeaders=function(){if(!this.h)return``;let e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+`: `+n[1]),n=t.next();return e.join(`\r
`)};function Dn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}Object.defineProperty(Tn.prototype,`withCredentials`,{get:function(){return this.m===`include`},set:function(e){this.m=e?`include`:`same-origin`}});function On(e){let t=``;return ge(e,function(e,n){t+=n,t+=`:`,t+=e,t+=`\r
`}),t}function kn(e,t,n){a:{for(r in n){var r=!1;break a}r=!0}r||(n=On(n),typeof e==`string`||T(e,t,n))}function D(e){b.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D=``,this.o=0,this.l=``,this.j=this.B=this.v=this.A=!1,this.m=null,this.F=``,this.H=!1}d(D,b);var An=/^https?$/i,jn=[`POST`,`PUT`];e=D.prototype,e.Fa=function(e){this.H=e},e.ea=function(e,t,n,r){if(this.g)throw Error(`[goog.net.XhrIo] Object is active with another request=`+this.D+`; newUri=`+e);t=t?t.toUpperCase():`GET`,this.D=e,this.l=``,this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():ft.g(),this.g.onreadystatechange=f(l(this.Ca,this));try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){Mn(this,e);return}if(e=n||``,n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else if(typeof r.keys==`function`&&typeof r.get==`function`)for(let e of r.keys())n.set(e,r.get(e));else throw Error(`Unknown input type for opt_headers: `+String(r));r=Array.from(n.keys()).find(e=>e.toLowerCase()==`content-type`),i=o.FormData&&e instanceof o.FormData,!(Array.prototype.indexOf.call(jn,t,void 0)>=0)||r||i||n.set(`Content-Type`,`application/x-www-form-urlencoded;charset=utf-8`);for(let[e,t]of n)this.g.setRequestHeader(e,t);this.F&&(this.g.responseType=this.F),`withCredentials`in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&=(clearTimeout(this.m),null),this.v=!0,this.g.send(e),this.v=!1}catch(e){Mn(this,e)}};function Mn(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,O(e),k(e)}function O(e){e.A||(e.A=!0,x(e,`complete`),x(e,`error`))}e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,x(this,`complete`),x(this,`abort`),k(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),k(this,!0)),D.Z.N.call(this)},e.Ca=function(){this.u||(this.B||this.v||this.j?Nn(this):this.Xa())},e.Xa=function(){Nn(this)};function Nn(e){if(e.h&&a!==void 0){if(e.v&&A(e)==4)setTimeout(e.Ca.bind(e),0);else if(x(e,`readystatechange`),A(e)==4){e.h=!1;try{let a=e.ca();a:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break a;default:t=!1}var n;if(!(n=t)){var r;if(r=a===0){let t=String(e.D).match(zt)[1]||null;!t&&o.self&&o.self.location&&(t=o.self.location.protocol.slice(0,-1)),r=!An.test(t?t.toLowerCase():``)}n=r}if(n)x(e,`complete`),x(e,`success`);else{e.o=6;try{var i=A(e)>2?e.g.statusText:``}catch{i=``}e.l=i+` [`+e.ca()+`]`,O(e)}}finally{k(e)}}}}function k(e,t){if(e.g){e.m&&=(clearTimeout(e.m),null);let n=e.g;e.g=null,t||x(e,`ready`);try{n.onreadystatechange=null}catch{}}}e.isActive=function(){return!!this.g};function A(e){return e.g?e.g.readyState:0}e.ca=function(){try{return A(this)>2?this.g.status:-1}catch{return-1}},e.la=function(){try{return this.g?this.g.responseText:``}catch{return``}},e.La=function(e){if(this.g){var t=this.g.responseText;return e&&t.indexOf(e)==0&&(t=t.substring(e.length)),We(t)}};function j(e){try{if(!e.g)return null;if(`response`in e.g)return e.g.response;switch(e.F){case``:case`text`:return e.g.responseText;case`arraybuffer`:if(`mozResponseArrayBuffer`in e.g)return e.g.mozResponseArrayBuffer}return null}catch{return null}}function M(e){let t={};e=(e.g&&A(e)>=2&&e.g.getAllResponseHeaders()||``).split(`\r
`);for(let r=0;r<e.length;r++){if(ue(e[r]))continue;var n=ht(e[r]);let i=n[0];if(n=n[1],typeof n!=`string`)continue;n=n.trim();let a=t[i]||[];t[i]=a,a.push(n)}_e(t,function(e){return e.join(`, `)})}e.ya=function(){return this.o},e.Ha=function(){return typeof this.l==`string`?this.l:String(this.l)};function N(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Pn(e){this.za=0,this.i=[],this.j=new it,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=N(`failFast`,!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=N(`baseRetryDelayMs`,5e3,e),this.Za=N(`retryDelaySeedMs`,1e4,e),this.Ta=N(`forwardChannelMaxRetries`,2,e),this.va=N(`forwardChannelRequestTimeoutMs`,2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M=``,this.h=new Mt(e&&e.concurrentRequestLimit),this.Ba=new pn,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}e=Pn.prototype,e.ka=8,e.I=1,e.connect=function(e,t,n,r){C(0),this.W=e,this.H=t||{},n&&r!==void 0&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.J=F(this,null,this.W),Rn(this)};function Fn(e){if(Ln(e),e.I==3){var t=e.V++,n=Ht(e.J);if(T(n,`SID`,e.M),T(n,`RID`,t),T(n,`TYPE`,`terminate`),Vn(e,n),t=new gt(e,e.j,t),t.M=2,t.A=Gt(Ht(n)),n=!1,o.navigator&&o.navigator.sendBeacon)try{n=o.navigator.sendBeacon(t.A.toString(),``)}catch{}!n&&o.Image&&(new Image().src=t.A,n=!0),n||(t.g=Zn(t.j,null),t.g.ea(t.A)),t.F=Date.now(),Tt(t)}Xn(e)}function In(e){e.g&&=(Wn(e),e.g.cancel(),null)}function Ln(e){In(e),e.v&&=(o.clearTimeout(e.v),null),Kn(e),e.h.cancel(),e.m&&=(typeof e.m==`number`&&o.clearTimeout(e.m),null)}function Rn(e){if(!Nt(e.h)&&!e.m){e.m=!0;var t=e.Ea;ie||se(),ae||=(ie(),!0),oe.add(t,e),e.D=0}}function zn(e,t){return Pt(e.h)>=e.h.j-(e.m?1:0)?!1:e.m?(e.i=t.G.concat(e.i),!0):e.I==1||e.I==2||e.D>=(e.Sa?0:e.Ta)?!1:(e.m=rt(l(e.Ea,e,t),Jn(e,e.D)),e.D++,!0)}e.Ea=function(e){if(this.m)if(this.m=null,this.I==1){if(!e){this.V=Math.floor(Math.random()*1e5),e=this.V++;let i=new gt(this,this.j,e),a=this.o;if(this.U&&(a?(a=ve(a),be(a,this.U)):a=this.U),this.u!==null||this.R||(i.J=a,a=null),this.S)a:{for(var t=0,n=0;n<this.i.length;n++){b:{var r=this.i[n];if(`__data__`in r.map&&(r=r.map.__data__,typeof r==`string`)){r=r.length;break b}r=void 0}if(r===void 0)break;if(t+=r,t>4096){t=n;break a}if(t===4096||n===this.i.length-1){t=n+1;break a}}t=1e3}else t=1e3;t=Hn(this,i,t),n=Ht(this.J),T(n,`RID`,e),T(n,`CVER`,22),this.G&&T(n,`X-HTTP-Session-Id`,this.G),Vn(this,n),a&&(this.R?t=`headers=`+mt(On(a))+`&`+t:this.u&&kn(n,this.u,a)),It(this.h,i),this.Ra&&T(n,`TYPE`,`init`),this.S?(T(n,`$req`,t),T(n,`SID`,`null`),i.U=!0,bt(i,n,null)):bt(i,n,t),this.I=2}}else this.I==3&&(e?Bn(this,e):this.i.length==0||Nt(this.h)||Bn(this))};function Bn(e,t){var n=t?t.l:e.V++;let r=Ht(e.J);T(r,`SID`,e.M),T(r,`RID`,n),T(r,`AID`,e.K),Vn(e,r),e.u&&e.o&&kn(r,e.u,e.o),n=new gt(e,e.j,n,e.D+1),e.u===null&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=Hn(e,n,1e3),n.H=Math.round(e.va*.5)+Math.round(e.va*.5*Math.random()),It(e.h,n),bt(n,r,t)}function Vn(e,t){e.H&&ge(e.H,function(e,n){T(t,n,e)}),e.l&&ge({},function(e,n){T(t,n,e)})}function Hn(e,t,n){n=Math.min(e.i.length,n);let r=e.l?l(e.l.Ka,e.l,e):null;a:{var i=e.i;let t=-1;for(;;){let e=[`count=`+n];t==-1?n>0?(t=i[0].g,e.push(`ofs=`+t)):t=0:e.push(`ofs=`+t);let c=!0;for(let l=0;l<n;l++){var a=i[l].g;let n=i[l].map;if(a-=t,a<0)t=Math.max(0,i[l].g-100),c=!1;else try{a=`req`+a+`_`||``;try{var o=n instanceof Map?n:Object.entries(n);for(let[t,n]of o){let r=n;s(n)&&(r=Ue(n)),e.push(a+t+`=`+encodeURIComponent(r))}}catch(t){throw e.push(a+`type=_badmap`),t}}catch{r&&r(n)}}if(c){o=e.join(`&`);break a}}o=void 0}return e=e.i.splice(0,n),t.G=e,o}function Un(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;ie||se(),ae||=(ie(),!0),oe.add(t,e),e.A=0}}function P(e){return e.g||e.v||e.A>=3?!1:(e.Y++,e.v=rt(l(e.Da,e),Jn(e,e.A)),e.A++,!0)}e.Da=function(){if(this.v=null,Gn(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var e=4*this.T;this.j.info(`BP detection timer enabled: `+e),this.B=rt(l(this.Wa,this),e)}},e.Wa=function(){this.B&&(this.B=null,this.j.info(`BP detection timeout reached.`),this.j.info(`Buffering proxy detected and switch to long-polling!`),this.F=!1,this.P=!0,C(10),In(this),Gn(this))};function Wn(e){e.B!=null&&(o.clearTimeout(e.B),e.B=null)}function Gn(e){e.g=new gt(e,e.j,`rpc`,e.Y),e.u===null&&(e.g.J=e.o),e.g.P=0;var t=Ht(e.na);T(t,`RID`,`rpc`),T(t,`SID`,e.M),T(t,`AID`,e.K),T(t,`CI`,e.F?`0`:`1`),!e.F&&e.ia&&T(t,`TO`,e.ia),T(t,`TYPE`,`xmlhttp`),Vn(e,t),e.u&&e.o&&kn(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=Gt(Ht(t)),n.u=null,n.R=!0,xt(n,e)}e.Va=function(){this.C!=null&&(this.C=null,In(this),P(this),C(19))};function Kn(e){e.C!=null&&(o.clearTimeout(e.C),e.C=null)}function qn(e,t){var n=null;if(e.g==t){Kn(e),Wn(e),e.g=null;var r=2}else if(Ft(e.h,t))n=t.G,Lt(e.h,t),r=1;else return;if(e.I!=0){if(t.o)if(r==1){n=t.u?t.u.length:0,t=Date.now()-t.F;var i=e.D;r=Qe(),x(r,new nt(r,n)),Rn(e)}else Un(e);else if(i=t.m,i==3||i==0&&t.X>0||!(r==1&&zn(e,t)||r==2&&P(e)))switch(n&&n.length>0&&(t=e.h,t.i=t.i.concat(n)),i){case 1:Yn(e,5);break;case 4:Yn(e,10);break;case 3:Yn(e,6);break;default:Yn(e,2)}}}function Jn(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function Yn(e,t){if(e.j.info(`Error code `+t),t==2){var n=l(e.bb,e),r=e.Ua;let t=!r;r=new Vt(r||`//www.google.com/images/cleardot.gif`),o.location&&o.location.protocol==`http`||w(r,`https`),Gt(r),t?un(r.toString(),n):dn(r.toString(),n)}else C(2);e.I=0,e.l&&e.l.pa(t),Xn(e),Ln(e)}e.bb=function(e){e?(this.j.info(`Successfully pinged google.com`),C(2)):(this.j.info(`Failed to ping google.com`),C(1))};function Xn(e){if(e.I=0,e.ja=[],e.l){let t=Rt(e.h);(t.length!=0||e.i.length!=0)&&(m(e.ja,t),m(e.ja,e.i),e.h.i.length=0,p(e.i),e.i.length=0),e.l.oa()}}function F(e,t,n){var r=n instanceof Vt?Ht(n):new Vt(n);if(r.g!=``)t&&(r.g=t+`.`+r.g),Ut(r,r.u);else{var i=o.location;r=i.protocol,t=t?t+`.`+i.hostname:i.hostname,i=+i.port;let e=new Vt(null);r&&w(e,r),t&&(e.g=t),i&&Ut(e,i),n&&(e.h=n),r=e}return n=e.G,t=e.wa,n&&t&&T(r,n,t),T(r,`VER`,e.ka),Vn(e,r),r}function Zn(e,t,n){if(t&&!e.L)throw Error(`Can't create secondary domain capable XhrIo object.`);return t=e.Aa&&!e.ma?new D(new mn({ab:n})):new D(e.ma),t.Fa(e.L),t}e.isActive=function(){return!!this.l&&this.l.isActive(this)};function I(){}e=I.prototype,e.ra=function(){},e.qa=function(){},e.pa=function(){},e.oa=function(){},e.isActive=function(){return!0},e.Ka=function(){};function L(){}L.prototype.g=function(e,t){return new R(e,t)};function R(e,t){b.call(this),this.g=new Pn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e[`X-Client-Protocol`]=`webchannel`:e={"X-Client-Protocol":`webchannel`}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e[`X-WebChannel-Content-Type`]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e[`X-WebChannel-Client-Profile`]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!ue(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t&&=t.httpSessionIdParam)&&!ue(t)&&(this.g.G=t,e=this.h,e!==null&&t in e&&(e=this.h,t in e&&delete e[t])),this.j=new er(this)}d(R,b),R.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},R.prototype.close=function(){Fn(this.g)},R.prototype.o=function(e){var t=this.g;if(typeof e==`string`){var n={};n.__data__=e,e=n}else this.v&&(n={},n.__data__=Ue(e),e=n);t.i.push(new jt(t.Ya++,e)),t.I==3&&Rn(t)},R.prototype.N=function(){this.g.l=null,delete this.j,Fn(this.g),delete this.g,R.Z.N.call(this)};function Qn(e){Ye.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){a:{for(let n in t){e=n;break a}e=void 0}(this.i=e)&&(e=this.i,t=t!==null&&e in t?t[e]:void 0),this.data=t}else this.data=e}d(Qn,Ye);function $n(){Xe.call(this),this.status=1}d($n,Xe);function er(e){this.g=e}d(er,I),er.prototype.ra=function(){x(this.g,`a`)},er.prototype.qa=function(e){x(this.g,new Qn(e))},er.prototype.pa=function(e){x(this.g,new $n)},er.prototype.oa=function(){x(this.g,`b`)},L.prototype.createWebChannel=L.prototype.g,R.prototype.send=R.prototype.o,R.prototype.open=R.prototype.m,R.prototype.close=R.prototype.close,wn=gn.createWebChannelTransport=function(){return new L},Cn=gn.getStatEventTarget=function(){return Qe()},Sn=gn.Event=S,xn=gn.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ut.NO_ERROR=0,ut.TIMEOUT=8,ut.HTTP_ERROR=6,bn=gn.ErrorCode=ut,dt.COMPLETE=`complete`,yn=gn.EventType=dt,qe.EventType=Je,Je.OPEN=`a`,Je.CLOSE=`b`,Je.ERROR=`c`,Je.MESSAGE=`d`,b.prototype.listen=b.prototype.J,vn=gn.WebChannel=qe,gn.FetchXmlHttpFactory=mn,D.prototype.listenOnce=D.prototype.K,D.prototype.getLastError=D.prototype.Ha,D.prototype.getLastErrorCode=D.prototype.ya,D.prototype.getStatus=D.prototype.ca,D.prototype.getResponseJson=D.prototype.La,D.prototype.getResponseText=D.prototype.la,D.prototype.send=D.prototype.ea,D.prototype.setWithCredentials=D.prototype.Fa,_n=gn.XhrIo=D}).apply(hn===void 0?typeof self<`u`?self:typeof window<`u`?window:{}:hn);var Tn=`@firebase/firestore`,En=`4.9.2`,E=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?`uid:`+this.uid:`anonymous-user`}isEqual(e){return e.uid===this.uid}};E.UNAUTHENTICATED=new E(null),E.GOOGLE_CREDENTIALS=new E(`google-credentials-uid`),E.FIRST_PARTY=new E(`first-party-uid`),E.MOCK_USER=new E(`mock-user`);var Dn=`12.3.0`,On=new b(`@firebase/firestore`);function kn(){return On.logLevel}function D(e,...t){if(On.logLevel<=y.DEBUG){let n=t.map(Mn);On.debug(`Firestore (${Dn}): ${e}`,...n)}}function An(e,...t){if(On.logLevel<=y.ERROR){let n=t.map(Mn);On.error(`Firestore (${Dn}): ${e}`,...n)}}function jn(e,...t){if(On.logLevel<=y.WARN){let n=t.map(Mn);On.warn(`Firestore (${Dn}): ${e}`,...n)}}function Mn(e){if(typeof e==`string`)return e;try{return function(e){return JSON.stringify(e)}(e)}catch{return e}}function O(e,t,n){let r=`Unexpected state`;typeof t==`string`?r=t:n=t,Nn(e,r,n)}function Nn(e,t,n){let r=`FIRESTORE (${Dn}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(n!==void 0)try{r+=` CONTEXT: `+JSON.stringify(n)}catch{r+=` CONTEXT: `+n}throw An(r),Error(r)}function k(e,t,n,r){let i=`Unexpected state`;typeof n==`string`?i=n:r=n,e||Nn(t,i,r)}function A(e,t){return e}var j={OK:`ok`,CANCELLED:`cancelled`,UNKNOWN:`unknown`,INVALID_ARGUMENT:`invalid-argument`,DEADLINE_EXCEEDED:`deadline-exceeded`,NOT_FOUND:`not-found`,ALREADY_EXISTS:`already-exists`,PERMISSION_DENIED:`permission-denied`,UNAUTHENTICATED:`unauthenticated`,RESOURCE_EXHAUSTED:`resource-exhausted`,FAILED_PRECONDITION:`failed-precondition`,ABORTED:`aborted`,OUT_OF_RANGE:`out-of-range`,UNIMPLEMENTED:`unimplemented`,INTERNAL:`internal`,UNAVAILABLE:`unavailable`,DATA_LOSS:`data-loss`},M=class extends ve{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}},N=class{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}},Pn=class{constructor(e,t){this.user=t,this.type=`OAuth`,this.headers=new Map,this.headers.set(`Authorization`,`Bearer ${e}`)}},Fn=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(E.UNAUTHENTICATED)))}shutdown(){}},In=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}},Ln=class{constructor(e){this.t=e,this.currentUser=E.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){k(this.o===void 0,42304);let n=this.i,r=e=>this.i===n?Promise.resolve():(n=this.i,t(e)),i=new N;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new N,e.enqueueRetryable((()=>r(this.currentUser)))};let a=()=>{let t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{D(`FirebaseAuthCredentialsProvider`,`Auth detected`),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?o(e):(D(`FirebaseAuthCredentialsProvider`,`Auth not yet detected`),i.resolve(),i=new N)}}),0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i===e?t?(k(typeof t.accessToken==`string`,31837,{l:t}),new Pn(t.accessToken,this.currentUser)):null:(D(`FirebaseAuthCredentialsProvider`,`getToken aborted due to token change.`),this.getToken()))):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return k(e===null||typeof e==`string`,2055,{h:e}),new E(e)}},Rn=class{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type=`FirstParty`,this.user=E.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set(`X-Goog-AuthUser`,this.P);let e=this.R();return e&&this.A.set(`Authorization`,e),this.T&&this.A.set(`X-Goog-Iam-Authorization-Token`,this.T),this.A}},zn=class{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new Rn(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(E.FIRST_PARTY)))}shutdown(){}invalidateToken(){}},Bn=class{constructor(e){this.value=e,this.type=`AppCheck`,this.headers=new Map,e&&e.length>0&&this.headers.set(`x-firebase-appcheck`,this.value)}},Vn=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ht(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){k(this.o===void 0,3512);let n=e=>{e.error!=null&&D(`FirebaseAppCheckTokenProvider`,`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.m;return this.m=e.token,D(`FirebaseAppCheckTokenProvider`,`Received ${n?`new`:`existing`} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};let r=e=>{D(`FirebaseAppCheckTokenProvider`,`AppCheck detected`),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?r(e):D(`FirebaseAppCheckTokenProvider`,`AppCheck not yet detected`)}}),0)}getToken(){if(this.p)return Promise.resolve(new Bn(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(k(typeof e.token==`string`,44558,{tokenResult:e}),this.m=e.token,new Bn(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function Hn(e){let t=typeof self<`u`&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&typeof t.getRandomValues==`function`)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}var Un=class{static newId(){let e=``;for(;e.length<20;){let t=Hn(40);for(let n=0;n<t.length;++n)e.length<20&&t[n]<248&&(e+=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789`.charAt(t[n]%62))}return e}};function P(e,t){return e<t?-1:e>t?1:0}function Wn(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=e.charAt(r),i=t.charAt(r);if(n!==i)return qn(n)===qn(i)?P(n,i):qn(n)?1:-1}return P(e.length,t.length)}var Gn=55296,Kn=57343;function qn(e){let t=e.charCodeAt(0);return t>=Gn&&t<=Kn}function Jn(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}var Yn=`__name__`,Xn=class e{constructor(e,t,n){t===void 0?t=0:t>e.length&&O(637,{offset:t,range:e.length}),n===void 0?n=e.length-t:n>e.length-t&&O(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(t){return e.comparator(this,t)===0}child(t){let n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach((e=>{n.push(e)})):n.push(t),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,n){let r=Math.min(t.length,n.length);for(let i=0;i<r;i++){let r=e.compareSegments(t.get(i),n.get(i));if(r!==0)return r}return P(t.length,n.length)}static compareSegments(t,n){let r=e.isNumericId(t),i=e.isNumericId(n);return r&&!i?-1:!r&&i?1:r&&i?e.extractNumericId(t).compare(e.extractNumericId(n)):Wn(t,n)}static isNumericId(e){return e.startsWith(`__id`)&&e.endsWith(`__`)}static extractNumericId(e){return pn.fromString(e.substring(4,e.length-2))}},F=class e extends Xn{construct(t,n,r){return new e(t,n,r)}canonicalString(){return this.toArray().join(`/`)}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join(`/`)}static fromString(...t){let n=[];for(let e of t){if(e.indexOf(`//`)>=0)throw new M(j.INVALID_ARGUMENT,`Invalid segment (${e}). Paths must not contain // in them.`);n.push(...e.split(`/`).filter((e=>e.length>0)))}return new e(n)}static emptyPath(){return new e([])}},Zn=/^[_a-zA-Z][_a-zA-Z0-9]*$/,I=class e extends Xn{construct(t,n,r){return new e(t,n,r)}static isValidIdentifier(e){return Zn.test(e)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,`\\\\`).replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(`.`)}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Yn}static keyField(){return new e([Yn])}static fromServerFormat(t){let n=[],r=``,i=0,a=()=>{if(r.length===0)throw new M(j.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=``},o=!1;for(;i<t.length;){let e=t[i];if(e===`\\`){if(i+1===t.length)throw new M(j.INVALID_ARGUMENT,`Path has trailing escape character: `+t);let e=t[i+1];if(e!==`\\`&&e!==`.`&&e!=="`")throw new M(j.INVALID_ARGUMENT,`Path has invalid escape sequence: `+t);r+=e,i+=2}else e==="`"?(o=!o,i++):e!==`.`||o?(r+=e,i++):(a(),i++)}if(a(),o)throw new M(j.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)}static emptyPath(){return new e([])}},L=class e{constructor(e){this.path=e}static fromPath(t){return new e(F.fromString(t))}static fromName(t){return new e(F.fromString(t).popFirst(5))}static empty(){return new e(F.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&F.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return F.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(t){return new e(new F(t.slice()))}};function R(e,t,n){if(!n)throw new M(j.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Qn(e,t,n,r){if(!0===t&&!0===r)throw new M(j.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function $n(e){if(!L.isDocumentKey(e))throw new M(j.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function er(e){if(L.isDocumentKey(e))throw new M(j.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function tr(e){return typeof e==`object`&&!!e&&(Object.getPrototypeOf(e)===Object.prototype||Object.getPrototypeOf(e)===null)}function nr(e){if(e===void 0)return`undefined`;if(e===null)return`null`;if(typeof e==`string`)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if(typeof e==`number`||typeof e==`boolean`)return``+e;if(typeof e==`object`){if(e instanceof Array)return`an array`;{let t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:`an object`}}return typeof e==`function`?`a function`:O(12329,{type:typeof e})}function rr(e,t){if(`_delegate`in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new M(j.INVALID_ARGUMENT,`Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?`);{let n=nr(e);throw new M(j.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function ir(e,t){if(t<=0)throw new M(j.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}function z(e,t){let n={typeString:e};return t&&(n.value=t),n}function ar(e,t){if(!tr(e))throw new M(j.INVALID_ARGUMENT,`JSON must be an object`);let n;for(let r in t)if(t[r]){let i=t[r].typeString,a=`value`in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n=`JSON missing required field: '${r}'`;break}let o=e[r];if(i&&typeof o!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(a!==void 0&&o!==a.value){n=`Expected '${r}' field to equal '${a.value}'`;break}}if(n)throw new M(j.INVALID_ARGUMENT,n);return!0}var or=-62135596800,sr=1e6,B=class e{static now(){return e.fromMillis(Date.now())}static fromDate(t){return e.fromMillis(t.getTime())}static fromMillis(t){let n=Math.floor(t/1e3);return new e(n,Math.floor((t-1e3*n)*sr))}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new M(j.INVALID_ARGUMENT,`Timestamp nanoseconds out of range: `+t);if(e<or||e>=253402300800)throw new M(j.INVALID_ARGUMENT,`Timestamp seconds out of range: `+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/sr}_compareTo(e){return this.seconds===e.seconds?P(this.nanoseconds,e.nanoseconds):P(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return`Timestamp(seconds=`+this.seconds+`, nanoseconds=`+this.nanoseconds+`)`}toJSON(){return{type:e._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(ar(t,e._jsonSchema))return new e(t.seconds,t.nanoseconds)}valueOf(){let e=this.seconds-or;return String(e).padStart(12,`0`)+`.`+String(this.nanoseconds).padStart(9,`0`)}};B._jsonSchemaVersion=`firestore/timestamp/1.0`,B._jsonSchema={type:z(`string`,B._jsonSchemaVersion),seconds:z(`number`),nanoseconds:z(`number`)};var V=class e{static fromTimestamp(t){return new e(t)}static min(){return new e(new B(0,0))}static max(){return new e(new B(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return`SnapshotVersion(`+this.timestamp.toString()+`)`}toTimestamp(){return this.timestamp}},cr=-1,lr=class{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}};lr.UNKNOWN_ID=-1;function ur(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new fr(V.fromTimestamp(r===1e9?new B(n+1,0):new B(n,r)),L.empty(),t)}function dr(e){return new fr(e.readTime,e.key,cr)}var fr=class e{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new e(V.min(),L.empty(),cr)}static max(){return new e(V.max(),L.empty(),cr)}};function pr(e,t){let n=e.readTime.compareTo(t.readTime);return n===0?(n=L.comparator(e.documentKey,t.documentKey),n===0?P(e.largestBatchId,t.largestBatchId):n):n}var mr=`The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.`,hr=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}};async function gr(e){if(e.code!==j.FAILED_PRECONDITION||e.message!==mr)throw e;D(`LocalStore`,`Unexpectedly lost primary lease`)}var H=class e{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(t,n){return this.callbackAttached&&O(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e(((e,r)=>{this.nextCallback=n=>{this.wrapSuccess(t,n).next(e,r)},this.catchCallback=t=>{this.wrapFailure(n,t).next(e,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(t){try{let n=t();return n instanceof e?n:e.resolve(n)}catch(t){return e.reject(t)}}wrapSuccess(t,n){return t?this.wrapUserFunction((()=>t(n))):e.resolve(n)}wrapFailure(t,n){return t?this.wrapUserFunction((()=>t(n))):e.reject(n)}static resolve(t){return new e(((e,n)=>{e(t)}))}static reject(t){return new e(((e,n)=>{n(t)}))}static waitFor(t){return new e(((e,n)=>{let r=0,i=0,a=!1;t.forEach((t=>{++r,t.next((()=>{++i,a&&i===r&&e()}),(e=>n(e)))})),a=!0,i===r&&e()}))}static or(t){let n=e.resolve(!1);for(let r of t)n=n.next((t=>t?e.resolve(t):r()));return n}static forEach(e,t){let n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(t,n){return new e(((e,r)=>{let i=t.length,a=Array(i),o=0;for(let s=0;s<i;s++){let c=s;n(t[c]).next((t=>{a[c]=t,++o,o===i&&e(a)}),(e=>r(e)))}}))}static doWhile(t,n){return new e(((e,r)=>{let i=()=>{!0===t()?n().next((()=>{i()}),r):e()};i()}))}};function _r(e){let t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(`.`).slice(0,2).join(`.`):`-1`;return Number(n)}function vr(e){return e.name===`IndexedDbTransactionError`}var yr=class{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}};yr.ce=-1;var br=-1;function xr(e){return e==null}function Sr(e){return e===0&&1/e==-1/0}function Cr(e){return typeof e==`number`&&Number.isInteger(e)&&!Sr(e)&&e<=2**53-1&&e>=-(2**53-1)}var wr=``;function Tr(e){let t=``;for(let n=0;n<e.length;n++)t.length>0&&(t=Dr(t)),t=Er(e.get(n),t);return Dr(t)}function Er(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case`\0`:n+=``;break;case wr:n+=``;break;default:n+=r}}return n}function Dr(e){return e+wr+``}function Or(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function kr(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Ar(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var U=class e{constructor(e,t){this.comparator=e,this.root=t||Mr.EMPTY}insert(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,Mr.BLACK,null,null))}remove(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Mr.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(r===0)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){let e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(`, `)}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new jr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new jr(this.root,e,this.comparator,!1)}getReverseIterator(){return new jr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new jr(this.root,e,this.comparator,!0)}},jr=class{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Mr=class e{constructor(t,n,r,i,a){this.key=t,this.value=n,this.color=r??e.RED,this.left=i??e.EMPTY,this.right=a??e.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,n,r,i,a){return new e(t??this.key,n??this.value,r??this.color,i??this.left,a??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):i===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return e.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,n){let r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(t,i.key)===0){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return 2**this.check()<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw O(43730,{key:this.key,value:this.value});if(this.right.isRed())throw O(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw O(27949);return e+(this.isRed()?0:1)}};Mr.EMPTY=null,Mr.RED=!0,Mr.BLACK=!1,Mr.EMPTY=new class{constructor(){this.size=0}get key(){throw O(57766)}get value(){throw O(16141)}get color(){throw O(16727)}get left(){throw O(29726)}get right(){throw O(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new Mr(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var W=class e{constructor(e){this.comparator=e,this.data=new U(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=t===void 0?this.data.getIterator():this.data.getIteratorFrom(t);n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Nr(this.data.getIterator())}getIteratorFrom(e){return new Nr(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(t){if(!(t instanceof e)||this.size!==t.size)return!1;let n=this.data.getIterator(),r=t.data.getIterator();for(;n.hasNext();){let e=n.getNext().key,t=r.getNext().key;if(this.comparator(e,t)!==0)return!1}return!0}toArray(){let e=[];return this.forEach((t=>{e.push(t)})),e}toString(){let e=[];return this.forEach((t=>e.push(t))),`SortedSet(`+e.toString()+`)`}copy(t){let n=new e(this.comparator);return n.data=t,n}},Nr=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}},Pr=class e{constructor(e){this.fields=e,e.sort(I.comparator)}static empty(){return new e([])}unionWith(t){let n=new W(I.comparator);for(let e of this.fields)n=n.add(e);for(let e of t)n=n.add(e);return new e(n.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Jn(this.fields,e.fields,((e,t)=>e.isEqual(t)))}},Fr=class extends Error{constructor(){super(...arguments),this.name=`Base64DecodeError`}},G=class e{constructor(e){this.binaryString=e}static fromBase64String(t){return new e(function(e){try{return atob(e)}catch(e){throw typeof DOMException<`u`&&e instanceof DOMException?new Fr(`Invalid base64 string: `+e):e}}(t))}static fromUint8Array(t){return new e(function(e){let t=``;for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(t))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return P(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};G.EMPTY_BYTE_STRING=new G(``);var Ir=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Lr(e){if(k(!!e,39018),typeof e==`string`){let t=0,n=Ir.exec(e);if(k(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+`000000000`).substr(0,9),t=Number(e)}let r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:K(e.seconds),nanos:K(e.nanos)}}function K(e){return typeof e==`number`?e:typeof e==`string`?Number(e):0}function Rr(e){return typeof e==`string`?G.fromBase64String(e):G.fromUint8Array(e)}var zr=`server_timestamp`,Br=`__type__`,Vr=`__previous_value__`,Hr=`__local_write_time__`;function Ur(e){return(e?.mapValue?.fields||{})[Br]?.stringValue===zr}function Wr(e){let t=e.mapValue.fields[Vr];return Ur(t)?Wr(t):t}function Gr(e){let t=Lr(e.mapValue.fields[Hr].timestampValue);return new B(t.seconds,t.nanos)}var Kr=class{constructor(e,t,n,r,i,a,o,s,c,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=o,this.longPollingOptions=s,this.useFetchStreams=c,this.isUsingEmulator=l}},qr=`(default)`,Jr=class e{constructor(e,t){this.projectId=e,this.database=t||qr}static empty(){return new e(``,``)}get isDefaultDatabase(){return this.database===qr}isEqual(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database}},Yr=`__type__`,Xr=`__max__`,Zr={mapValue:{fields:{__type__:{stringValue:Xr}}}},Qr=`__vector__`,$r=`value`;function ei(e){return`nullValue`in e?0:`booleanValue`in e?1:`integerValue`in e||`doubleValue`in e?2:`timestampValue`in e?3:`stringValue`in e?5:`bytesValue`in e?6:`referenceValue`in e?7:`geoPointValue`in e?8:`arrayValue`in e?9:`mapValue`in e?Ur(e)?4:_i(e)?9007199254740991:hi(e)?10:11:O(28295,{value:e})}function ti(e,t){if(e===t)return!0;let n=ei(e);if(n!==ei(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Gr(e).isEqual(Gr(t));case 3:return function(e,t){if(typeof e.timestampValue==`string`&&typeof t.timestampValue==`string`&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=Lr(e.timestampValue),r=Lr(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Rr(e.bytesValue).isEqual(Rr(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return K(e.geoPointValue.latitude)===K(t.geoPointValue.latitude)&&K(e.geoPointValue.longitude)===K(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if(`integerValue`in e&&`integerValue`in t)return K(e.integerValue)===K(t.integerValue);if(`doubleValue`in e&&`doubleValue`in t){let n=K(e.doubleValue),r=K(t.doubleValue);return n===r?Sr(n)===Sr(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return Jn(e.arrayValue.values||[],t.arrayValue.values||[],ti);case 10:case 11:return function(e,t){let n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Or(n)!==Or(r))return!1;for(let e in n)if(n.hasOwnProperty(e)&&(r[e]===void 0||!ti(n[e],r[e])))return!1;return!0}(e,t);default:return O(52216,{left:e})}}function ni(e,t){return(e.values||[]).find((e=>ti(e,t)))!==void 0}function ri(e,t){if(e===t)return 0;let n=ei(e),r=ei(t);if(n!==r)return P(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return P(e.booleanValue,t.booleanValue);case 2:return function(e,t){let n=K(e.integerValue||e.doubleValue),r=K(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return ii(e.timestampValue,t.timestampValue);case 4:return ii(Gr(e),Gr(t));case 5:return Wn(e.stringValue,t.stringValue);case 6:return function(e,t){let n=Rr(e),r=Rr(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){let n=e.split(`/`),r=t.split(`/`);for(let e=0;e<n.length&&e<r.length;e++){let t=P(n[e],r[e]);if(t!==0)return t}return P(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){let n=P(K(e.latitude),K(t.latitude));return n===0?P(K(e.longitude),K(t.longitude)):n}(e.geoPointValue,t.geoPointValue);case 9:return ai(e.arrayValue,t.arrayValue);case 10:return function(e,t){let n=e.fields||{},r=t.fields||{},i=n[$r]?.arrayValue,a=r[$r]?.arrayValue,o=P(i?.values?.length||0,a?.values?.length||0);return o===0?ai(i,a):o}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===Zr.mapValue&&t===Zr.mapValue)return 0;if(e===Zr.mapValue)return 1;if(t===Zr.mapValue)return-1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},a=Object.keys(i);r.sort(),a.sort();for(let e=0;e<r.length&&e<a.length;++e){let t=Wn(r[e],a[e]);if(t!==0)return t;let o=ri(n[r[e]],i[a[e]]);if(o!==0)return o}return P(r.length,a.length)}(e.mapValue,t.mapValue);default:throw O(23264,{he:n})}}function ii(e,t){if(typeof e==`string`&&typeof t==`string`&&e.length===t.length)return P(e,t);let n=Lr(e),r=Lr(t),i=P(n.seconds,r.seconds);return i===0?P(n.nanos,r.nanos):i}function ai(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=ri(n[e],r[e]);if(t)return t}return P(n.length,r.length)}function oi(e){return si(e)}function si(e){return`nullValue`in e?`null`:`booleanValue`in e?``+e.booleanValue:`integerValue`in e?``+e.integerValue:`doubleValue`in e?``+e.doubleValue:`timestampValue`in e?function(e){let t=Lr(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):`stringValue`in e?e.stringValue:`bytesValue`in e?function(e){return Rr(e).toBase64()}(e.bytesValue):`referenceValue`in e?function(e){return L.fromName(e).toString()}(e.referenceValue):`geoPointValue`in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):`arrayValue`in e?function(e){let t=`[`,n=!0;for(let r of e.values||[])n?n=!1:t+=`,`,t+=si(r);return t+`]`}(e.arrayValue):`mapValue`in e?function(e){let t=Object.keys(e.fields||{}).sort(),n=`{`,r=!0;for(let i of t)r?r=!1:n+=`,`,n+=`${i}:${si(e.fields[i])}`;return n+`}`}(e.mapValue):O(61005,{value:e})}function ci(e){switch(ei(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=Wr(e);return t?16+ci(t):16;case 5:return 2*e.stringValue.length;case 6:return Rr(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce(((e,t)=>e+ci(t)),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return kr(e.fields,((e,n)=>{t+=e.length+ci(n)})),t}(e.mapValue);default:throw O(13486,{value:e})}}function li(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function ui(e){return!!e&&`integerValue`in e}function di(e){return!!e&&`arrayValue`in e}function fi(e){return!!e&&`nullValue`in e}function pi(e){return!!e&&`doubleValue`in e&&isNaN(Number(e.doubleValue))}function mi(e){return!!e&&`mapValue`in e}function hi(e){return(e?.mapValue?.fields||{})[Yr]?.stringValue===Qr}function gi(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&typeof e.timestampValue==`object`)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return kr(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=gi(n))),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=gi(e.arrayValue.values[n]);return t}return{...e}}function _i(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===Xr}var vi=class e{constructor(e){this.value=e}static empty(){return new e({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!mi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=gi(t)}setAll(e){let t=I.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=gi(e):r.push(i.lastSegment())}));let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());mi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ti(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];mi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){kr(t,((t,n)=>e[t]=n));for(let t of n)delete e[t]}clone(){return new e(gi(this.value))}};function yi(e){let t=[];return kr(e.fields,((e,n)=>{let r=new I([e]);if(mi(n)){let e=yi(n.mapValue).fields;if(e.length===0)t.push(r);else for(let n of e)t.push(r.child(n))}else t.push(r)})),new Pr(t)}var bi=class e{constructor(e,t,n,r,i,a,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=a,this.documentState=o}static newInvalidDocument(t){return new e(t,0,V.min(),V.min(),V.min(),vi.empty(),0)}static newFoundDocument(t,n,r,i){return new e(t,1,n,V.min(),r,i,0)}static newNoDocument(t,n){return new e(t,2,n,V.min(),V.min(),vi.empty(),0)}static newUnknownDocument(t,n){return new e(t,3,n,V.min(),V.min(),vi.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(V.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=vi.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=vi.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=V.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new e(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}},xi=class{constructor(e,t){this.position=e,this.inclusive=t}};function Si(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let a=t[i],o=e.position[i];if(r=a.field.isKeyField()?L.comparator(L.fromName(o.referenceValue),n.key):ri(o,n.data.field(a.field)),a.dir===`desc`&&(r*=-1),r!==0)break}return r}function Ci(e,t){if(e===null)return t===null;if(t===null||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!ti(e.position[n],t.position[n]))return!1;return!0}var wi=class{constructor(e,t=`asc`){this.field=e,this.dir=t}};function Ti(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}var Ei=class{},q=class e extends Ei{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(t,n,r){return t.isKeyField()?n===`in`||n===`not-in`?this.createKeyFieldInFilter(t,n,r):new Pi(t,n,r):n===`array-contains`?new Ri(t,r):n===`in`?new zi(t,r):n===`not-in`?new Bi(t,r):n===`array-contains-any`?new Vi(t,r):new e(t,n,r)}static createKeyFieldInFilter(e,t,n){return t===`in`?new Fi(e,n):new Ii(e,n)}matches(e){let t=e.data.field(this.field);return this.op===`!=`?t!==null&&t.nullValue===void 0&&this.matchesComparison(ri(t,this.value)):t!==null&&ei(this.value)===ei(t)&&this.matchesComparison(ri(t,this.value))}matchesComparison(e){switch(this.op){case`<`:return e<0;case`<=`:return e<=0;case`==`:return e===0;case`!=`:return e!==0;case`>`:return e>0;case`>=`:return e>=0;default:return O(47266,{operator:this.op})}}isInequality(){return[`<`,`<=`,`>`,`>=`,`!=`,`not-in`].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Di=class e extends Ei{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(t,n){return new e(t,n)}matches(e){return Oi(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}};function Oi(e){return e.op===`and`}function ki(e){return Ai(e)&&Oi(e)}function Ai(e){for(let t of e.filters)if(t instanceof Di)return!1;return!0}function ji(e){if(e instanceof q)return e.field.canonicalString()+e.op.toString()+oi(e.value);if(ki(e))return e.filters.map((e=>ji(e))).join(`,`);{let t=e.filters.map((e=>ji(e))).join(`,`);return`${e.op}(${t})`}}function Mi(e,t){return e instanceof q?function(e,t){return t instanceof q&&e.op===t.op&&e.field.isEqual(t.field)&&ti(e.value,t.value)}(e,t):e instanceof Di?function(e,t){return t instanceof Di&&e.op===t.op&&e.filters.length===t.filters.length?e.filters.reduce(((e,n,r)=>e&&Mi(n,t.filters[r])),!0):!1}(e,t):void O(19439)}function Ni(e){return e instanceof q?function(e){return`${e.field.canonicalString()} ${e.op} ${oi(e.value)}`}(e):e instanceof Di?function(e){return e.op.toString()+` {`+e.getFilters().map(Ni).join(` ,`)+`}`}(e):`Filter`}var Pi=class extends q{constructor(e,t,n){super(e,t,n),this.key=L.fromName(n.referenceValue)}matches(e){let t=L.comparator(e.key,this.key);return this.matchesComparison(t)}},Fi=class extends q{constructor(e,t){super(e,`in`,t),this.keys=Li(`in`,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}},Ii=class extends q{constructor(e,t){super(e,`not-in`,t),this.keys=Li(`not-in`,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}};function Li(e,t){return(t.arrayValue?.values||[]).map((e=>L.fromName(e.referenceValue)))}var Ri=class extends q{constructor(e,t){super(e,`array-contains`,t)}matches(e){let t=e.data.field(this.field);return di(t)&&ni(t.arrayValue,this.value)}},zi=class extends q{constructor(e,t){super(e,`in`,t)}matches(e){let t=e.data.field(this.field);return t!==null&&ni(this.value.arrayValue,t)}},Bi=class extends q{constructor(e,t){super(e,`not-in`,t)}matches(e){if(ni(this.value.arrayValue,{nullValue:`NULL_VALUE`}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!ni(this.value.arrayValue,t)}},Vi=class extends q{constructor(e,t){super(e,`array-contains-any`,t)}matches(e){let t=e.data.field(this.field);return!(!di(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>ni(this.value.arrayValue,e)))}},Hi=class{constructor(e,t=null,n=[],r=[],i=null,a=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=a,this.endAt=o,this.Te=null}};function Ui(e,t=null,n=[],r=[],i=null,a=null,o=null){return new Hi(e,t,n,r,i,a,o)}function Wi(e){let t=A(e);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+=`|cg:`+t.collectionGroup),e+=`|f:`,e+=t.filters.map((e=>ji(e))).join(`,`),e+=`|ob:`,e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(`,`),xr(t.limit)||(e+=`|l:`,e+=t.limit),t.startAt&&(e+=`|lb:`,e+=t.startAt.inclusive?`b:`:`a:`,e+=t.startAt.position.map((e=>oi(e))).join(`,`)),t.endAt&&(e+=`|ub:`,e+=t.endAt.inclusive?`a:`:`b:`,e+=t.endAt.position.map((e=>oi(e))).join(`,`)),t.Te=e}return t.Te}function Gi(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Ti(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Mi(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Ci(e.startAt,t.startAt)&&Ci(e.endAt,t.endAt)}function Ki(e){return L.isDocumentKey(e.path)&&e.collectionGroup===null&&e.filters.length===0}var qi=class{constructor(e,t=null,n=[],r=[],i=null,a=`F`,o=null,s=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=a,this.startAt=o,this.endAt=s,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}};function Ji(e,t,n,r,i,a,o,s){return new qi(e,t,n,r,i,a,o,s)}function Yi(e){return new qi(e)}function Xi(e){return e.filters.length===0&&e.limit===null&&e.startAt==null&&e.endAt==null&&(e.explicitOrderBy.length===0||e.explicitOrderBy.length===1&&e.explicitOrderBy[0].field.isKeyField())}function Zi(e){return e.collectionGroup!==null}function Qi(e){let t=A(e);if(t.Ie===null){t.Ie=[];let e=new Set;for(let n of t.explicitOrderBy)t.Ie.push(n),e.add(n.field.canonicalString());let n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:`asc`;(function(e){let t=new W(I.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t})(t).forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.Ie.push(new wi(r,n))})),e.has(I.keyField().canonicalString())||t.Ie.push(new wi(I.keyField(),n))}return t.Ie}function $i(e){let t=A(e);return t.Ee||=ea(t,Qi(e)),t.Ee}function ea(e,t){if(e.limitType===`F`)return Ui(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{let t=e.dir===`desc`?`asc`:`desc`;return new wi(e.field,t)}));let n=e.endAt?new xi(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new xi(e.startAt.position,e.startAt.inclusive):null;return Ui(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function ta(e,t){let n=e.filters.concat([t]);return new qi(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function na(e,t,n){return new qi(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function ra(e,t){return Gi($i(e),$i(t))&&e.limitType===t.limitType}function ia(e){return`${Wi($i(e))}|lt:${e.limitType}`}function aa(e){return`Query(target=${function(e){let t=e.path.canonicalString();return e.collectionGroup!==null&&(t+=` collectionGroup=`+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>Ni(e))).join(`, `)}]`),xr(e.limit)||(t+=`, limit: `+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(`, `)}]`),e.startAt&&(t+=`, startAt: `,t+=e.startAt.inclusive?`b:`:`a:`,t+=e.startAt.position.map((e=>oi(e))).join(`,`)),e.endAt&&(t+=`, endAt: `,t+=e.endAt.inclusive?`a:`:`b:`,t+=e.endAt.position.map((e=>oi(e))).join(`,`)),`Target(${t})`}($i(e))}; limitType=${e.limitType})`}function oa(e,t){return t.isFoundDocument()&&function(e,t){let n=t.key.path;return e.collectionGroup===null?L.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n):t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n)}(e,t)&&function(e,t){for(let n of Qi(e))if(!n.field.isKeyField()&&t.data.field(n.field)===null)return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){let r=Si(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Qi(e),t)||e.endAt&&!function(e,t,n){let r=Si(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Qi(e),t))}(e,t)}function sa(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function ca(e){return(t,n)=>{let r=!1;for(let i of Qi(e)){let e=la(i,t,n);if(e!==0)return e;r||=i.field.isKeyField()}return 0}}function la(e,t,n){let r=e.field.isKeyField()?L.comparator(t.key,n.key):function(e,t,n){let r=t.data.field(e),i=n.data.field(e);return r!==null&&i!==null?ri(r,i):O(42886)}(e.field,t,n);switch(e.dir){case`asc`:return r;case`desc`:return-1*r;default:return O(19790,{direction:e.dir})}}var ua=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return this.get(e)!==void 0}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return n.length===1?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){kr(this.inner,((t,n)=>{for(let[t,r]of n)e(t,r)}))}isEmpty(){return Ar(this.inner)}size(){return this.innerSize}},da=new U(L.comparator);function fa(){return da}var pa=new U(L.comparator);function ma(...e){let t=pa;for(let n of e)t=t.insert(n.key,n);return t}function ha(e){let t=pa;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function ga(){return va()}function _a(){return va()}function va(){return new ua((e=>e.toString()),((e,t)=>e.isEqual(t)))}var ya=new U(L.comparator),ba=new W(L.comparator);function J(...e){let t=ba;for(let n of e)t=t.add(n);return t}var xa=new W(P);function Sa(){return xa}function Ca(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:`NaN`};if(t===1/0)return{doubleValue:`Infinity`};if(t===-1/0)return{doubleValue:`-Infinity`}}return{doubleValue:Sr(t)?`-0`:t}}function wa(e){return{integerValue:``+e}}function Ta(e,t){return Cr(t)?wa(t):Ca(e,t)}var Ea=class{constructor(){this._=void 0}};function Da(e,t,n){return e instanceof Aa?function(e,t){let n={fields:{[Br]:{stringValue:zr},[Hr]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Ur(t)&&(t=Wr(t)),t&&(n.fields[Vr]=t),{mapValue:n}}(n,t):e instanceof ja?Ma(e,t):e instanceof Na?Pa(e,t):function(e,t){let n=ka(e,t),r=Ia(n)+Ia(e.Ae);return ui(n)&&ui(e.Ae)?wa(r):Ca(e.serializer,r)}(e,t)}function Oa(e,t,n){return e instanceof ja?Ma(e,t):e instanceof Na?Pa(e,t):n}function ka(e,t){return e instanceof Fa?function(e){return ui(e)||function(e){return!!e&&`doubleValue`in e}(e)}(t)?t:{integerValue:0}:null}var Aa=class extends Ea{},ja=class extends Ea{constructor(e){super(),this.elements=e}};function Ma(e,t){let n=La(t);for(let t of e.elements)n.some((e=>ti(e,t)))||n.push(t);return{arrayValue:{values:n}}}var Na=class extends Ea{constructor(e){super(),this.elements=e}};function Pa(e,t){let n=La(t);for(let t of e.elements)n=n.filter((e=>!ti(e,t)));return{arrayValue:{values:n}}}var Fa=class extends Ea{constructor(e,t){super(),this.serializer=e,this.Ae=t}};function Ia(e){return K(e.integerValue||e.doubleValue)}function La(e){return di(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}function Ra(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof ja&&t instanceof ja||e instanceof Na&&t instanceof Na?Jn(e.elements,t.elements,ti):e instanceof Fa&&t instanceof Fa?ti(e.Ae,t.Ae):e instanceof Aa&&t instanceof Aa}(e.transform,t.transform)}var za=class{constructor(e,t){this.version=e,this.transformResults=t}},Ba=class e{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new e}static exists(t){return new e(void 0,t)}static updateTime(t){return new e(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Va(e,t){return e.updateTime===void 0?e.exists===void 0||e.exists===t.isFoundDocument():t.isFoundDocument()&&t.version.isEqual(e.updateTime)}var Ha=class{};function Ua(e,t){if(!e.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return e.isNoDocument()?new $a(e.key,Ba.none()):new Ja(e.key,e.data,Ba.none());{let n=e.data,r=vi.empty(),i=new W(I.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);t===null&&e.length>1&&(e=e.popLast(),t=n.field(e)),t===null?r.delete(e):r.set(e,t),i=i.add(e)}return new Ya(e.key,r,new Pr(i.toArray()),Ba.none())}}function Wa(e,t,n){e instanceof Ja?function(e,t,n){let r=e.value.clone(),i=Za(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Ya?function(e,t,n){if(!Va(e.precondition,t))return void t.convertToUnknownDocument(n.version);let r=Za(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Xa(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Ga(e,t,n,r){return e instanceof Ja?function(e,t,n,r){if(!Va(e.precondition,t))return n;let i=e.value.clone(),a=Qa(e.fieldTransforms,r,t);return i.setAll(a),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Ya?function(e,t,n,r){if(!Va(e.precondition,t))return n;let i=Qa(e.fieldTransforms,r,t),a=t.data;return a.setAll(Xa(e)),a.setAll(i),t.convertToFoundDocument(t.version,a).setHasLocalMutations(),n===null?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return Va(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Ka(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=ka(r.transform,e||null);i!=null&&(n===null&&(n=vi.empty()),n.set(r.field,i))}return n||null}function qa(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return e===void 0&&t===void 0||!(!e||!t)&&Jn(e,t,((e,t)=>Ra(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(e.type===0?e.value.isEqual(t.value):e.type!==1||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}var Ja=class extends Ha{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}},Ya=class extends Ha{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}};function Xa(e){let t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}})),t}function Za(e,t,n){let r=new Map;k(e.length===n.length,32656,{Re:n.length,Ve:e.length});for(let i=0;i<n.length;i++){let a=e[i],o=a.transform,s=t.data.field(a.field);r.set(a.field,Oa(o,s,n[i]))}return r}function Qa(e,t,n){let r=new Map;for(let i of e){let e=i.transform,a=n.data.field(i.field);r.set(i.field,Da(e,a,t))}return r}var $a=class extends Ha{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},eo=class extends Ha{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}},to=class{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&Wa(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=Ga(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=Ga(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=_a();return this.mutations.forEach((r=>{let i=e.get(r.key),a=i.overlayedDocument,o=this.applyToLocalView(a,i.mutatedFields);o=t.has(r.key)?null:o;let s=Ua(a,o);s!==null&&n.set(r.key,s),a.isValidDocument()||a.convertToNoDocument(V.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),J())}isEqual(e){return this.batchId===e.batchId&&Jn(this.mutations,e.mutations,((e,t)=>qa(e,t)))&&Jn(this.baseMutations,e.baseMutations,((e,t)=>qa(e,t)))}},no=class e{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(t,n,r){k(t.mutations.length===r.length,58842,{me:t.mutations.length,fe:r.length});let i=function(){return ya}(),a=t.mutations;for(let e=0;e<a.length;e++)i=i.insert(a[e].key,r[e].version);return new e(t,n,r,i)}},ro=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}},io=class{constructor(e,t){this.count=e,this.unchangedNames=t}},Y,X;function ao(e){switch(e){case j.OK:return O(64938);case j.CANCELLED:case j.UNKNOWN:case j.DEADLINE_EXCEEDED:case j.RESOURCE_EXHAUSTED:case j.INTERNAL:case j.UNAVAILABLE:case j.UNAUTHENTICATED:return!1;case j.INVALID_ARGUMENT:case j.NOT_FOUND:case j.ALREADY_EXISTS:case j.PERMISSION_DENIED:case j.FAILED_PRECONDITION:case j.ABORTED:case j.OUT_OF_RANGE:case j.UNIMPLEMENTED:case j.DATA_LOSS:return!0;default:return O(15467,{code:e})}}function oo(e){if(e===void 0)return An(`GRPC error has no .code`),j.UNKNOWN;switch(e){case Y.OK:return j.OK;case Y.CANCELLED:return j.CANCELLED;case Y.UNKNOWN:return j.UNKNOWN;case Y.DEADLINE_EXCEEDED:return j.DEADLINE_EXCEEDED;case Y.RESOURCE_EXHAUSTED:return j.RESOURCE_EXHAUSTED;case Y.INTERNAL:return j.INTERNAL;case Y.UNAVAILABLE:return j.UNAVAILABLE;case Y.UNAUTHENTICATED:return j.UNAUTHENTICATED;case Y.INVALID_ARGUMENT:return j.INVALID_ARGUMENT;case Y.NOT_FOUND:return j.NOT_FOUND;case Y.ALREADY_EXISTS:return j.ALREADY_EXISTS;case Y.PERMISSION_DENIED:return j.PERMISSION_DENIED;case Y.FAILED_PRECONDITION:return j.FAILED_PRECONDITION;case Y.ABORTED:return j.ABORTED;case Y.OUT_OF_RANGE:return j.OUT_OF_RANGE;case Y.UNIMPLEMENTED:return j.UNIMPLEMENTED;case Y.DATA_LOSS:return j.DATA_LOSS;default:return O(39323,{code:e})}}(X=Y||={})[X.OK=0]=`OK`,X[X.CANCELLED=1]=`CANCELLED`,X[X.UNKNOWN=2]=`UNKNOWN`,X[X.INVALID_ARGUMENT=3]=`INVALID_ARGUMENT`,X[X.DEADLINE_EXCEEDED=4]=`DEADLINE_EXCEEDED`,X[X.NOT_FOUND=5]=`NOT_FOUND`,X[X.ALREADY_EXISTS=6]=`ALREADY_EXISTS`,X[X.PERMISSION_DENIED=7]=`PERMISSION_DENIED`,X[X.UNAUTHENTICATED=16]=`UNAUTHENTICATED`,X[X.RESOURCE_EXHAUSTED=8]=`RESOURCE_EXHAUSTED`,X[X.FAILED_PRECONDITION=9]=`FAILED_PRECONDITION`,X[X.ABORTED=10]=`ABORTED`,X[X.OUT_OF_RANGE=11]=`OUT_OF_RANGE`,X[X.UNIMPLEMENTED=12]=`UNIMPLEMENTED`,X[X.INTERNAL=13]=`INTERNAL`,X[X.UNAVAILABLE=14]=`UNAVAILABLE`,X[X.DATA_LOSS=15]=`DATA_LOSS`;var so=null;function co(){return new TextEncoder}var lo=new pn([4294967295,4294967295],0);function uo(e){let t=co().encode(e),n=new mn;return n.update(t),new Uint8Array(n.digest())}function fo(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),a=t.getUint32(12,!0);return[new pn([n,r],0),new pn([i,a],0)]}var po=class e{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new mo(`Invalid padding: ${t}`);if(n<0||e.length>0&&this.hashCount===0)throw new mo(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new mo(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=pn.fromNumber(this.ge)}ye(e,t,n){let r=e.add(t.multiply(pn.fromNumber(n)));return r.compare(lo)===1&&(r=new pn([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;let[t,n]=fo(uo(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);if(!this.we(r))return!1}return!0}static create(t,n,r){let i=t%8==0?0:8-t%8,a=new e(new Uint8Array(Math.ceil(t/8)),i,n);return r.forEach((e=>a.insert(e))),a}insert(e){if(this.ge===0)return;let[t,n]=fo(uo(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);this.Se(r)}}Se(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}},mo=class extends Error{constructor(){super(...arguments),this.name=`BloomFilterError`}},ho=class e{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,n,r){let i=new Map;return i.set(t,go.createSynthesizedTargetChangeForCurrentChange(t,n,r)),new e(V.min(),i,new U(P),fa(),J())}},go=class e{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,n,r){return new e(r,n,J(),J(),J())}},_o=class{constructor(e,t,n,r){this.be=e,this.removedTargetIds=t,this.key=n,this.De=r}},vo=class{constructor(e,t){this.targetId=e,this.Ce=t}},yo=class{constructor(e,t,n=G.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}},bo=class{constructor(){this.ve=0,this.Fe=Co(),this.Me=G.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=J(),t=J(),n=J();return this.Fe.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:O(38017,{changeType:i})}})),new go(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=Co()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){--this.ve,k(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}},xo=class{constructor(e){this.Ge=e,this.ze=new Map,this.je=fa(),this.Je=So(),this.He=So(),this.Ye=new U(P)}Ze(e){for(let t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{let n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:O(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((e,n)=>{this.rt(n)&&t(n)}))}st(e){let t=e.targetId,n=e.Ce.count,r=this.ot(t);if(r){let i=r.target;if(Ki(i))if(n===0){let e=new L(i.path);this.et(t,e,bi.newNoDocument(e,V.min()))}else k(n===1,20013,{expectedCount:n});else{let r=this._t(t);if(r!==n){let n=this.ut(e),i=n?this.ct(n,e,r):1;if(i!==0){this.it(t);let e=i===2?`TargetPurposeExistenceFilterMismatchBloom`:`TargetPurposeExistenceFilterMismatch`;this.Ye=this.Ye.insert(t,e)}so?.lt(function(e,t,n,r,i){let a={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},o=t.unchangedNames;return o&&(a.bloomFilter={applied:i===0,hashCount:o?.hashCount??0,bitmapLength:o?.bits?.bitmap?.length??0,padding:o?.bits?.padding??0,mightContain:e=>r?.mightContain(e)??!1}),a}(r,e.Ce,this.Ge.ht(),n,i))}}}}ut(e){let t=e.Ce.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:n=``,padding:r=0},hashCount:i=0}=t,a,o;try{a=Rr(n).toUint8Array()}catch(e){if(e instanceof Fr)return jn(`Decoding the base64 bloom filter in existence filter failed (`+e.message+`); ignoring the bloom filter and falling back to full re-query.`),null;throw e}try{o=new po(a,r,i)}catch(e){return jn(e instanceof mo?`BloomFilter error: `:`Applying bloom filter failed: `,e),null}return o.ge===0?null:o}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){let n=this.Ge.getRemoteKeysForTarget(t),r=0;return n.forEach((n=>{let i=this.Ge.ht(),a=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(a)||(this.et(t,n,null),r++)})),r}Tt(e){let t=new Map;this.ze.forEach(((n,r)=>{let i=this.ot(r);if(i){if(n.current&&Ki(i.target)){let t=new L(i.target.path);this.It(t).has(r)||this.Et(r,t)||this.et(r,t,bi.newNoDocument(t,e))}n.Be&&(t.set(r,n.ke()),n.qe())}}));let n=J();this.He.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{let t=this.ot(e);return!t||t.purpose===`TargetPurposeLimboResolution`||(r=!1,!1)})),r&&(n=n.add(e))})),this.je.forEach(((t,n)=>n.setReadTime(e)));let r=new ho(e,t,this.Ye,this.je,n);return this.je=fa(),this.Je=So(),this.He=So(),this.Ye=new U(P),r}Xe(e,t){if(!this.rt(e))return;let n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;let r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new bo,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new W(P),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new W(P),this.Je=this.Je.insert(e,t)),t}rt(e){let t=this.ot(e)!==null;return t||D(`WatchChangeAggregator`,`Detected inactive target`,e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new bo),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}};function So(){return new U(L.comparator)}function Co(){return new U(L.comparator)}var wo=(()=>({asc:`ASCENDING`,desc:`DESCENDING`}))(),To=(()=>({"<":`LESS_THAN`,"<=":`LESS_THAN_OR_EQUAL`,">":`GREATER_THAN`,">=":`GREATER_THAN_OR_EQUAL`,"==":`EQUAL`,"!=":`NOT_EQUAL`,"array-contains":`ARRAY_CONTAINS`,in:`IN`,"not-in":`NOT_IN`,"array-contains-any":`ARRAY_CONTAINS_ANY`}))(),Eo=(()=>({and:`AND`,or:`OR`}))(),Do=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Oo(e,t){return e.useProto3Json||xr(t)?t:{value:t}}function ko(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,``).replace(`Z`,``)}.${(`000000000`+t.nanoseconds).slice(-9)}Z`:{seconds:``+t.seconds,nanos:t.nanoseconds}}function Ao(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function jo(e,t){return ko(e,t.toTimestamp())}function Mo(e){return k(!!e,49232),V.fromTimestamp(function(e){let t=Lr(e);return new B(t.seconds,t.nanos)}(e))}function No(e,t){return Po(e,t).canonicalString()}function Po(e,t){let n=function(e){return new F([`projects`,e.projectId,`databases`,e.database])}(e).child(`documents`);return t===void 0?n:n.child(t)}function Fo(e){let t=F.fromString(e);return k(is(t),10190,{key:t.toString()}),t}function Io(e,t){return No(e.databaseId,t.path)}function Lo(e,t){let n=Fo(t);if(n.get(1)!==e.databaseId.projectId)throw new M(j.INVALID_ARGUMENT,`Tried to deserialize key from different project: `+n.get(1)+` vs `+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new M(j.INVALID_ARGUMENT,`Tried to deserialize key from different database: `+n.get(3)+` vs `+e.databaseId.database);return new L(Vo(n))}function Ro(e,t){return No(e.databaseId,t)}function zo(e){let t=Fo(e);return t.length===4?F.emptyPath():Vo(t)}function Bo(e){return new F([`projects`,e.databaseId.projectId,`databases`,e.databaseId.database]).canonicalString()}function Vo(e){return k(e.length>4&&e.get(4)===`documents`,29091,{key:e.toString()}),e.popFirst(5)}function Ho(e,t,n){return{name:Io(e,t),fields:n.value.mapValue.fields}}function Uo(e,t){let n;if(`targetChange`in t){t.targetChange;let r=function(e){return e===`NO_CHANGE`?0:e===`ADD`?1:e===`REMOVE`?2:e===`CURRENT`?3:e===`RESET`?4:O(39313,{state:e})}(t.targetChange.targetChangeType||`NO_CHANGE`),i=t.targetChange.targetIds||[],a=function(e,t){return e.useProto3Json?(k(t===void 0||typeof t==`string`,58123),G.fromBase64String(t||``)):(k(t===void 0||t instanceof Buffer||t instanceof Uint8Array,16193),G.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause;n=new yo(r,i,a,o&&function(e){return new M(e.code===void 0?j.UNKNOWN:oo(e.code),e.message||``)}(o)||null)}else if(`documentChange`in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=Lo(e,r.document.name),a=Mo(r.document.updateTime),o=r.document.createTime?Mo(r.document.createTime):V.min(),s=new vi({mapValue:{fields:r.document.fields}}),c=bi.newFoundDocument(i,a,o,s);n=new _o(r.targetIds||[],r.removedTargetIds||[],c.key,c)}else if(`documentDelete`in t){t.documentDelete;let r=t.documentDelete;r.document;let i=Lo(e,r.document),a=r.readTime?Mo(r.readTime):V.min(),o=bi.newNoDocument(i,a);n=new _o([],r.removedTargetIds||[],o.key,o)}else if(`documentRemove`in t){t.documentRemove;let r=t.documentRemove;r.document;let i=Lo(e,r.document);n=new _o([],r.removedTargetIds||[],i,null)}else{if(!(`filter`in t))return O(11601,{Rt:t});{t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,a=new io(r,i),o=e.targetId;n=new vo(o,a)}}return n}function Wo(e,t){let n;if(t instanceof Ja)n={update:Ho(e,t.key,t.value)};else if(t instanceof $a)n={delete:Io(e,t.key)};else if(t instanceof Ya)n={update:Ho(e,t.key,t.data),updateMask:rs(t.fieldMask)};else{if(!(t instanceof eo))return O(16599,{Vt:t.type});n={verify:Io(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){let n=t.transform;if(n instanceof Aa)return{fieldPath:t.field.canonicalString(),setToServerValue:`REQUEST_TIME`};if(n instanceof ja)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Na)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Fa)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw O(20930,{transform:t.transform})}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return t.updateTime===void 0?t.exists===void 0?O(27497):{exists:t.exists}:{updateTime:jo(e,t.updateTime)}}(e,t.precondition)),n}function Go(e,t){return e&&e.length>0?(k(t!==void 0,14353),e.map((e=>function(e,t){let n=e.updateTime?Mo(e.updateTime):Mo(t);return n.isEqual(V.min())&&(n=Mo(t)),new za(n,e.transformResults||[])}(e,t)))):[]}function Ko(e,t){return{documents:[Ro(e,t.path)]}}function qo(e,t){let n={structuredQuery:{}},r=t.path,i;t.collectionGroup===null?(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]):(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]),n.parent=Ro(e,i);let a=function(e){if(e.length!==0)return ns(Di.create(e,`and`))}(t.filters);a&&(n.structuredQuery.where=a);let o=function(e){if(e.length!==0)return e.map((e=>function(e){return{field:es(e.field),direction:Zo(e.dir)}}(e)))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);let s=Oo(e,t.limit);return s!==null&&(n.structuredQuery.limit=s),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ft:n,parent:i}}function Jo(e){let t=zo(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){k(r===1,65062);let e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let a=[];n.where&&(a=function(e){let t=Xo(e);return t instanceof Di&&ki(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map((e=>function(e){return new wi(ts(e.field),function(e){switch(e){case`ASCENDING`:return`asc`;case`DESCENDING`:return`desc`;default:return}}(e.direction))}(e)))}(n.orderBy));let s=null;n.limit&&(s=function(e){let t;return t=typeof e==`object`?e.value:e,xr(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){let t=!!e.before;return new xi(e.values||[],t)}(n.startAt));let l=null;return n.endAt&&(l=function(e){let t=!e.before;return new xi(e.values||[],t)}(n.endAt)),Ji(t,i,o,a,s,`F`,c,l)}function Yo(e,t){let n=function(e){switch(e){case`TargetPurposeListen`:return null;case`TargetPurposeExistenceFilterMismatch`:return`existence-filter-mismatch`;case`TargetPurposeExistenceFilterMismatchBloom`:return`existence-filter-mismatch-bloom`;case`TargetPurposeLimboResolution`:return`limbo-document`;default:return O(28987,{purpose:e})}}(t.purpose);return n==null?null:{"goog-listen-tags":n}}function Xo(e){return e.unaryFilter===void 0?e.fieldFilter===void 0?e.compositeFilter===void 0?O(30097,{filter:e}):function(e){return Di.create(e.compositeFilter.filters.map((e=>Xo(e))),function(e){switch(e){case`AND`:return`and`;case`OR`:return`or`;default:return O(1026)}}(e.compositeFilter.op))}(e):function(e){return q.create(ts(e.fieldFilter.field),function(e){switch(e){case`EQUAL`:return`==`;case`NOT_EQUAL`:return`!=`;case`GREATER_THAN`:return`>`;case`GREATER_THAN_OR_EQUAL`:return`>=`;case`LESS_THAN`:return`<`;case`LESS_THAN_OR_EQUAL`:return`<=`;case`ARRAY_CONTAINS`:return`array-contains`;case`IN`:return`in`;case`NOT_IN`:return`not-in`;case`ARRAY_CONTAINS_ANY`:return`array-contains-any`;case`OPERATOR_UNSPECIFIED`:return O(58110);default:return O(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(e):function(e){switch(e.unaryFilter.op){case`IS_NAN`:let t=ts(e.unaryFilter.field);return q.create(t,`==`,{doubleValue:NaN});case`IS_NULL`:let n=ts(e.unaryFilter.field);return q.create(n,`==`,{nullValue:`NULL_VALUE`});case`IS_NOT_NAN`:let r=ts(e.unaryFilter.field);return q.create(r,`!=`,{doubleValue:NaN});case`IS_NOT_NULL`:let i=ts(e.unaryFilter.field);return q.create(i,`!=`,{nullValue:`NULL_VALUE`});case`OPERATOR_UNSPECIFIED`:return O(61313);default:return O(60726)}}(e)}function Zo(e){return wo[e]}function Qo(e){return To[e]}function $o(e){return Eo[e]}function es(e){return{fieldPath:e.canonicalString()}}function ts(e){return I.fromServerFormat(e.fieldPath)}function ns(e){return e instanceof q?function(e){if(e.op===`==`){if(pi(e.value))return{unaryFilter:{field:es(e.field),op:`IS_NAN`}};if(fi(e.value))return{unaryFilter:{field:es(e.field),op:`IS_NULL`}}}else if(e.op===`!=`){if(pi(e.value))return{unaryFilter:{field:es(e.field),op:`IS_NOT_NAN`}};if(fi(e.value))return{unaryFilter:{field:es(e.field),op:`IS_NOT_NULL`}}}return{fieldFilter:{field:es(e.field),op:Qo(e.op),value:e.value}}}(e):e instanceof Di?function(e){let t=e.getFilters().map((e=>ns(e)));return t.length===1?t[0]:{compositeFilter:{op:$o(e.op),filters:t}}}(e):O(54877,{filter:e})}function rs(e){let t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function is(e){return e.length>=4&&e.get(0)===`projects`&&e.get(2)===`databases`}var as=class e{constructor(e,t,n,r,i=V.min(),a=V.min(),o=G.EMPTY_BYTE_STRING,s=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=o,this.expectedCount=s}withSequenceNumber(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}},os=class{constructor(e){this.yt=e}};function ss(e){let t=Jo({parent:e.parent,structuredQuery:e.structuredQuery});return e.limitType===`LAST`?na(t,t.limit,`L`):t}var cs=class{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if(`nullValue`in e)this.Ft(t,5);else if(`booleanValue`in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if(`integerValue`in e)this.Ft(t,15),t.Mt(K(e.integerValue));else if(`doubleValue`in e){let n=K(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),Sr(n)?t.Mt(0):t.Mt(n))}else if(`timestampValue`in e){let n=e.timestampValue;this.Ft(t,20),typeof n==`string`&&(n=Lr(n)),t.xt(`${n.seconds||``}`),t.Mt(n.nanos||0)}else if(`stringValue`in e)this.Ot(e.stringValue,t),this.Nt(t);else if(`bytesValue`in e)this.Ft(t,30),t.Bt(Rr(e.bytesValue)),this.Nt(t);else if(`referenceValue`in e)this.Lt(e.referenceValue,t);else if(`geoPointValue`in e){let n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else `mapValue`in e?_i(e)?this.Ft(t,2**53-1):hi(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):`arrayValue`in e?(this.Qt(e.arrayValue,t),this.Nt(t)):O(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){let n=e.fields||{};this.Ft(t,55);for(let e of Object.keys(n))this.Ot(e,t),this.Ct(n[e],t)}kt(e,t){let n=e.fields||{};this.Ft(t,53);let r=$r,i=n[r].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(K(i)),this.Ot(r,t),this.Ct(n[r],t)}Qt(e,t){let n=e.values||[];this.Ft(t,50);for(let e of n)this.Ct(e,t)}Lt(e,t){this.Ft(t,37),L.fromName(e).path.forEach((e=>{this.Ft(t,60),this.Ut(e,t)}))}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}};cs.Kt=new cs;var ls=class{constructor(){this.Cn=new us}addToCollectionParentIndex(e,t){return this.Cn.add(t),H.resolve()}getCollectionParents(e,t){return H.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return H.resolve()}deleteFieldIndex(e,t){return H.resolve()}deleteAllFieldIndexes(e){return H.resolve()}createTargetIndexes(e,t){return H.resolve()}getDocumentsMatchingTarget(e,t){return H.resolve(null)}getIndexType(e,t){return H.resolve(0)}getFieldIndexes(e,t){return H.resolve([])}getNextCollectionGroupToUpdate(e){return H.resolve(null)}getMinOffset(e,t){return H.resolve(fr.min())}getMinOffsetFromCollectionGroup(e,t){return H.resolve(fr.min())}updateCollectionGroup(e,t,n){return H.resolve()}updateIndexEntries(e,t){return H.resolve()}},us=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new W(F.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new W(F.comparator)).toArray()}};new Uint8Array;var ds={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},fs=41943040,ps=class e{static withCacheSize(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}};ps.DEFAULT_COLLECTION_PERCENTILE=10,ps.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ps.DEFAULT=new ps(fs,ps.DEFAULT_COLLECTION_PERCENTILE,ps.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ps.DISABLED=new ps(-1,0,0);var ms=class e{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new e(0)}static cr(){return new e(-1)}},hs=`LruGarbageCollector`,gs=1048576;function _s([e,t],[n,r]){let i=P(e,n);return i===0?P(t,r):i}var vs=class{constructor(e){this.Ir=e,this.buffer=new W(_s),this.Er=0}dr(){return++this.Er}Ar(e){let t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();_s(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}},ys=class{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&=(this.Rr.cancel(),null)}get started(){return this.Rr!==null}Vr(e){D(hs,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay(`lru_garbage_collection`,e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){vr(e)?D(hs,`Ignoring IndexedDB error during garbage collection: `,e):await gr(e)}await this.Vr(3e5)}))}},bs=class{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(t===0)return H.resolve(yr.ce);let n=new vs(t);return this.mr.forEachTarget(e,(e=>n.Ar(e.sequenceNumber))).next((()=>this.mr.pr(e,(e=>n.Ar(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(D(`LruGarbageCollector`,`Garbage collection skipped; disabled`),H.resolve(ds)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(D(`LruGarbageCollector`,`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ds):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,r,i,a,o,s,c,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(D(`LruGarbageCollector`,`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,a=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,s=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(c=Date.now(),kn()<=y.DEBUG&&D(`LruGarbageCollector`,`LRU Garbage Collection\n\tCounted targets in ${a-l}ms\n\tDetermined least recently used ${r} in `+(o-a)+`ms
\tRemoved ${i} targets in `+(s-o)+`ms
\tRemoved ${e} documents in `+(c-s)+`ms
Total Duration: ${c-l}ms`),H.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}};function xs(e,t){return new bs(e,t)}var Ss=class{constructor(){this.changes=new ua((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,bi.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return n===void 0?this.getFromCache(e,t):H.resolve(n)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}},Cs=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}},ws=class{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(n!==null&&Ga(n.mutation,e,Pr.empty(),B.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,J()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=J()){let r=ga();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=ma();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){let n=ga();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,J())))}populateOverlays(e,t,n){let r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=fa(),a=va(),o=function(){return va()}();return t.forEach(((e,t)=>{let o=n.get(t.key);r.has(t.key)&&(o===void 0||o.mutation instanceof Ya)?i=i.insert(t.key,t):o===void 0?a.set(t.key,Pr.empty()):(a.set(t.key,o.mutation.getFieldMask()),Ga(o.mutation,t,o.mutation.getFieldMask(),B.now()))})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>a.set(e,t))),t.forEach(((e,t)=>o.set(e,new Cs(t,a.get(e)??null)))),o)))}recalculateAndSaveOverlays(e,t){let n=va(),r=new U(((e,t)=>e-t)),i=J();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(let i of e)i.keys().forEach((e=>{let a=t.get(e);if(a===null)return;let o=n.get(e)||Pr.empty();o=i.applyToLocalView(a,o),n.set(e,o);let s=(r.get(i.batchId)||J()).add(e);r=r.insert(i.batchId,s)}))})).next((()=>{let a=[],o=r.getReverseIterator();for(;o.hasNext();){let r=o.getNext(),s=r.key,c=r.value,l=_a();c.forEach((e=>{if(!i.has(e)){let r=Ua(t.get(e),n.get(e));r!==null&&l.set(e,r),i=i.add(e)}})),a.push(this.documentOverlayCache.saveOverlays(e,s,l))}return H.waitFor(a)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return L.isDocumentKey(e.path)&&e.collectionGroup===null&&e.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Zi(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{let a=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):H.resolve(ga()),o=cr,s=i;return a.next((t=>H.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?H.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{s=s.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,s,t,J()))).next((e=>({batchId:o,changes:ha(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next((e=>{let t=ma();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,a=ma();return this.indexManager.getCollectionParents(e,i).next((o=>H.forEach(o,(o=>{let s=function(e,t){return new qi(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return this.getDocumentsMatchingCollectionQuery(e,s,n,r).next((e=>{e.forEach(((e,t)=>{a=a.insert(e,t)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)))).next((e=>{i.forEach(((t,n)=>{let r=n.getKey();e.get(r)===null&&(e=e.insert(r,bi.newInvalidDocument(r)))}));let n=ma();return e.forEach(((e,r)=>{let a=i.get(e);a!==void 0&&Ga(a.mutation,r,Pr.empty(),B.now()),oa(t,r)&&(n=n.insert(e,r))})),n}))}},Ts=class{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return H.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Mo(e.createTime)}}(t)),H.resolve()}getNamedQuery(e,t){return H.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(e){return{name:e.name,query:ss(e.bundledQuery),readTime:Mo(e.readTime)}}(t)),H.resolve()}},Es=class{constructor(){this.overlays=new U(L.comparator),this.qr=new Map}getOverlay(e,t){return H.resolve(this.overlays.get(t))}getOverlays(e,t){let n=ga();return H.forEach(t,(t=>this.getOverlay(e,t).next((e=>{e!==null&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.St(e,t,r)})),H.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.qr.get(n);return r!==void 0&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.qr.delete(n)),H.resolve()}getOverlaysForCollection(e,t,n){let r=ga(),i=t.length+1,a=new L(t.child(``)),o=this.overlays.getIteratorFrom(a);for(;o.hasNext();){let e=o.getNext().value,a=e.getKey();if(!t.isPrefixOf(a.path))break;a.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return H.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new U(((e,t)=>e-t)),a=this.overlays.getIterator();for(;a.hasNext();){let e=a.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);t===null&&(t=ga(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let o=ga(),s=i.getIterator();for(;s.hasNext()&&(s.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return H.resolve(o)}St(e,t,n){let r=this.overlays.get(n.key);if(r!==null){let e=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new ro(t,n));let i=this.qr.get(t);i===void 0&&(i=J(),this.qr.set(t,i)),this.qr.set(t,i.add(n.key))}},Ds=class{constructor(){this.sessionToken=G.EMPTY_BYTE_STRING}getSessionToken(e){return H.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,H.resolve()}},Os=class{constructor(){this.Qr=new W(Z.$r),this.Ur=new W(Z.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){let n=new Z(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Gr(new Z(e,t))}zr(e,t){e.forEach((e=>this.removeReference(e,t)))}jr(e){let t=new L(new F([])),n=new Z(t,e),r=new Z(t,e+1),i=[];return this.Ur.forEachInRange([n,r],(e=>{this.Gr(e),i.push(e.key)})),i}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){let t=new L(new F([])),n=new Z(t,e),r=new Z(t,e+1),i=J();return this.Ur.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){let t=new Z(e,0),n=this.Qr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}},Z=class{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return L.comparator(e.key,t.key)||P(e.Yr,t.Yr)}static Kr(e,t){return P(e.Yr,t.Yr)||L.comparator(e.key,t.key)}},ks=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new W(Z.$r)}checkEmpty(e){return H.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,r){let i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new to(i,t,n,r);this.mutationQueue.push(a);for(let t of r)this.Zr=this.Zr.add(new Z(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return H.resolve(a)}lookupMutationBatch(e,t){return H.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=this.ei(n),i=r<0?0:r;return H.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return H.resolve(this.mutationQueue.length===0?br:this.tr-1)}getAllMutationBatches(e){return H.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new Z(t,0),r=new Z(t,1/0),i=[];return this.Zr.forEachInRange([n,r],(e=>{let t=this.Xr(e.Yr);i.push(t)})),H.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new W(P);return t.forEach((e=>{let t=new Z(e,0),r=new Z(e,1/0);this.Zr.forEachInRange([t,r],(e=>{n=n.add(e.Yr)}))})),H.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;L.isDocumentKey(i)||(i=i.child(``));let a=new Z(new L(i),0),o=new W(P);return this.Zr.forEachWhile((e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.Yr)),!0)}),a),H.resolve(this.ti(o))}ti(e){let t=[];return e.forEach((e=>{let n=this.Xr(e);n!==null&&t.push(n)})),t}removeMutationBatch(e,t){k(this.ni(t.batchId,`removed`)===0,55003),this.mutationQueue.shift();let n=this.Zr;return H.forEach(t.mutations,(r=>{let i=new Z(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Zr=n}))}ir(e){}containsKey(e,t){let n=new Z(t,0),r=this.Zr.firstAfterOrEqual(n);return H.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,H.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){let t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}},As=class{constructor(e){this.ri=e,this.docs=function(){return new U(L.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,a=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return H.resolve(n?n.document.mutableCopy():bi.newInvalidDocument(t))}getEntries(e,t){let n=fa();return t.forEach((e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():bi.newInvalidDocument(e))})),H.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=fa(),a=t.path,o=new L(a.child(`__id-9223372036854775808__`)),s=this.docs.getIteratorFrom(o);for(;s.hasNext();){let{key:e,value:{document:o}}=s.getNext();if(!a.isPrefixOf(e.path))break;e.path.length>a.length+1||pr(dr(o),n)<=0||(r.has(o.key)||oa(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return H.resolve(i)}getAllFromCollectionGroup(e,t,n,r){O(9500)}ii(e,t){return H.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new js(this)}getSize(e){return H.resolve(this.size)}},js=class extends Ss{constructor(e){super(),this.Nr=e}applyChanges(e){let t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(n)})),H.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}},Ms=class{constructor(e){this.persistence=e,this.si=new ua((e=>Wi(e)),Gi),this.lastRemoteSnapshotVersion=V.min(),this.highestTargetId=0,this.oi=0,this._i=new Os,this.targetCount=0,this.ai=ms.ur()}forEachTarget(e,t){return this.si.forEach(((e,n)=>t(n))),H.resolve()}getLastRemoteSnapshotVersion(e){return H.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return H.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),H.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),H.resolve()}Pr(e){this.si.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ai=new ms(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,H.resolve()}updateTargetData(e,t){return this.Pr(t),H.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),--this.targetCount,H.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.si.forEach(((a,o)=>{o.sequenceNumber<=t&&n.get(o.targetId)===null&&(this.si.delete(a),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),H.waitFor(i).next((()=>r))}getTargetCount(e){return H.resolve(this.targetCount)}getTargetData(e,t){let n=this.si.get(t)||null;return H.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),H.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),H.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),H.resolve()}getMatchingKeysForTargetId(e,t){let n=this._i.Hr(t);return H.resolve(n)}containsKey(e,t){return H.resolve(this._i.containsKey(t))}},Ns=class{constructor(e,t){this.ui={},this.overlays={},this.ci=new yr(0),this.li=!1,this.li=!0,this.hi=new Ds,this.referenceDelegate=e(this),this.Pi=new Ms(this),this.indexManager=new ls,this.remoteDocumentCache=function(e){return new As(e)}((e=>this.referenceDelegate.Ti(e))),this.serializer=new os(t),this.Ii=new Ts(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Es,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new ks(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){D(`MemoryPersistence`,`Starting transaction:`,e);let r=new Ps(this.ci.next());return this.referenceDelegate.Ei(),n(r).next((e=>this.referenceDelegate.di(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Ai(e,t){return H.or(Object.values(this.ui).map((n=>()=>n.containsKey(e,t))))}},Ps=class extends hr{constructor(e){super(),this.currentSequenceNumber=e}},Fs=class e{constructor(e){this.persistence=e,this.Ri=new Os,this.Vi=null}static mi(t){return new e(t)}get fi(){if(this.Vi)return this.Vi;throw O(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),H.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),H.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),H.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((e=>this.fi.add(e.toString())));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.fi.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return H.forEach(this.fi,(n=>{let r=L.fromPath(n);return this.gi(e,r).next((e=>{e||t.removeEntry(r,V.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return H.or([()=>H.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}},Is=class e{constructor(e,t){this.persistence=e,this.pi=new ua((e=>Tr(e.path)),((e,t)=>e.isEqual(t))),this.garbageCollector=xs(this,t)}static mi(t,n){return new e(t,n)}Ei(){}di(e){return H.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){let t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}wr(e){let t=0;return this.pr(e,(e=>{t++})).next((()=>t))}pr(e,t){return H.forEach(this.pi,((n,r)=>this.br(e,n,r).next((e=>e?H.resolve():t(r)))))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(e,(r=>this.br(e,r,t).next((e=>{e||(n++,i.removeEntry(r,V.min()))})))).next((()=>i.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),H.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),H.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),H.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),H.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=ci(e.data.value)),t}br(e,t,n){return H.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.pi.get(t);return H.resolve(e!==void 0&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}},Ls=class e{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=r}static As(t,n){let r=J(),i=J();for(let e of n.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:i=i.add(e.doc.key)}return new e(t,n.fromCache,r,i)}},Rs=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}},zs=class{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return me()?8:_r(fe())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.ys(e,t).next((e=>{i.result=e})).next((()=>{if(!i.result)return this.ws(e,t,r,n).next((e=>{i.result=e}))})).next((()=>{if(i.result)return;let n=new Rs;return this.Ss(e,t,n).next((r=>{if(i.result=r,this.Vs)return this.bs(e,t,n,r.size)}))})).next((()=>i.result))}bs(e,t,n,r){return n.documentReadCount<this.fs?(kn()<=y.DEBUG&&D(`QueryEngine`,`SDK will not create cache indexes for query:`,aa(t),`since it only creates cache indexes for collection contains`,`more than or equal to`,this.fs,`documents`),H.resolve()):(kn()<=y.DEBUG&&D(`QueryEngine`,`Query:`,aa(t),`scans`,n.documentReadCount,`local documents and returns`,r,`documents as results.`),n.documentReadCount>this.gs*r?(kn()<=y.DEBUG&&D(`QueryEngine`,`The SDK decides to create cache indexes for query:`,aa(t),`as using cache indexes may help improve performance.`),this.indexManager.createTargetIndexes(e,$i(t))):H.resolve())}ys(e,t){if(Xi(t))return H.resolve(null);let n=$i(t);return this.indexManager.getIndexType(e,n).next((r=>r===0?null:(t.limit!==null&&r===1&&(t=na(t,null,`F`),n=$i(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{let i=J(...r);return this.ps.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{let a=this.Ds(t,r);return this.Cs(t,a,i,n.readTime)?this.ys(e,na(t,null,`F`)):this.vs(e,a,t,n)}))))})))))}ws(e,t,n,r){return Xi(t)||r.isEqual(V.min())?H.resolve(null):this.ps.getDocuments(e,n).next((i=>{let a=this.Ds(t,i);return this.Cs(t,a,n,r)?H.resolve(null):(kn()<=y.DEBUG&&D(`QueryEngine`,`Re-using previous result from %s to execute query: %s`,r.toString(),aa(t)),this.vs(e,a,t,ur(r,cr)).next((e=>e)))}))}Ds(e,t){let n=new W(ca(e));return t.forEach(((t,r)=>{oa(e,r)&&(n=n.add(r))})),n}Cs(e,t,n,r){if(e.limit===null)return!1;if(n.size!==t.size)return!0;let i=e.limitType===`F`?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,n){return kn()<=y.DEBUG&&D(`QueryEngine`,`Using full collection scan to execute query:`,aa(t)),this.ps.getDocumentsMatchingQuery(e,t,fr.min(),n)}vs(e,t,n,r){return this.ps.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}},Bs=`LocalStore`,Vs=3e8,Hs=class{constructor(e,t,n,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new U(P),this.xs=new ua((e=>Wi(e)),Gi),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ws(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction(`Collect garbage`,`readwrite-primary`,(t=>e.collect(t,this.Ms)))}};function Us(e,t,n,r){return new Hs(e,t,n,r)}async function Ws(e,t){let n=A(e);return await n.persistence.runTransaction(`Handle user change`,`readonly`,(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n.Bs(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{let i=[],a=[],o=J();for(let e of r){i.push(e.batchId);for(let t of e.mutations)o=o.add(t.key)}for(let e of t){a.push(e.batchId);for(let t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({Ls:e,removedBatchIds:i,addedBatchIds:a})))}))}))}function Gs(e,t){let n=A(e);return n.persistence.runTransaction(`Acknowledge batch`,`readwrite-primary`,(e=>{let r=t.batch.keys(),i=n.Ns.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){let i=n.batch,a=i.keys(),o=H.resolve();return a.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{let a=n.docVersions.get(e);k(a!==null,48541),t.version.compareTo(a)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=J();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}function Ks(e){let t=A(e);return t.persistence.runTransaction(`Get last remote snapshot version`,`readonly`,(e=>t.Pi.getLastRemoteSnapshotVersion(e)))}function qs(e,t){let n=A(e),r=t.snapshotVersion,i=n.Ms;return n.persistence.runTransaction(`Apply remote event`,`readwrite-primary`,(e=>{let a=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;let o=[];t.targetChanges.forEach(((a,s)=>{let c=i.get(s);if(!c)return;o.push(n.Pi.removeMatchingKeys(e,a.removedDocuments,s).next((()=>n.Pi.addMatchingKeys(e,a.addedDocuments,s))));let l=c.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.get(s)===null?a.resumeToken.approximateByteSize()>0&&(l=l.withResumeToken(a.resumeToken,r)):l=l.withResumeToken(G.EMPTY_BYTE_STRING,V.min()).withLastLimboFreeSnapshotVersion(V.min()),i=i.insert(s,l),function(e,t,n){return e.resumeToken.approximateByteSize()===0||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=Vs?!0:n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,l,a)&&o.push(n.Pi.updateTargetData(e,l))}));let s=fa(),c=J();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(Js(e,a,t.documentUpdates).next((e=>{s=e.ks,c=e.qs}))),!r.isEqual(V.min())){let t=n.Pi.getLastRemoteSnapshotVersion(e).next((t=>n.Pi.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return H.waitFor(o).next((()=>a.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,s,c))).next((()=>s))})).then((e=>(n.Ms=i,e)))}function Js(e,t,n){let r=J(),i=J();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=fa();return n.forEach(((n,a)=>{let o=e.get(n);a.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),a.isNoDocument()&&a.version.isEqual(V.min())?(t.removeEntry(n,a.readTime),r=r.insert(n,a)):!o.isValidDocument()||a.version.compareTo(o.version)>0||a.version.compareTo(o.version)===0&&o.hasPendingWrites?(t.addEntry(a),r=r.insert(n,a)):D(Bs,`Ignoring outdated watch update for `,n,`. Current version:`,o.version,` Watch version:`,a.version)})),{ks:r,qs:i}}))}function Ys(e,t){let n=A(e);return n.persistence.runTransaction(`Get next mutation batch`,`readonly`,(e=>(t===void 0&&(t=br),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function Xs(e,t){let n=A(e);return n.persistence.runTransaction(`Allocate target`,`readwrite`,(e=>{let r;return n.Pi.getTargetData(e,t).next((i=>i?(r=i,H.resolve(r)):n.Pi.allocateTargetId(e).next((i=>(r=new as(t,i,`TargetPurposeListen`,e.currentSequenceNumber),n.Pi.addTargetData(e,r).next((()=>r)))))))})).then((e=>{let r=n.Ms.get(e.targetId);return(r===null||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(e.targetId,e),n.xs.set(t,e.targetId)),e}))}async function Zs(e,t,n){let r=A(e),i=r.Ms.get(t),a=n?`readwrite`:`readwrite-primary`;try{n||await r.persistence.runTransaction(`Release target`,a,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!vr(e))throw e;D(Bs,`Failed to update sequence numbers for target ${t}: ${e}`)}r.Ms=r.Ms.remove(t),r.xs.delete(i.target)}function Qs(e,t,n){let r=A(e),i=V.min(),a=J();return r.persistence.runTransaction(`Execute query`,`readwrite`,(e=>function(e,t,n){let r=A(e),i=r.xs.get(n);return i===void 0?r.Pi.getTargetData(t,n):H.resolve(r.Ms.get(i))}(r,e,$i(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(e,t.targetId).next((e=>{a=e}))})).next((()=>r.Fs.getDocumentsMatchingQuery(e,t,n?i:V.min(),n?a:J()))).next((e=>($s(r,sa(t),e),{documents:e,Qs:a})))))}function $s(e,t,n){let r=e.Os.get(t)||V.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.Os.set(t,r)}var ec=class{constructor(){this.activeTargetIds=Sa()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},tc=class{constructor(){this.Mo=new ec,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||`not-current`}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new ec,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}},nc=class{Oo(e){}shutdown(){}},rc=`ConnectivityMonitor`,ic=class{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener(`online`,this.No),window.removeEventListener(`offline`,this.Lo)}Qo(){window.addEventListener(`online`,this.No),window.addEventListener(`offline`,this.Lo)}Bo(){D(rc,`Network connectivity changed: AVAILABLE`);for(let e of this.qo)e(0)}ko(){D(rc,`Network connectivity changed: UNAVAILABLE`);for(let e of this.qo)e(1)}static v(){return typeof window<`u`&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}},ac=null;function oc(){return ac===null?ac=function(){return 268435456+Math.round(2147483648*Math.random())}():ac++,`0x`+ac.toString(16)}var sc=`RestConnection`,cc={BatchGetDocuments:`batchGet`,Commit:`commit`,RunQuery:`runQuery`,RunAggregationQuery:`runAggregationQuery`},lc=class{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?`https`:`http`,n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+`://`+e.host,this.Ko=`projects/${n}/databases/${r}`,this.Wo=this.databaseId.database===qr?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Go(e,t,n,r,i){let a=oc(),o=this.zo(e,t.toUriEncodedString());D(sc,`Sending RPC '${e}' ${a}:`,o,n);let s={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(s,r,i);let{host:c}=new URL(o),l=oe(c);return this.Jo(e,o,s,n,l).then((t=>(D(sc,`Received RPC '${e}' ${a}: `,t),t)),(t=>{throw jn(sc,`RPC '${e}' ${a} failed with error: `,t,`url: `,o,`request:`,n),t}))}Ho(e,t,n,r,i,a){return this.Go(e,t,n,r,i)}jo(e,t,n){e[`X-Goog-Api-Client`]=function(){return`gl-js/ fire/`+Dn}(),e[`Content-Type`]=`text/plain`,this.databaseInfo.appId&&(e[`X-Firebase-GMPID`]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}zo(e,t){let n=cc[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}},uc=class{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}},Q=`WebChannelConnection`,dc=class extends lc{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,r,i){let a=oc();return new Promise(((i,o)=>{let s=new _n;s.setWithCredentials(!0),s.listenOnce(yn.COMPLETE,(()=>{try{switch(s.getLastErrorCode()){case bn.NO_ERROR:let t=s.getResponseJson();D(Q,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(t)),i(t);break;case bn.TIMEOUT:D(Q,`RPC '${e}' ${a} timed out`),o(new M(j.DEADLINE_EXCEEDED,`Request time out`));break;case bn.HTTP_ERROR:let n=s.getStatus();if(D(Q,`RPC '${e}' ${a} failed with status:`,n,`response text:`,s.getResponseText()),n>0){let e=s.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;t&&t.status&&t.message?o(new M(function(e){let t=e.toLowerCase().replace(/_/g,`-`);return Object.values(j).indexOf(t)>=0?t:j.UNKNOWN}(t.status),t.message)):o(new M(j.UNKNOWN,`Server responded with status `+s.getStatus()))}else o(new M(j.UNAVAILABLE,`Connection failed.`));break;default:O(9055,{l_:e,streamId:a,h_:s.getLastErrorCode(),P_:s.getLastError()})}}finally{D(Q,`RPC '${e}' ${a} completed.`)}}));let c=JSON.stringify(r);D(Q,`RPC '${e}' ${a} sending request:`,r),s.send(t,`POST`,c,n,15)}))}T_(e,t,n){let r=oc(),i=[this.Uo,`/`,`google.firestore.v1.Firestore`,`/`,e,`/channel`],a=wn(),o=Cn(),s={httpSessionIdParam:`gsessionid`,initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(s.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(s.useFetchStreams=!0),this.jo(s.initMessageHeaders,t,n),s.encodeInitMessageHeaders=!0;let l=i.join(``);D(Q,`Creating RPC '${e}' stream ${r}: ${l}`,s);let u=a.createWebChannel(l,s);this.I_(u);let d=!1,f=!1,p=new uc({Yo:t=>{f?D(Q,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(d||=(D(Q,`Opening RPC '${e}' stream ${r} transport.`),u.open(),!0),D(Q,`RPC '${e}' stream ${r} sending:`,t),u.send(t))},Zo:()=>u.close()}),m=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return m(u,vn.EventType.OPEN,(()=>{f||(D(Q,`RPC '${e}' stream ${r} transport opened.`),p.o_())})),m(u,vn.EventType.CLOSE,(()=>{f||(f=!0,D(Q,`RPC '${e}' stream ${r} transport closed`),p.a_(),this.E_(u))})),m(u,vn.EventType.ERROR,(t=>{f||(f=!0,jn(Q,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,`Message:`,t.message),p.a_(new M(j.UNAVAILABLE,`The operation could not be completed`)))})),m(u,vn.EventType.MESSAGE,(t=>{if(!f){let n=t.data[0];k(!!n,16349);let i=n,a=i?.error||i[0]?.error;if(a){D(Q,`RPC '${e}' stream ${r} received error:`,a);let t=a.status,n=function(e){let t=Y[e];if(t!==void 0)return oo(t)}(t),i=a.message;n===void 0&&(n=j.INTERNAL,i=`Unknown error status: `+t+` with message `+a.message),f=!0,p.a_(new M(n,i)),u.close()}else D(Q,`RPC '${e}' stream ${r} received:`,n),p.u_(n)}})),m(o,Sn.STAT_EVENT,(t=>{t.stat===xn.PROXY?D(Q,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===xn.NOPROXY&&D(Q,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{p.__()}),0),p}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}};function fc(){return typeof document<`u`?document:null}function pc(e){return new Do(e,!0)}var mc=class{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();let t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&D(`ExponentialBackoff`,`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}},hc=`PersistentStream`,gc=class{constructor(e,t,n,r,i,a,o,s){this.Mi=e,this.S_=n,this.b_=r,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=o,this.listener=s,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new mc(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state===4?this.N_():this.auth()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&=(this.C_.cancel(),null)}U_(){this.v_&&=(this.v_.cancel(),null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e===4?t&&t.code===j.RESOURCE_EXHAUSTED?(An(t.toString()),An(`Using maximum backoff delay to prevent overloading the backend.`),this.M_.g_()):t&&t.code===j.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()):this.M_.reset(),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;let e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.D_===t&&this.G_(e,n)}),(t=>{e((()=>{let e=new M(j.UNKNOWN,`Fetching auth token failed: `+t.message);return this.z_(e)}))}))}G_(e,t){let n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{n((()=>this.listener.Xo()))})),this.stream.t_((()=>{n((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((e=>{n((()=>this.z_(e)))})),this.stream.onMessage((e=>{n((()=>++this.F_==1?this.J_(e):this.onNext(e)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return D(hc,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(D(hc,`stream callback skipped by getCloseGuardedDispatcher.`),Promise.resolve())))}}},_c=class extends gc{constructor(e,t,n,r,i,a){super(e,`listen_stream_connection_backoff`,`listen_stream_idle`,`health_check_timeout`,t,n,r,a),this.serializer=i}j_(e,t){return this.connection.T_(`Listen`,e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=Uo(this.serializer,e),n=function(e){if(!(`targetChange`in e))return V.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?V.min():t.readTime?Mo(t.readTime):V.min()}(e);return this.listener.H_(t,n)}Y_(e){let t={};t.database=Bo(this.serializer),t.addTarget=function(e,t){let n,r=t.target;if(n=Ki(r)?{documents:Ko(e,r)}:{query:qo(e,r).ft},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Ao(e,t.resumeToken);let r=Oo(e,t.expectedCount);r!==null&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(V.min())>0){n.readTime=ko(e,t.snapshotVersion.toTimestamp());let r=Oo(e,t.expectedCount);r!==null&&(n.expectedCount=r)}return n}(this.serializer,e);let n=Yo(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){let t={};t.database=Bo(this.serializer),t.removeTarget=e,this.q_(t)}},vc=class extends gc{constructor(e,t,n,r,i,a){super(e,`write_stream_connection_backoff`,`write_stream_idle`,`health_check_timeout`,t,n,r,a),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_(`Write`,e,t)}J_(e){return k(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,k(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){k(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let t=Go(e.writeResults,e.commitTime),n=Mo(e.commitTime);return this.listener.na(n,t)}ra(){let e={};e.database=Bo(this.serializer),this.q_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map((e=>Wo(this.serializer,e)))};this.q_(t)}},yc=class{},bc=class extends yc{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new M(j.FAILED_PRECONDITION,`The client has already been terminated.`)}Go(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,a])=>this.connection.Go(e,Po(t,n),r,i,a))).catch((e=>{throw e.name===`FirebaseError`?(e.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new M(j.UNKNOWN,e.toString())}))}Ho(e,t,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,o])=>this.connection.Ho(e,Po(t,n),r,a,o,i))).catch((e=>{throw e.name===`FirebaseError`?(e.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new M(j.UNKNOWN,e.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}},xc=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state=`Unknown`,this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca(`Unknown`),this._a=this.asyncQueue.enqueueAfterDelay(`online_state_timeout`,1e4,(()=>(this._a=null,this.la(`Backend didn't respond within 10 seconds.`),this.ca(`Offline`),Promise.resolve()))))}ha(e){this.state===`Online`?this.ca(`Unknown`):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca(`Offline`)))}set(e){this.Pa(),this.oa=0,e===`Online`&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(An(t),this.aa=!1):D(`OnlineStateTracker`,t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}},Sc=`RemoteStore`,Cc=class{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo((e=>{n.enqueueAndForget((async()=>{Mc(this)&&(D(Sc,`Restarting streams for network reachability change.`),await async function(e){let t=A(e);t.Ea.add(4),await Tc(t),t.Ra.set(`Unknown`),t.Ea.delete(4),await wc(t)}(this))}))})),this.Ra=new xc(n,r)}};async function wc(e){if(Mc(e))for(let t of e.da)await t(!0)}async function Tc(e){for(let t of e.da)await t(!1)}function Ec(e,t){let n=A(e);n.Ia.has(t.targetId)||(n.Ia.set(t.targetId,t),jc(n)?Ac(n):Zc(n).O_()&&Oc(n,t))}function Dc(e,t){let n=A(e),r=Zc(n);n.Ia.delete(t),r.O_()&&kc(n,t),n.Ia.size===0&&(r.O_()?r.L_():Mc(n)&&n.Ra.set(`Unknown`))}function Oc(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(V.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Zc(e).Y_(t)}function kc(e,t){e.Va.Ue(t),Zc(e).Z_(t)}function Ac(e){e.Va=new xo({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),Zc(e).start(),e.Ra.ua()}function jc(e){return Mc(e)&&!Zc(e).x_()&&e.Ia.size>0}function Mc(e){return A(e).Ea.size===0}function Nc(e){e.Va=void 0}async function Pc(e){e.Ra.set(`Online`)}async function Fc(e){e.Ia.forEach(((t,n)=>{Oc(e,t)}))}async function Ic(e,t){Nc(e),jc(e)?(e.Ra.ha(t),Ac(e)):e.Ra.set(`Unknown`)}async function Lc(e,t,n){if(e.Ra.set(`Online`),t instanceof yo&&t.state===2&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.Ia.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ia.delete(r),e.Va.removeTarget(r))}(e,t)}catch(n){D(Sc,`Failed to remove targets %s: %s `,t.targetIds.join(`,`),n),await Rc(e,n)}else if(t instanceof _o?e.Va.Ze(t):t instanceof vo?e.Va.st(t):e.Va.tt(t),!n.isEqual(V.min()))try{let t=await Ks(e.localStore);n.compareTo(t)>=0&&await function(e,t){let n=e.Va.Tt(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){let i=e.Ia.get(r);i&&e.Ia.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{let r=e.Ia.get(t);r&&(e.Ia.set(t,r.withResumeToken(G.EMPTY_BYTE_STRING,r.snapshotVersion)),kc(e,t),Oc(e,new as(r.target,t,n,r.sequenceNumber)))})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){D(Sc,`Failed to raise snapshot:`,t),await Rc(e,t)}}async function Rc(e,t,n){if(!vr(t))throw t;e.Ea.add(1),await Tc(e),e.Ra.set(`Offline`),n||=()=>Ks(e.localStore),e.asyncQueue.enqueueRetryable((async()=>{D(Sc,`Retrying IndexedDB access`),await n(),e.Ea.delete(1),await wc(e)}))}function zc(e,t){return t().catch((n=>Rc(e,n,t)))}async function Bc(e){let t=A(e),n=Qc(t),r=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:br;for(;Vc(t);)try{let e=await Ys(t.localStore,r);if(e===null){t.Ta.length===0&&n.L_();break}r=e.batchId,Hc(t,e)}catch(e){await Rc(t,e)}Uc(t)&&Wc(t)}function Vc(e){return Mc(e)&&e.Ta.length<10}function Hc(e,t){e.Ta.push(t);let n=Qc(e);n.O_()&&n.X_&&n.ea(t.mutations)}function Uc(e){return Mc(e)&&!Qc(e).x_()&&e.Ta.length>0}function Wc(e){Qc(e).start()}async function Gc(e){Qc(e).ra()}async function Kc(e){let t=Qc(e);for(let n of e.Ta)t.ea(n.mutations)}async function qc(e,t,n){let r=e.Ta.shift(),i=no.from(r,t,n);await zc(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await Bc(e)}async function Jc(e,t){t&&Qc(e).X_&&await async function(e,t){if(function(e){return ao(e)&&e!==j.ABORTED}(t.code)){let n=e.Ta.shift();Qc(e).B_(),await zc(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await Bc(e)}}(e,t),Uc(e)&&Wc(e)}async function Yc(e,t){let n=A(e);n.asyncQueue.verifyOperationInProgress(),D(Sc,`RemoteStore received new credentials`);let r=Mc(n);n.Ea.add(3),await Tc(n),r&&n.Ra.set(`Unknown`),await n.remoteSyncer.handleCredentialChange(t),n.Ea.delete(3),await wc(n)}async function Xc(e,t){let n=A(e);t?(n.Ea.delete(2),await wc(n)):t||(n.Ea.add(2),await Tc(n),n.Ra.set(`Unknown`))}function Zc(e){return e.ma||(e.ma=function(e,t,n){let r=A(e);return r.sa(),new _c(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Xo:Pc.bind(null,e),t_:Fc.bind(null,e),r_:Ic.bind(null,e),H_:Lc.bind(null,e)}),e.da.push((async t=>{t?(e.ma.B_(),jc(e)?Ac(e):e.Ra.set(`Unknown`)):(await e.ma.stop(),Nc(e))}))),e.ma}function Qc(e){return e.fa||(e.fa=function(e,t,n){let r=A(e);return r.sa(),new vc(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Xo:()=>Promise.resolve(),t_:Gc.bind(null,e),r_:Jc.bind(null,e),ta:Kc.bind(null,e),na:qc.bind(null,e)}),e.da.push((async t=>{t?(e.fa.B_(),await Bc(e)):(await e.fa.stop(),e.Ta.length>0&&(D(Sc,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))}))),e.fa}var $c=class e{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new N,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,n,r,i,a){let o=new e(t,n,Date.now()+r,i,a);return o.start(r),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new M(j.CANCELLED,`Operation cancelled`+(e?`: `+e:``))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle===null?Promise.resolve():(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e))))))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function el(e,t){if(An(`AsyncQueue`,`${t}: ${e}`),vr(e))return new M(j.UNAVAILABLE,`${t}: ${e}`);throw e}var tl=class e{static emptySet(t){return new e(t.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||L.comparator(t.key,n.key):(e,t)=>L.comparator(e.key,t.key),this.keyedMap=ma(),this.sortedSet=new U(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(t){if(!(t instanceof e)||this.size!==t.size)return!1;let n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;n.hasNext();){let e=n.getNext().key,t=r.getNext().key;if(!e.isEqual(t))return!1}return!0}toString(){let e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?`DocumentSet ()`:`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(t,n){let r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r}},nl=class{constructor(){this.ga=new U(L.comparator)}track(e){let t=e.doc.key,n=this.ga.get(t);n?e.type!==0&&n.type===3?this.ga=this.ga.insert(t,e):e.type===3&&n.type!==1?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.ga=this.ga.remove(t):e.type===1&&n.type===2?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):O(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal(((t,n)=>{e.push(n)})),e}},rl=class e{constructor(e,t,n,r,i,a,o,s,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=o,this.excludesMetadataChanges=s,this.hasCachedResults=c}static fromInitialDocuments(t,n,r,i,a){let o=[];return n.forEach((e=>{o.push({type:0,doc:e})})),new e(t,n,tl.emptySet(n),o,r,i,!0,!1,a)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ra(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}},il=class{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}},al=class{constructor(){this.queries=ol(),this.onlineState=`Unknown`,this.Ca=new Set}terminate(){(function(e,t){let n=A(e),r=n.queries;n.queries=ol(),r.forEach(((e,n)=>{for(let e of n.Sa)e.onError(t)}))})(this,new M(j.ABORTED,`Firestore shutting down`))}};function ol(){return new ua((e=>ia(e)),ra)}async function sl(e,t){let n=A(e),r=3,i=t.query,a=n.queries.get(i);a?!a.ba()&&t.Da()&&(r=2):(a=new il,r=t.Da()?0:1);try{switch(r){case 0:a.wa=await n.onListen(i,!0);break;case 1:a.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(e){let n=el(e,`Initialization of query '${aa(t.query)}' failed`);t.onError(n);return}n.queries.set(i,a),a.Sa.push(t),t.va(n.onlineState),a.wa&&t.Fa(a.wa)&&dl(n)}async function cl(e,t){let n=A(e),r=t.query,i=3,a=n.queries.get(r);if(a){let e=a.Sa.indexOf(t);e>=0&&(a.Sa.splice(e,1),a.Sa.length===0?i=t.Da()?0:1:!a.ba()&&t.Da()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function ll(e,t){let n=A(e),r=!1;for(let e of t){let t=e.query,i=n.queries.get(t);if(i){for(let t of i.Sa)t.Fa(e)&&(r=!0);i.wa=e}}r&&dl(n)}function ul(e,t,n){let r=A(e),i=r.queries.get(t);if(i)for(let e of i.Sa)e.onError(n);r.queries.delete(t)}function dl(e){e.Ca.forEach((e=>{e.next()}))}var fl,pl;(pl=fl||={}).Ma=`default`,pl.Cache=`cache`;var ml=class{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState=`Unknown`,this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)n.type!==3&&t.push(n);e=new rl(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;let n=t!==`Offline`;return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t===`Offline`)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=rl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==fl.Cache}},hl=class{constructor(e){this.key=e}},gl=class{constructor(e){this.key=e}},_l=class{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=J(),this.mutatedKeys=J(),this.eu=ca(e),this.tu=new tl(this.eu)}get nu(){return this.Ya}ru(e,t){let n=t?t.iu:new nl,r=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,a=r,o=!1,s=this.query.limitType===`F`&&r.size===this.query.limit?r.last():null,c=this.query.limitType===`L`&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{let l=r.get(e),u=oa(this.query,t)?t:null,d=!!l&&this.mutatedKeys.has(l.key),f=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations),p=!1;l&&u?l.data.isEqual(u.data)?d!==f&&(n.track({type:3,doc:u}),p=!0):this.su(l,u)||(n.track({type:2,doc:u}),p=!0,(s&&this.eu(u,s)>0||c&&this.eu(u,c)<0)&&(o=!0)):!l&&u?(n.track({type:0,doc:u}),p=!0):l&&!u&&(n.track({type:1,doc:l}),p=!0,(s||c)&&(o=!0)),p&&(u?(a=a.add(u),i=f?i.add(e):i.delete(e)):(a=a.delete(e),i=i.delete(e)))})),this.query.limit!==null)for(;a.size>this.query.limit;){let e=this.query.limitType===`F`?a.last():a.first();a=a.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{tu:a,iu:n,Cs:o,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let a=e.iu.ya();a.sort(((e,t)=>function(e,t){let n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return O(20277,{Rt:e})}};return n(e)-n(t)}(e.type,t.type)||this.eu(e.doc,t.doc))),this.ou(n),r??=!1;let o=t&&!r?this._u():[],s=this.Xa.size===0&&this.current&&!r?1:0,c=s!==this.Za;return this.Za=s,a.length!==0||c?{snapshot:new rl(this.query,e.tu,i,a,e.mutatedKeys,s===0,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&e===`Offline`?(this.current=!1,this.applyChanges({tu:this.tu,iu:new nl,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((e=>this.Ya=this.Ya.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Ya=this.Ya.delete(e))),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Xa;this.Xa=J(),this.tu.forEach((e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))}));let t=[];return e.forEach((e=>{this.Xa.has(e)||t.push(new gl(e))})),this.Xa.forEach((n=>{e.has(n)||t.push(new hl(n))})),t}cu(e){this.Ya=e.Qs,this.Xa=J();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return rl.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}},vl=`SyncEngine`,yl=class{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}},bl=class{constructor(e){this.key=e,this.hu=!1}},xl=class{constructor(e,t,n,r,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new ua((e=>ia(e)),ra),this.Iu=new Map,this.Eu=new Set,this.du=new U(L.comparator),this.Au=new Map,this.Ru=new Os,this.Vu={},this.mu=new Map,this.fu=ms.cr(),this.onlineState=`Unknown`,this.gu=void 0}get isPrimaryClient(){return!0===this.gu}};async function Sl(e,t,n=!0){let r=Wl(e),i,a=r.Tu.get(t);return a?(r.sharedClientState.addLocalQueryTarget(a.targetId),i=a.view.lu()):i=await wl(r,t,n,!0),i}async function Cl(e,t){await wl(Wl(e),t,!0,!1)}async function wl(e,t,n,r){let i=await Xs(e.localStore,$i(t)),a=i.targetId,o=e.sharedClientState.addLocalQueryTarget(a,n),s;return r&&(s=await Tl(e,t,a,o===`current`,i.resumeToken)),e.isPrimaryClient&&n&&Ec(e.remoteStore,i),s}async function Tl(e,t,n,r,i){e.pu=(t,n,r)=>async function(e,t,n,r){let i=t.view.ru(n);i.Cs&&(i=await Qs(e.localStore,t.query,!1).then((({documents:e})=>t.view.ru(e,i))));let a=r&&r.targetChanges.get(t.targetId),o=r&&r.targetMismatches.get(t.targetId)!=null,s=t.view.applyChanges(i,e.isPrimaryClient,a,o);return Rl(e,t.targetId,s.au),s.snapshot}(e,t,n,r);let a=await Qs(e.localStore,t,!0),o=new _l(t,a.Qs),s=o.ru(a.documents),c=go.createSynthesizedTargetChangeForCurrentChange(n,r&&e.onlineState!==`Offline`,i),l=o.applyChanges(s,e.isPrimaryClient,c);Rl(e,n,l.au);let u=new yl(t,n,o);return e.Tu.set(t,u),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),l.snapshot}async function El(e,t,n){let r=A(e),i=r.Tu.get(t),a=r.Iu.get(i.targetId);if(a.length>1)return r.Iu.set(i.targetId,a.filter((e=>!ra(e,t)))),void r.Tu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Zs(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&Dc(r.remoteStore,i.targetId),Il(r,i.targetId)})).catch(gr)):(Il(r,i.targetId),await Zs(r.localStore,i.targetId,!0))}async function Dl(e,t){let n=A(e),r=n.Tu.get(t),i=n.Iu.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Dc(n.remoteStore,r.targetId))}async function Ol(e,t,n){let r=Gl(e);try{let e=await function(e,t){let n=A(e),r=B.now(),i=t.reduce(((e,t)=>e.add(t.key)),J()),a,o;return n.persistence.runTransaction(`Locally write mutations`,`readwrite`,(e=>{let s=fa(),c=J();return n.Ns.getEntries(e,i).next((e=>{s=e,s.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,s))).next((i=>{a=i;let o=[];for(let e of t){let t=Ka(e,a.get(e.key).overlayedDocument);t!=null&&o.push(new Ya(e.key,t,yi(t.value.mapValue),Ba.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;let r=t.applyToLocalDocumentSet(a,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:ha(a)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Vu[e.currentUser.toKey()];r||=new U(P),r=r.insert(t,n),e.Vu[e.currentUser.toKey()]=r}(r,e.batchId,n),await Vl(r,e.changes),await Bc(r.remoteStore)}catch(e){let t=el(e,`Failed to persist write`);n.reject(t)}}async function kl(e,t){let n=A(e);try{let e=await qs(n.localStore,t);t.targetChanges.forEach(((e,t)=>{let r=n.Au.get(t);r&&(k(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?r.hu=!0:e.modifiedDocuments.size>0?k(r.hu,14607):e.removedDocuments.size>0&&(k(r.hu,42227),r.hu=!1))})),await Vl(n,e,t)}catch(e){await gr(e)}}function Al(e,t,n){let r=A(e);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){let e=[];r.Tu.forEach(((n,r)=>{let i=r.view.va(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){let n=A(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(let e of n.Sa)e.va(t)&&(r=!0)})),r&&dl(n)}(r.eventManager,t),e.length&&r.Pu.H_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function jl(e,t,n){let r=A(e);r.sharedClientState.updateQueryState(t,`rejected`,n);let i=r.Au.get(t),a=i&&i.key;if(a){let e=new U(L.comparator);e=e.insert(a,bi.newNoDocument(a,V.min()));let n=J().add(a);await kl(r,new ho(V.min(),new Map,new U(P),e,n)),r.du=r.du.remove(a),r.Au.delete(t),Bl(r)}else await Zs(r.localStore,t,!1).then((()=>Il(r,t,n))).catch(gr)}async function Ml(e,t){let n=A(e),r=t.batch.batchId;try{let e=await Gs(n.localStore,t);Fl(n,r,null),Pl(n,r),n.sharedClientState.updateMutationState(r,`acknowledged`),await Vl(n,e)}catch(e){await gr(e)}}async function Nl(e,t,n){let r=A(e);try{let e=await function(e,t){let n=A(e);return n.persistence.runTransaction(`Reject batch`,`readwrite-primary`,(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(k(t!==null,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);Fl(r,t,n),Pl(r,t),r.sharedClientState.updateMutationState(t,`rejected`,n),await Vl(r,e)}catch(e){await gr(e)}}function Pl(e,t){(e.mu.get(t)||[]).forEach((e=>{e.resolve()})),e.mu.delete(t)}function Fl(e,t,n){let r=A(e),i=r.Vu[r.currentUser.toKey()];if(i){let e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Vu[r.currentUser.toKey()]=i}}function Il(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(let r of e.Iu.get(t))e.Tu.delete(r),n&&e.Pu.yu(r,n);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach((t=>{e.Ru.containsKey(t)||Ll(e,t)}))}function Ll(e,t){e.Eu.delete(t.path.canonicalString());let n=e.du.get(t);n!==null&&(Dc(e.remoteStore,n),e.du=e.du.remove(t),e.Au.delete(n),Bl(e))}function Rl(e,t,n){for(let r of n)r instanceof hl?(e.Ru.addReference(r.key,t),zl(e,r)):r instanceof gl?(D(vl,`Document no longer in limbo: `+r.key),e.Ru.removeReference(r.key,t),e.Ru.containsKey(r.key)||Ll(e,r.key)):O(19791,{wu:r})}function zl(e,t){let n=t.key,r=n.path.canonicalString();e.du.get(n)||e.Eu.has(r)||(D(vl,`New document in limbo: `+n),e.Eu.add(r),Bl(e))}function Bl(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let n=new L(F.fromString(t)),r=e.fu.next();e.Au.set(r,new bl(n)),e.du=e.du.insert(n,r),Ec(e.remoteStore,new as($i(Yi(n.path)),r,`TargetPurposeLimboResolution`,yr.ce))}}async function Vl(e,t,n){let r=A(e),i=[],a=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach(((e,s)=>{o.push(r.pu(s,t,n).then((e=>{if((e||n)&&r.isPrimaryClient){let t=e?!e.fromCache:n?.targetChanges.get(s.targetId)?.current;r.sharedClientState.updateQueryState(s.targetId,t?`current`:`not-current`)}if(e){i.push(e);let t=Ls.As(s.targetId,e);a.push(t)}})))})),await Promise.all(o),r.Pu.H_(i),await async function(e,t){let n=A(e);try{await n.persistence.runTransaction(`notifyLocalViewChanges`,`readwrite`,(e=>H.forEach(t,(t=>H.forEach(t.Es,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>H.forEach(t.ds,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!vr(e))throw e;D(Bs,`Failed to update sequence numbers: `+e)}for(let e of t){let t=e.targetId;if(!e.fromCache){let e=n.Ms.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.Ms=n.Ms.insert(t,i)}}}(r.localStore,a))}async function Hl(e,t){let n=A(e);if(!n.currentUser.isEqual(t)){D(vl,`User change. New user:`,t.toKey());let e=await Ws(n.localStore,t);n.currentUser=t,function(e,t){e.mu.forEach((e=>{e.forEach((e=>{e.reject(new M(j.CANCELLED,t))}))})),e.mu.clear()}(n,`'waitForPendingWrites' promise is rejected due to a user change.`),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Vl(n,e.Ls)}}function Ul(e,t){let n=A(e),r=n.Au.get(t);if(r&&r.hu)return J().add(r.key);{let e=J(),r=n.Iu.get(t);if(!r)return e;for(let t of r){let r=n.Tu.get(t);e=e.unionWith(r.view.nu)}return e}}function Wl(e){let t=A(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=kl.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ul.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=jl.bind(null,t),t.Pu.H_=ll.bind(null,t.eventManager),t.Pu.yu=ul.bind(null,t.eventManager),t}function Gl(e){let t=A(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Ml.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Nl.bind(null,t),t}var Kl=class{constructor(){this.kind=`memory`,this.synchronizeTabs=!1}async initialize(e){this.serializer=pc(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Us(this.persistence,new zs,e.initialUser,this.serializer)}Cu(e){return new Ns(Fs.mi,this.serializer)}Du(e){return new tc}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}};Kl.provider={build:()=>new Kl};var ql=class extends Kl{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){k(this.persistence.referenceDelegate instanceof Is,46915);let n=this.persistence.referenceDelegate.garbageCollector;return new ys(n,e.asyncQueue,t)}Cu(e){let t=this.cacheSizeBytes===void 0?ps.DEFAULT:ps.withCacheSize(this.cacheSizeBytes);return new Ns((e=>Is.mi(e,t)),this.serializer)}},Jl=class{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Al(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Hl.bind(null,this.syncEngine),await Xc(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new al}()}createDatastore(e){let t=pc(e.databaseInfo.databaseId),n=function(e){return new dc(e)}(e.databaseInfo);return function(e,t,n,r){return new bc(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new Cc(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,(e=>Al(this.syncEngine,e,0)),function(){return ic.v()?new ic:new nc}())}createSyncEngine(e,t){return function(e,t,n,r,i,a,o){let s=new xl(e,t,n,r,i,a);return o&&(s.gu=!0),s}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await async function(e){let t=A(e);D(Sc,`RemoteStore shutting down.`),t.Ea.add(5),await Tc(t),t.Aa.shutdown(),t.Ra.set(`Unknown`)}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}};Jl.provider={build:()=>new Jl};var Yl=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):An(`Uncaught Error in snapshot listener:`,e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}},Xl=`FirestoreClient`,Zl=class{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=E.UNAUTHENTICATED,this.clientId=Un.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,(async e=>{D(Xl,`Received user=`,e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(D(Xl,`Received new app check token=`,e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new N;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let n=el(t,`Failed to shutdown persistence`);e.reject(n)}})),e.promise}};async function Ql(e,t){e.asyncQueue.verifyOperationInProgress(),D(Xl,`Initializing OfflineComponentProvider`);let n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await Ws(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function $l(e,t){e.asyncQueue.verifyOperationInProgress();let n=await eu(e);D(Xl,`Initializing OnlineComponentProvider`),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>Yc(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Yc(t.remoteStore,n))),e._onlineComponents=t}async function eu(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){D(Xl,`Using user provided OfflineComponentProvider`);try{await Ql(e,e._uninitializedComponentsProvider._offline)}catch(t){let n=t;if(!function(e){return e.name===`FirebaseError`?e.code===j.FAILED_PRECONDITION||e.code===j.UNIMPLEMENTED:!(typeof DOMException<`u`&&e instanceof DOMException)||e.code===22||e.code===20||e.code===11}(n))throw n;jn(`Error using user provided cache. Falling back to memory cache: `+n),await Ql(e,new Kl)}}else D(Xl,`Using default OfflineComponentProvider`),await Ql(e,new ql(void 0));return e._offlineComponents}async function tu(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(D(Xl,`Using user provided OnlineComponentProvider`),await $l(e,e._uninitializedComponentsProvider._online)):(D(Xl,`Using default OnlineComponentProvider`),await $l(e,new Jl))),e._onlineComponents}function nu(e){return tu(e).then((e=>e.syncEngine))}async function ru(e){let t=await tu(e),n=t.eventManager;return n.onListen=Sl.bind(null,t.syncEngine),n.onUnlisten=El.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=Cl.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=Dl.bind(null,t.syncEngine),n}function iu(e,t,n={}){let r=new N;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){let a=new Yl({next:n=>{a.Nu(),t.enqueueAndForget((()=>cl(e,o))),n.fromCache&&r.source===`server`?i.reject(new M(j.UNAVAILABLE,`Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)`)):i.resolve(n)},error:e=>i.reject(e)}),o=new ml(n,a,{includeMetadataChanges:!0,qa:!0});return sl(e,o)}(await ru(e),e.asyncQueue,t,n,r))),r.promise}function au(e){let t={};return e.timeoutSeconds!==void 0&&(t.timeoutSeconds=e.timeoutSeconds),t}var ou=new Map,su=`firestore.googleapis.com`,cu=!0,lu=class{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new M(j.INVALID_ARGUMENT,`Can't provide ssl option if host option is not set`);this.host=su,this.ssl=cu}else this.host=e.host,this.ssl=e.ssl??cu;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=fs;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<gs)throw new M(j.INVALID_ARGUMENT,`cacheSizeBytes must be at least 1048576`);this.cacheSizeBytes=e.cacheSizeBytes}Qn(`experimentalForceLongPolling`,e.experimentalForceLongPolling,`experimentalAutoDetectLongPolling`,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=au(e.experimentalLongPollingOptions??{}),function(e){if(e.timeoutSeconds!==void 0){if(isNaN(e.timeoutSeconds))throw new M(j.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new M(j.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new M(j.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},uu=class{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type=`firestore-lite`,this._persistenceKey=`(lite)`,this._settings=new lu({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask=`notTerminated`}get app(){if(!this._app)throw new M(j.FAILED_PRECONDITION,`Firestore was not initialized using the Firebase SDK. 'app' is not available`);return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==`notTerminated`}_setSettings(e){if(this._settingsFrozen)throw new M(j.FAILED_PRECONDITION,`Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.`);this._settings=new lu(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(e){if(!e)return new Fn;switch(e.type){case`firstParty`:return new zn(e.sessionIndex||`0`,e.iamToken||null,e.authTokenFactory||null);case`provider`:return e.client;default:throw new M(j.INVALID_ARGUMENT,`makeAuthCredentialsProvider failed due to invalid credential type`)}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask===`notTerminated`&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask===`notTerminated`?await this._terminate():this._terminateTask=`notTerminated`}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let t=ou.get(e);t&&(D(`ComponentProvider`,`Removing Datastore`),ou.delete(e),t.terminate())}(this),Promise.resolve()}};function du(e,t,n,r={}){e=rr(e,uu);let i=oe(t),a=e._getSettings(),o={...a,emulatorOptions:e._getEmulatorOptions()},s=`${t}:${n}`;i&&(se(`https://${s}`),de(`Firestore`,!0)),a.host!==su&&a.host!==s&&jn(`Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.`);let c={...a,host:s,ssl:i,emulatorOptions:r};if(!Se(c,o)&&(e._setSettings(c),r.mockUserToken)){let t,n;if(typeof r.mockUserToken==`string`)t=r.mockUserToken,n=E.MOCK_USER;else{t=ce(r.mockUserToken,e._app?.options.projectId);let i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new M(j.INVALID_ARGUMENT,`mockUserToken must contain 'sub' or 'user_id' field!`);n=new E(i)}e._authCredentials=new In(new Pn(t,n))}}var fu=class e{constructor(e,t,n){this.converter=t,this._query=n,this.type=`query`,this.firestore=e}withConverter(t){return new e(this.firestore,t,this._query)}},$=class e{constructor(e,t,n){this.converter=t,this._key=n,this.type=`document`,this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new pu(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new e(this.firestore,t,this._key)}toJSON(){return{type:e._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,n,r){if(ar(n,e._jsonSchema))return new e(t,r||null,new L(F.fromString(n.referencePath)))}};$._jsonSchemaVersion=`firestore/documentReference/1.0`,$._jsonSchema={type:z(`string`,$._jsonSchemaVersion),referencePath:z(`string`)};var pu=class e extends fu{constructor(e,t,n){super(e,t,Yi(n)),this._path=n,this.type=`collection`}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new $(this.firestore,null,new L(e))}withConverter(t){return new e(this.firestore,t,this._path)}};function mu(e,t,...n){if(e=we(e),R(`collection`,`path`,t),e instanceof uu){let r=F.fromString(t,...n);return er(r),new pu(e,null,r)}{if(!(e instanceof $||e instanceof pu))throw new M(j.INVALID_ARGUMENT,`Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore`);let r=e._path.child(F.fromString(t,...n));return er(r),new pu(e.firestore,null,r)}}function hu(e,t,...n){if(e=we(e),arguments.length===1&&(t=Un.newId()),R(`doc`,`path`,t),e instanceof uu){let r=F.fromString(t,...n);return $n(r),new $(e,null,new L(r))}{if(!(e instanceof $||e instanceof pu))throw new M(j.INVALID_ARGUMENT,`Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore`);let r=e._path.child(F.fromString(t,...n));return $n(r),new $(e.firestore,e instanceof pu?e.converter:null,new L(r))}}var gu=`AsyncQueue`,_u=class{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new mc(this,`async_queue_retry`),this._c=()=>{let e=fc();e&&D(gu,`Visibility state changed to `+e.visibilityState),this.M_.w_()},this.ac=e;let t=fc();t&&typeof t.addEventListener==`function`&&t.addEventListener(`visibilitychange`,this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=fc();t&&typeof t.removeEventListener==`function`&&t.removeEventListener(`visibilitychange`,this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));let t=new N;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!vr(e))throw e;D(gu,`Operation failed with retryable error: `+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){let t=this.ac.then((()=>(this.rc=!0,e().catch((e=>{throw this.nc=e,this.rc=!1,An(`INTERNAL UNHANDLED ERROR: `,vu(e)),e})).then((e=>(this.rc=!1,e))))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let r=$c.createAndSchedule(this,e,t,n,(e=>this.hc(e)));return this.tc.push(r),r}uc(){this.nc&&O(47125,{Pc:vu(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(let t of this.tc)if(t.skipDelay(),e!==`all`&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}};function vu(e){let t=e.message||``;return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+`
`+e.stack),t}function yu(e){return function(e,t){if(typeof e!=`object`||!e)return!1;let n=e;for(let e of t)if(e in n&&typeof n[e]==`function`)return!0;return!1}(e,[`next`,`error`,`complete`])}var bu=class extends uu{constructor(e,t,n,r){super(e,t,n,r),this.type=`firestore`,this._queue=new _u,this._persistenceKey=r?.name||`[DEFAULT]`}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new _u(e),this._firestoreClient=void 0,await e}}};function xu(e,t){let n=typeof e==`object`?e:Gt(),r=typeof e==`string`?e:t||qr,i=Vt(n,`firestore`).getImmediate({identifier:r});if(!i._initialized){let e=re(`firestore`);e&&du(i,...e)}return i}function Su(e){if(e._terminated)throw new M(j.FAILED_PRECONDITION,`The client has already been terminated.`);return e._firestoreClient||Cu(e),e._firestoreClient}function Cu(e){let t=e._freezeSettings(),n=function(e,t,n,r){return new Kr(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,au(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator)}(e._databaseId,e._app?.options.appId||``,e._persistenceKey,t);e._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),e._firestoreClient=new Zl(e._authCredentials,e._appCheckCredentials,e._queue,n,e._componentsProvider&&function(e){let t=e?._online.build();return{_offline:e?._offline.build(t),_online:t}}(e._componentsProvider))}var wu=class e{constructor(e){this._byteString=e}static fromBase64String(t){try{return new e(G.fromBase64String(t))}catch(e){throw new M(j.INVALID_ARGUMENT,`Failed to construct data from Base64 string: `+e)}}static fromUint8Array(t){return new e(G.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return`Bytes(base64: `+this.toBase64()+`)`}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:e._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(ar(t,e._jsonSchema))return e.fromBase64String(t.bytes)}};wu._jsonSchemaVersion=`firestore/bytes/1.0`,wu._jsonSchema={type:z(`string`,wu._jsonSchemaVersion),bytes:z(`string`)};var Tu=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new M(j.INVALID_ARGUMENT,`Invalid field name at argument $(i + 1). Field names must not be empty.`);this._internalPath=new I(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}},Eu=class{constructor(e){this._methodName=e}},Du=class e{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new M(j.INVALID_ARGUMENT,`Latitude must be a number between -90 and 90, but was: `+e);if(!isFinite(t)||t<-180||t>180)throw new M(j.INVALID_ARGUMENT,`Longitude must be a number between -180 and 180, but was: `+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return P(this._lat,e._lat)||P(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:e._jsonSchemaVersion}}static fromJSON(t){if(ar(t,e._jsonSchema))return new e(t.latitude,t.longitude)}};Du._jsonSchemaVersion=`firestore/geoPoint/1.0`,Du._jsonSchema={type:z(`string`,Du._jsonSchemaVersion),latitude:z(`number`),longitude:z(`number`)};var Ou=class e{constructor(e){this._values=(e||[]).map((e=>e))}toArray(){return this._values.map((e=>e))}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:e._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(ar(t,e._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((e=>typeof e==`number`)))return new e(t.vectorValues);throw new M(j.INVALID_ARGUMENT,`Expected 'vectorValues' field to be a number array`)}}};Ou._jsonSchemaVersion=`firestore/vectorValue/1.0`,Ou._jsonSchema={type:z(`string`,Ou._jsonSchemaVersion),vectorValues:z(`object`)};var ku=/^__.*__$/,Au=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask===null?new Ja(e,this.data,t,this.fieldTransforms):new Ya(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function ju(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw O(40011,{Ac:e})}}var Mu=class e{constructor(e,t,n,r,i,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new e({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){let t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){let t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Wu(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc(`Document fields must not be empty`);if(ju(this.Ac)&&ku.test(e))throw this.Sc(`Document fields cannot begin and end with "__"`)}},Nu=class{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||pc(e)}Cc(e,t,n,r=!1){return new Mu({Ac:e,methodName:t,Dc:n,path:I.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Pu(e){let t=e._freezeSettings(),n=pc(e._databaseId);return new Nu(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Fu(e,t,n,r,i,a={}){let o=e.Cc(a.merge||a.mergeFields?2:0,t,n,i);Bu(`Data must be an object, but it was:`,o,r);let s=Ru(r,o),c,l;if(a.merge)c=new Pr(o.fieldMask),l=o.fieldTransforms;else if(a.mergeFields){let e=[];for(let r of a.mergeFields){let i=Vu(t,r,n);if(!o.contains(i))throw new M(j.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Gu(e,i)||e.push(i)}c=new Pr(e),l=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,l=o.fieldTransforms;return new Au(new vi(s),c,l)}function Iu(e,t,n,r=!1){return Lu(n,e.Cc(r?4:3,t))}function Lu(e,t){if(zu(e=we(e)))return Bu(`Unsupported field value:`,t,e),Ru(e,t);if(e instanceof Eu)return function(e,t){if(!ju(t.Ac))throw t.Sc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Sc(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(e===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&t.Ac!==4)throw t.Sc(`Nested arrays are not supported`);return function(e,t){let n=[],r=0;for(let i of e){let e=Lu(i,t.wc(r));e??={nullValue:`NULL_VALUE`},n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if((e=we(e))===null)return{nullValue:`NULL_VALUE`};if(typeof e==`number`)return Ta(t.serializer,e);if(typeof e==`boolean`)return{booleanValue:e};if(typeof e==`string`)return{stringValue:e};if(e instanceof Date){let n=B.fromDate(e);return{timestampValue:ko(t.serializer,n)}}if(e instanceof B){let n=new B(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:ko(t.serializer,n)}}if(e instanceof Du)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof wu)return{bytesValue:Ao(t.serializer,e._byteString)};if(e instanceof $){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Sc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:No(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof Ou)return function(e,t){return{mapValue:{fields:{[Yr]:{stringValue:Qr},[$r]:{arrayValue:{values:e.toArray().map((e=>{if(typeof e!=`number`)throw t.Sc(`VectorValues must only contain numeric values.`);return Ca(t.serializer,e)}))}}}}}}(e,t);throw t.Sc(`Unsupported field value: ${nr(e)}`)}(e,t)}function Ru(e,t){let n={};return Ar(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):kr(e,((e,r)=>{let i=Lu(r,t.mc(e));i!=null&&(n[e]=i)})),{mapValue:{fields:n}}}function zu(e){return!(typeof e!=`object`||!e||e instanceof Array||e instanceof Date||e instanceof B||e instanceof Du||e instanceof wu||e instanceof $||e instanceof Eu||e instanceof Ou)}function Bu(e,t,n){if(!zu(n)||!tr(n)){let r=nr(n);throw r===`an object`?t.Sc(e+` a custom object`):t.Sc(e+` `+r)}}function Vu(e,t,n){if((t=we(t))instanceof Tu)return t._internalPath;if(typeof t==`string`)return Uu(e,t);throw Wu(`Field path arguments must be of type string or `,e,!1,void 0,n)}var Hu=RegExp(`[~\\*/\\[\\]]`);function Uu(e,t,n){if(t.search(Hu)>=0)throw Wu(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Tu(...t.split(`.`))._internalPath}catch{throw Wu(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Wu(e,t,n,r,i){let a=r&&!r.isEmpty(),o=i!==void 0,s=`Function ${t}() called with invalid data`;n&&(s+=" (via `toFirestore()`)"),s+=`. `;let c=``;return(a||o)&&(c+=` (found`,a&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=`)`),new M(j.INVALID_ARGUMENT,s+e+c)}function Gu(e,t){return e.some((e=>e.isEqual(t)))}var Ku=class{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new $(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new qu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Ju(`DocumentSnapshot.get`,e));if(t!==null)return this._userDataWriter.convertValue(t)}}},qu=class extends Ku{data(){return super.data()}};function Ju(e,t){return typeof t==`string`?Uu(e,t):t instanceof Tu?t._internalPath:t._delegate._internalPath}function Yu(e){if(e.limitType===`L`&&e.explicitOrderBy.length===0)throw new M(j.UNIMPLEMENTED,`limitToLast() queries require specifying at least one orderBy() clause`)}var Xu=class{},Zu=class extends Xu{};function Qu(e,t,...n){let r=[];t instanceof Xu&&r.push(t),r=r.concat(n),function(e){let t=e.filter((e=>e instanceof td)).length,n=e.filter((e=>e instanceof $u)).length;if(t>1||t>0&&n>0)throw new M(j.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let t of r)e=t._apply(e);return e}var $u=class e extends Zu{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type=`where`}static _create(t,n,r){return new e(t,n,r)}_apply(e){let t=this._parse(e);return cd(e._query,t),new fu(e.firestore,e.converter,ta(e._query,t))}_parse(e){let t=Pu(e.firestore);return function(e,t,n,r,i,a,o){let s;if(i.isKeyField()){if(a===`array-contains`||a===`array-contains-any`)throw new M(j.INVALID_ARGUMENT,`Invalid Query. You can't perform '${a}' queries on documentId().`);if(a===`in`||a===`not-in`){sd(o,a);let t=[];for(let n of o)t.push(od(r,e,n));s={arrayValue:{values:t}}}else s=od(r,e,o)}else a!==`in`&&a!==`not-in`&&a!==`array-contains-any`||sd(o,a),s=Iu(n,t,o,a===`in`||a===`not-in`);return q.create(i,a,s)}(e._query,`where`,t,e.firestore._databaseId,this._field,this._op,this._value)}};function ed(e,t,n){let r=t,i=Ju(`where`,e);return $u._create(i,r,n)}var td=class e extends Xu{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(t,n){return new e(t,n)}_parse(e){let t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return t.length===1?t[0]:Di.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(e,t){let n=e,r=t.getFlattenedFilters();for(let e of r)cd(n,e),n=ta(n,e)}(e._query,t),new fu(e.firestore,e.converter,ta(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type===`and`?`and`:`or`}},nd=class e extends Zu{constructor(e,t){super(),this._field=e,this._direction=t,this.type=`orderBy`}static _create(t,n){return new e(t,n)}_apply(e){let t=function(e,t,n){if(e.startAt!==null)throw new M(j.INVALID_ARGUMENT,`Invalid query. You must not call startAt() or startAfter() before calling orderBy().`);if(e.endAt!==null)throw new M(j.INVALID_ARGUMENT,`Invalid query. You must not call endAt() or endBefore() before calling orderBy().`);return new wi(t,n)}(e._query,this._field,this._direction);return new fu(e.firestore,e.converter,function(e,t){let n=e.explicitOrderBy.concat([t]);return new qi(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}};function rd(e,t=`asc`){let n=t,r=Ju(`orderBy`,e);return nd._create(r,n)}var id=class e extends Zu{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(t,n,r){return new e(t,n,r)}_apply(e){return new fu(e.firestore,e.converter,na(e._query,this._limit,this._limitType))}};function ad(e){return ir(`limit`,e),id._create(`limit`,e,`F`)}function od(e,t,n){if(typeof(n=we(n))==`string`){if(n===``)throw new M(j.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.`);if(!Zi(t)&&n.indexOf(`/`)!==-1)throw new M(j.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(F.fromString(n));if(!L.isDocumentKey(r))throw new M(j.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return li(e,new L(r))}if(n instanceof $)return li(e,n._key);throw new M(j.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${nr(n)}.`)}function sd(e,t){if(!Array.isArray(e)||e.length===0)throw new M(j.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function cd(e,t){let n=function(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case`!=`:return[`!=`,`not-in`];case`array-contains-any`:case`in`:return[`not-in`];case`not-in`:return[`array-contains-any`,`in`,`not-in`,`!=`];default:return[]}}(t.op));if(n!==null)throw n===t.op?new M(j.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new M(j.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}var ld=class{convertValue(e,t=`none`){switch(ei(e)){case 0:return null;case 1:return e.booleanValue;case 2:return K(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Rr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw O(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t=`none`){let n={};return kr(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertVectorValue(e){let t=e.fields?.[$r].arrayValue?.values?.map((e=>K(e.doubleValue)));return new Ou(t)}convertGeoPoint(e){return new Du(K(e.latitude),K(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case`previous`:let n=Wr(e);return n==null?null:this.convertValue(n,t);case`estimate`:return this.convertTimestamp(Gr(e));default:return null}}convertTimestamp(e){let t=Lr(e);return new B(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=F.fromString(e);k(is(n),9688,{name:e});let r=new Jr(n.get(1),n.get(3)),i=new L(n.popFirst(5));return r.isEqual(t)||An(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}};function ud(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}var dd=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},fd=class e extends Ku{constructor(e,t,n,r,i,a){super(e,t,n,r,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new pd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(Ju(`DocumentSnapshot.get`,e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new M(j.FAILED_PRECONDITION,`DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().`);let t=this._document,n={};return n.type=e._jsonSchemaVersion,n.bundle=``,n.bundleSource=`DocumentSnapshot`,n.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,`previous`),n.bundle=(this._firestore,this.ref.path,`NOT SUPPORTED`),n)}};fd._jsonSchemaVersion=`firestore/documentSnapshot/1.0`,fd._jsonSchema={type:z(`string`,fd._jsonSchemaVersion),bundleSource:z(`string`,`DocumentSnapshot`),bundleName:z(`string`),bundle:z(`string`)};var pd=class extends fd{data(e={}){return super.data(e)}},md=class e{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new dd(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new pd(this._firestore,this._userDataWriter,n.key,n,new dd(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new M(j.INVALID_ARGUMENT,`To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().`);return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{let r=new pd(e._firestore,e._userDataWriter,n.doc.key,n.doc,new dd(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:`added`,doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||e.type!==3)).map((t=>{let r=new pd(e._firestore,e._userDataWriter,t.doc.key,t.doc,new dd(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,a=-1;return t.type!==0&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),t.type!==1&&(n=n.add(t.doc),a=n.indexOf(t.doc.key)),{type:hd(t.type),doc:r,oldIndex:i,newIndex:a}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new M(j.FAILED_PRECONDITION,`QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().`);let t={};t.type=e._jsonSchemaVersion,t.bundleSource=`QuerySnapshot`,t.bundleName=Un.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let n=[],r=[],i=[];return this.docs.forEach((e=>{e._document!==null&&(n.push(e._document),r.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,`previous`)),i.push(e.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,`NOT SUPPORTED`),t}};function hd(e){switch(e){case 0:return`added`;case 2:case 3:return`modified`;case 1:return`removed`;default:return O(61501,{type:e})}}md._jsonSchemaVersion=`firestore/querySnapshot/1.0`,md._jsonSchema={type:z(`string`,md._jsonSchemaVersion),bundleSource:z(`string`,`QuerySnapshot`),bundleName:z(`string`),bundle:z(`string`)};var gd=class extends ld{constructor(e){super(),this.firestore=e}convertBytes(e){return new wu(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new $(this.firestore,null,t)}};function _d(e){e=rr(e,fu);let t=rr(e.firestore,bu),n=Su(t),r=new gd(t);return Yu(e._query),iu(n,e._query).then((n=>new md(t,r,e,n)))}function vd(e,t,n){e=rr(e,$);let r=rr(e.firestore,bu),i=ud(e.converter,t,n);return bd(r,[Fu(Pu(r),`setDoc`,e._key,i,e.converter!==null,n).toMutation(e._key,Ba.none())])}function yd(e,...t){e=we(e);let n={includeMetadataChanges:!1,source:`default`},r=0;typeof t[r]!=`object`||yu(t[r])||(n=t[r++]);let i={includeMetadataChanges:n.includeMetadataChanges,source:n.source};if(yu(t[r])){let e=t[r];t[r]=e.next?.bind(e),t[r+1]=e.error?.bind(e),t[r+2]=e.complete?.bind(e)}let a,o,s;if(e instanceof $)o=rr(e.firestore,bu),s=Yi(e._key.path),a={next:n=>{t[r]&&t[r](xd(o,e,n))},error:t[r+1],complete:t[r+2]};else{let n=rr(e,fu);o=rr(n.firestore,bu),s=n._query;let i=new gd(o);a={next:e=>{t[r]&&t[r](new md(o,i,n,e))},error:t[r+1],complete:t[r+2]},Yu(e._query)}return function(e,t,n,r){let i=new Yl(r),a=new ml(t,i,n);return e.asyncQueue.enqueueAndForget((async()=>sl(await ru(e),a))),()=>{i.Nu(),e.asyncQueue.enqueueAndForget((async()=>cl(await ru(e),a)))}}(Su(o),s,i,a)}function bd(e,t){return function(e,t){let n=new N;return e.asyncQueue.enqueueAndForget((async()=>Ol(await nu(e),t,n))),n.promise}(Su(e),t)}function xd(e,t,n){let r=n.docs.get(t._key);return new fd(e,new gd(e),t._key,r,new dd(n.hasPendingWrites,n.fromCache),t.converter)}(function(e,t=!0){(function(e){Dn=e})(Wt),Bt(new Te(`firestore`,((e,{instanceIdentifier:n,options:r})=>{let i=e.getProvider(`app`).getImmediate(),a=new bu(new Ln(e.getProvider(`auth-internal`)),new Vn(i,e.getProvider(`app-check-internal`)),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,[`projectId`]))throw new M(j.INVALID_ARGUMENT,`"projectId" not provided in firebase.initializeApp.`);return new Jr(e.options.projectId,t)}(i,n),i);return r={useFetchStreams:t,...r},a._setSettings(r),a}),`PUBLIC`).setMultipleInstances(!0)),Kt(Tn,En,e),Kt(Tn,En,`esm2020`)})();const Sd=xu(T({apiKey:`AIzaSyAFAoHsh7rQ32qvIUqdyRaIZkGRjKI2t8M`,authDomain:`qa-student-app-12f98.firebaseapp.com`,projectId:`qa-student-app-12f98`,storageBucket:`qa-student-app-12f98.firebasestorage.app`,messagingSenderId:`1054149573722`,appId:`1:1054149573722:web:1603918839bc3ce34bac63`,measurementId:`G-DXPHJRLDTV`}));var Cd=n();function wd(n=!0){let[o,s]=(0,Cd.useState)([]),[c,l]=(0,Cd.useState)(!0),[u,d]=(0,Cd.useState)(()=>e(`qa_user_profile`,null)),{xp:f,foundBugs:p}=i(),{unlockedAchievements:m}=r(),h=Math.floor(f/500)+1,g=`users`;return(0,Cd.useEffect)(()=>{if(!n){l(!1);return}let e=yd(Qu(mu(Sd,g),rd(`xp`,`desc`),ad(50)),e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),s(t),l(!1)},e=>{a.error(`Error getting leaderboard:`,e),l(!1)});return()=>e()},[n]),(0,Cd.useEffect)(()=>{let t=setTimeout(async()=>{if(u?.uid)try{let t=e(`qa_db_completed_levels`,[]),n=e(`qa_automation_completed_levels`,[]),r=e(`qa_api_completed_levels`,[]),i=e(`qa_mobile_completed_levels`,[]),a={foundBugs:p||[],completedLevels:{sql:t,automation:n,api:r,mobile:i}};await vd(hu(Sd,g,u.uid),{name:u.name,name_lower:u.name.toLowerCase().trim(),xp:f,level:h,badges:m,progress:a,lastActive:new Date().toISOString()},{merge:!0})}catch(e){e.code===`permission-denied`?a.error(`Sync Failed: Security Rules prevented this update. Are you cheating? `):a.error(`Error syncing user data:`,e)}},2e3);return()=>clearTimeout(t)},[f,h,m,u,p]),(0,Cd.useEffect)(()=>{if(!u?.uid)return;let n=yd(hu(Sd,g,u.uid),n=>{if(n.exists()){let r=n.data(),i=r.xp||0,o=e(`qa_game_xp`,0),s=r.badges||[],c=e(`qa_achievements`,[]),l=JSON.stringify(s.sort())!==JSON.stringify(c.sort());if(i!==o||l){if(a.log(`Remote data mismatch detected (Admin Edit or Sync). Syncing down...`,{remoteXP:i,localXP:o,badgesChanged:l}),t(`qa_game_xp`,i),t(`qa_achievements`,s),r.progress&&(r.progress.foundBugs&&t(`qa_game_progress`,r.progress.foundBugs),r.progress.completedLevels)){let{sql:e,automation:n,api:i,mobile:a}=r.progress.completedLevels;e&&t(`qa_db_completed_levels`,e),n&&t(`qa_automation_completed_levels`,n),i&&t(`qa_api_completed_levels`,i),a&&t(`qa_mobile_completed_levels`,a)}window.location.reload()}}},e=>{e.code===`permission-denied`?a.warn(`Firestore Permission Denied: Check your Security Rules.`):a.error(`Firestore Error:`,e)});return()=>n()},[u?.uid]),{leaders:o,loading:c,userProfile:u,saveProfile:async n=>{let r=n.trim(),i=r.toLowerCase();try{let n=Qu(mu(Sd,g),ed(`name_lower`,`==`,i)),o=await _d(n);o.empty&&(n=Qu(mu(Sd,g),ed(`name`,`==`,r)),o=await _d(n));let s,c=!0,l=null;if(o.empty)s=u?.uid||`user_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;else{let e=o.docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>(t.xp||0)-(e.xp||0))[0];s=e.id,c=!1,l=e,a.log(`User restored:`,r,s)}let ee={uid:s,name:r};t(`qa_user_profile`,ee);let te=f,ne=h,re=m,ie={foundBugs:p||[],completedLevels:{sql:e(`qa_db_completed_levels`,[]),automation:e(`qa_automation_completed_levels`,[]),api:e(`qa_api_completed_levels`,[]),mobile:e(`qa_mobile_completed_levels`,[])}},ae=!1;if(!c&&l){let e=l.xp||0;if(e>(f||0)&&(a.log(`Syncing from DB to LocalStorage...`),te=e,ne=l.level||1,re=l.badges||[],l.progress&&(ie=l.progress),ae=!0,t(`qa_game_xp`,e),l.badges&&l.badges.length>0&&t(`qa_achievements`,l.badges),l.progress&&(l.progress.foundBugs&&t(`qa_game_progress`,l.progress.foundBugs),l.progress.completedLevels))){let{sql:e,automation:n,api:r,mobile:i}=l.progress.completedLevels;e&&t(`qa_db_completed_levels`,e),n&&t(`qa_automation_completed_levels`,n),r&&t(`qa_api_completed_levels`,r),i&&t(`qa_mobile_completed_levels`,i)}}let oe={name:r,name_lower:i,xp:te,level:ne,badges:re,progress:ie,lastActive:new Date().toISOString()};return c&&(oe.createdAt=new Date().toISOString()),await vd(hu(Sd,g,s),oe,{merge:!0}),ae?window.location.reload():d(ee),!0}catch(e){return a.error(`Error saving/restoring profile:`,e),!1}},updateName:async e=>{if(!u?.uid)return!1;let n=e.trim(),r=n.toLowerCase();try{let e={...u,name:n};return t(`qa_user_profile`,e),d(e),await vd(hu(Sd,g,u.uid),{name:n,name_lower:r},{merge:!0}),!0}catch(e){return a.error(`Error updating name:`,e),!1}}}}export{wd as t};