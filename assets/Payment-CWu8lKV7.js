import"./useTranslation-BCVn0i94.js";import{t as e}from"./arrow-left-74vNH2eV.js";import{n as t,t as n}from"./user-BNCbEx8J.js";import{t as r}from"./circle-alert-DCkrH_Hy.js";import"./circle-check-big-DdajXeVL.js";import{a as i,i as a,n as o,o as s,r as ee,s as c,t as te}from"./practiceSpecs-BdMMI51N.js";import{t as l}from"./credit-card-BYLRwF5e.js";import{t as u}from"./file-text-DGLpj3aj.js";import{t as d}from"./loader-circle-B8HNG86a.js";import{t as f}from"./lock-OV_bJMSf.js";import"./sparkles-Dg8Py2jv.js";import"./terminal-ayPH-SQE.js";import"./triangle-alert-YkZdooIi.js";import{b as p,g as m,i as ne,n as re,o as ie,t as ae,w as h}from"./index-DafDo4Gr.js";import{t as oe}from"./useGameProgress-CjIEHxQx.js";import"./confetti.module-DMN0QfNx.js";import{t as se}from"./PageTransition-Dt5AKVBJ.js";import{t as ce}from"./bugs-DMwlEXws.js";import{n as g}from"./confetti-CcFCbCdV.js";var _=h(),v=m();function y(){let{foundBugs:m,addBug:h,resetProgress:y,getBugDifficulty:b,xp:x,getBugPoints:S,deductXP:le}=oe(),{newAchievement:C,checkAchievements:w}=re(),{showAnimation:T,animationData:E,triggerBugAnimation:D}=ee(),{addLog:O,addRequest:k}=ae(),[A,j]=(0,_.useState)(``),[M,N]=(0,_.useState)(``),[P,F]=(0,_.useState)(``),[I,L]=(0,_.useState)(``),[R,z]=(0,_.useState)(!1),[B,V]=(0,_.useState)(!1),[H,U]=(0,_.useState)({}),[W,ue]=(0,_.useState)({}),G=ce(`payment`),[de,K]=(0,_.useState)(!1),[q,J]=(0,_.useState)(null),Y=e=>{m.includes(e)||(J(e),K(!0))},X=e=>{let t=h(e);if(t.isNew){let n=G.find(t=>t.id===e);D({...t,bugName:n.description}),w({foundBugs:[...m,e],totalBugs:G.length,moduleBugs:{payment:G},getBugDifficulty:b})}},fe=({severity:e,priority:t})=>{let n=G.find(e=>e.id===q),r=0;e===n.severity&&(r+=5),t===n.priority&&(r+=5);let i=S(b(q))+r;h(q),D({isNew:!0,points:i,bugName:n.description}),K(!1),J(null),w({foundBugs:[...m,q],totalBugs:G.length,moduleBugs:{payment:G},getBugDifficulty:b})},pe=()=>{let e={},t=[];if(A?(A.length>16&&(t.push(`card_len`),e.cardNumber=`Kart nömrəsi 16 rəqəmdən çox ola bilməz`),/[a-zA-Z]/.test(A)&&(t.push(`card_char`),e.cardNumber=`Kart nömrəsi yalnız rəqəmlərdən ibarət olmalıdır`),/[^0-9]/.test(A)&&(t.push(`card_special`),e.cardNumber=`Kart nömrəsində xüsusi simvollar ola bilməz`)):e.cardNumber=`Kart nömrəsi tələb olunur`,M?(/[0-9]/.test(M)&&(t.push(`name_numbers`),e.cardName=`Ad sahəsində rəqəmlər ola bilməz`),M.length>0&&M.length<2&&(t.push(`name_short`),e.cardName=`Ad ən azı 2 simvol olmalıdır`)):e.cardName=`Kart sahibinin adı tələb olunur`,!P)e.expiry=`Bitmə tarixi tələb olunur`;else{let n=new Date(P),r=new Date;n<r&&(t.push(`expiry_past`),e.expiry=`Keçmiş tarix seçilə bilməz`);let i=r.getMonth(),a=r.getFullYear(),o=n.getMonth();n.getFullYear()===a&&o===i&&(t.push(`expiry_current`),e.expiry=`Cari ay artıq bitib, gələcək ay seçin`)}return I?(I.length>3&&(t.push(`cvv_len`),e.cvv=`CVV 3 rəqəmdən çox ola bilməz`),/[a-zA-Z]/.test(I)&&(t.push(`cvv_letters`),e.cvv=`CVV yalnız rəqəmlərdən ibarət olmalıdır`)):e.cvv=`CVV kodu tələb olunur`,t.push(`btn_typo`),t.push(`total_wrong`),t.push(`loading_state`),t.push(`success_msg`),U(e),{isValid:Object.keys(e).length===0,detectedBugs:t}},me=async()=>{if(B){X(`btn_double`);return}let{isValid:e,detectedBugs:t}=pe(),n=!1;if(t.forEach(e=>{X(e),m.includes(e)||(n=!0)}),!e){Object.values(H)[0];return}V(!0),O(`info`,`Starting payment processing...`,{amount:100,currency:`AZN`}),await new Promise(e=>setTimeout(e,1500)),V(!1),k(`POST`,`https://api.bank.com/v1/payments`,500,1500,{error:`Internal Server Error`}),O(`error`,`Payment failed: Server responded with status 500`),n||console.log(`Payment processed (but no message shown to user)`)},Z=e=>{ue({...W,[e]:!0})},Q=G,$=m.filter(e=>Q.some(t=>t.id===e));return(0,_.useEffect)(()=>{$.length===Q.length&&Q.length>0&&g()},[$.length,Q.length]),(0,v.jsxs)(se,{className:`p-6 pt-12 pb-24 min-h-screen`,children:[(0,v.jsx)(i,{isOpen:R,onClose:()=>z(!1),spec:te.payment}),(0,v.jsx)(ie,{children:T&&E&&(0,v.jsx)(a,{bugName:E.bugName,points:E.points,onComplete:()=>{}})}),C&&(0,v.jsx)(ne,{achievement:C,onClose:()=>{}}),(0,v.jsxs)(`header`,{className:`mb-8`,children:[(0,v.jsxs)(p,{to:`/practice`,className:`inline-flex items-center text-slate-500 mb-4 hover:text-slate-800 transition-colors`,children:[(0,v.jsx)(e,{size:20,className:`mr-1`}),`Geri qayıt`]}),(0,v.jsxs)(`div`,{className:`flex justify-between items-start`,children:[(0,v.jsxs)(`div`,{children:[(0,v.jsx)(`h1`,{className:`text-3xl font-black text-slate-900 tracking-tight mb-2`,children:`Ödəniş Səhifəsi`}),(0,v.jsxs)(`div`,{className:`flex items-center gap-2 text-slate-500 font-medium`,children:[(0,v.jsx)(c,{size:18}),(0,v.jsxs)(`p`,{children:[`Bu səhifədə `,G.length,` baq gizlənib.`]})]})]}),(0,v.jsx)(`button`,{onClick:()=>z(!0),className:`p-3 bg-indigo-100 text-indigo-600 rounded-xl hover:bg-indigo-200 transition-colors`,children:(0,v.jsx)(u,{size:24})})]})]}),(0,v.jsxs)(`div`,{className:`bg-white p-8 rounded-[2rem] shadow-xl shadow-purple-200/50 border border-slate-100 relative overflow-hidden mb-8`,children:[(0,v.jsx)(`div`,{className:`absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-purple-500 to-pink-500`}),(0,v.jsxs)(`form`,{onSubmit:e=>{e.preventDefault(),me()},className:`space-y-6`,children:[(0,v.jsxs)(`div`,{className:`mb-8`,children:[(0,v.jsx)(`label`,{className:`block text-sm font-bold text-slate-700 mb-2`,children:`Kart Nömrəsi`}),(0,v.jsxs)(`div`,{className:`relative`,children:[(0,v.jsx)(l,{className:`absolute left-3 top-3.5 text-green-400 cursor-pointer`,size:18,onClick:()=>Y(`card_icon`,`Kart ikonası yanlış rəngdədir (qırmızı əvəzinə yaşıl)`)}),(0,v.jsx)(`input`,{type:`text`,placeholder:`0000 0000 0000 0000`,className:`w-full pl-10 p-3 border-2 rounded-xl outline-none transition-colors ${W.cardNumber&&H.cardNumber?`border-red-300 focus:border-red-500`:`border-slate-200 focus:border-green-500`}`,value:A,onChange:e=>j(e.target.value),onBlur:()=>Z(`cardNumber`),onClick:()=>Y(`border_color`,`Focus zamanı border rəngi səhvdir`)}),W.cardNumber&&H.cardNumber&&(0,v.jsxs)(`div`,{className:`flex items-center gap-2 mt-2 text-red-600 text-sm`,children:[(0,v.jsx)(r,{size:16}),(0,v.jsx)(`span`,{children:H.cardNumber})]})]})]}),(0,v.jsxs)(`div`,{className:`mb-3`,children:[(0,v.jsx)(`label`,{className:`block text-sm font-bold text-slate-700 mb-2 cursor-pointer`,onClick:()=>Y(`name_label`,`Ad sahəsində label səhvi: "Kart sahibi" əvəzinə "Kart sahbi"`),children:`Kart sahbi`}),(0,v.jsxs)(`div`,{className:`relative`,children:[(0,v.jsx)(n,{className:`absolute left-3 top-3.5 text-slate-400`,size:18}),(0,v.jsx)(`input`,{type:`text`,placeholder:`Ad Soyad`,className:`w-full pl-10 p-3 border-2 rounded-xl outline-none transition-colors ${W.cardName&&H.cardName?`border-red-300 focus:border-red-500`:`border-slate-200 focus:border-purple-500`}`,value:M,onChange:e=>N(e.target.value),onBlur:()=>Z(`cardName`)}),W.cardName&&H.cardName&&(0,v.jsxs)(`div`,{className:`flex items-center gap-2 mt-2 text-red-600 text-sm`,children:[(0,v.jsx)(r,{size:16}),(0,v.jsx)(`span`,{children:H.cardName})]})]})]}),(0,v.jsxs)(`div`,{className:`flex gap-4 mb-10 cursor-pointer`,onClick:()=>Y(`form_spacing`,`Form elementləri arasında boşluq qeyri-bərabərdir`),children:[(0,v.jsxs)(`div`,{className:`flex-1`,children:[(0,v.jsx)(`label`,{className:`block text-sm font-bold text-slate-700 mb-2`,children:`Bitmə Tarixi`}),(0,v.jsxs)(`div`,{className:`relative`,children:[(0,v.jsx)(t,{className:`absolute left-3 top-3.5 text-slate-400`,size:18}),(0,v.jsx)(`input`,{type:`month`,className:`w-full pl-10 p-3 border-2 rounded-xl outline-none transition-colors ${W.expiry&&H.expiry?`border-red-300 focus:border-red-500`:`border-slate-200 focus:border-purple-500`}`,value:P,onChange:e=>F(e.target.value),onBlur:()=>Z(`expiry`)}),W.expiry&&H.expiry&&(0,v.jsxs)(`div`,{className:`flex items-center gap-2 mt-2 text-red-600 text-sm`,children:[(0,v.jsx)(r,{size:16}),(0,v.jsx)(`span`,{children:H.expiry})]})]})]}),(0,v.jsxs)(`div`,{className:`flex-1`,children:[(0,v.jsx)(`label`,{className:`block text-sm font-bold text-slate-700 mb-2`,children:`CVV`}),(0,v.jsxs)(`div`,{className:`relative`,children:[(0,v.jsx)(f,{className:`absolute left-3 top-3.5 text-slate-400`,size:18}),(0,v.jsx)(`input`,{type:`text`,placeholder:`123`,className:`w-full pl-10 p-3 border-2 rounded-xl outline-none transition-colors ${W.cvv&&H.cvv?`border-red-300 focus:border-red-500`:`border-slate-200 focus:border-purple-500`}`,value:I,onChange:e=>{L(e.target.value),e.target.value.length>0&&!m.includes(`cvv_visible`)&&h(`cvv_visible`)},onBlur:()=>Z(`cvv`)}),W.cvv&&H.cvv&&(0,v.jsxs)(`div`,{className:`flex items-center gap-2 mt-2 text-red-600 text-sm`,children:[(0,v.jsx)(r,{size:16}),(0,v.jsx)(`span`,{children:H.cvv})]})]})]})]}),(0,v.jsxs)(`div`,{className:`bg-slate-50 p-4 rounded-xl space-y-2`,children:[(0,v.jsxs)(`div`,{className:`flex justify-between text-sm text-slate-600`,children:[(0,v.jsx)(`span`,{children:`Məbləğ:`}),(0,v.jsx)(`span`,{children:`100 AZN`})]}),(0,v.jsxs)(`div`,{className:`flex justify-between text-sm text-slate-600`,children:[(0,v.jsx)(`span`,{children:`Komissiya:`}),(0,v.jsx)(`span`,{children:`5 AZN`})]}),(0,v.jsxs)(`div`,{className:`border-t border-slate-200 pt-2 flex justify-between font-bold text-slate-900`,children:[(0,v.jsx)(`span`,{className:`text-slate-300 cursor-pointer`,onClick:()=>Y(`amount_label`,`Məbləğ yazısında rəng kontrastı zəifdir`),children:`Cəmi:`}),(0,v.jsx)(`span`,{className:`text-red-500`,children:`1005 AZN`})]})]}),(0,v.jsx)(`button`,{type:`submit`,disabled:B,className:`w-full py-4 bg-purple-600 text-white rounded-xl font-bold shadow-lg shadow-purple-200 hover:bg-purple-700 transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2`,children:B?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(d,{className:`animate-spin`,size:20}),(0,v.jsx)(`span`,{children:`Emal edilir...`})]}):`Ödəni et`})]})]}),(0,v.jsx)(s,{bugs:G,foundBugs:m,onReset:y,xp:x,getBugPoints:S,getBugDifficulty:b,deductXP:le}),(0,v.jsx)(o,{isOpen:de,onClose:()=>K(!1),onSubmit:fe,bug:G.find(e=>e.id===q)})]})}export{y as default};